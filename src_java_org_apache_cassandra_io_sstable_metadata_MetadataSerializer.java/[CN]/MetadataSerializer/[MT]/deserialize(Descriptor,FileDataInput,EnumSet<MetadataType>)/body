{
  Map<MetadataType,MetadataComponent> components=Maps.newHashMap();
  int numComponents=in.readInt();
  Map<MetadataType,Integer> toc=new HashMap<>(numComponents);
  MetadataType[] values=MetadataType.values();
  for (int i=0; i < numComponents; i++) {
    toc.put(values[in.readInt()],in.readInt());
  }
  for (  MetadataType type : types) {
    MetadataComponent component=null;
    Integer offset=toc.get(type);
    if (offset != null) {
      in.seek(offset);
      component=type.serializer.deserialize(descriptor.version,in);
    }
    components.put(type,component);
  }
  return components;
}
