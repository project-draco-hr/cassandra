{
  Map<MetadataType,MetadataComponent> components=Maps.newHashMap();
  int numComponents=in.readInt();
  Map<MetadataType,Integer> toc=new HashMap<>(numComponents);
  for (int i=0; i < numComponents; i++) {
    toc.put(MetadataType.values()[in.readInt()],in.readInt());
  }
  for (  MetadataType type : types) {
    MetadataComponent component=null;
    if (toc.containsKey(type)) {
      in.seek(toc.get(type));
      component=type.serializer.deserialize(descriptor.version,in);
    }
    components.put(type,component);
  }
  return components;
}
