{
  Set<InetAddress> liveEndpoints=new HashSet<>();
  String ks=mutation.getKeyspaceName();
  Token tk=StorageService.getPartitioner().getToken(mutation.key());
  for (  InetAddress endpoint : Iterables.concat(StorageService.instance.getNaturalEndpoints(ks,tk),StorageService.instance.getTokenMetadata().pendingEndpointsFor(tk,ks))) {
    if (endpoint.equals(FBUtilities.getBroadcastAddress()))     mutation.apply();
 else     if (FailureDetector.instance.isAlive(endpoint))     liveEndpoints.add(endpoint);
 else     StorageProxy.writeHintForMutation(mutation,writtenAt,ttl,endpoint);
  }
  if (liveEndpoints.isEmpty())   return null;
  ReplayWriteResponseHandler handler=new ReplayWriteResponseHandler(liveEndpoints);
  MessageOut<Mutation> message=mutation.createMessage();
  for (  InetAddress endpoint : liveEndpoints)   MessagingService.instance().sendRR(message,endpoint,handler,false);
  return handler;
}
