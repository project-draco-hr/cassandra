{
  lock_.lock();
  try {
    boolean bVal=true;
    try {
      if (!done_.get()) {
        long overall_timeout=timeout - (System.currentTimeMillis() - startTime_);
        if (overall_timeout > 0)         bVal=condition_.await(overall_timeout,TimeUnit.MILLISECONDS);
 else         bVal=false;
      }
    }
 catch (    InterruptedException ex) {
      throw new AssertionError(ex);
    }
    if (!bVal && !done_.get()) {
      throw new TimeoutException("Operation timed out.");
    }
  }
  finally {
    lock_.unlock();
  }
  return result_;
}
