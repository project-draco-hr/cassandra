{
  try {
    Matcher matcher=REGEX.matcher(record);
    if (!matcher.matches() || matcher.groupCount() != 4)     throw new IllegalStateException(String.format("Invalid record \"%s\"",record));
    RecordType type=RecordType.fromPrefix(matcher.group(1));
    return new Record(type,matcher.group(2),Long.valueOf(matcher.group(3)),Integer.valueOf(matcher.group(4)),record);
  }
 catch (  Throwable t) {
    if (!isLast)     throw t;
    int pos=record.indexOf(':');
    if (pos <= 0)     throw t;
    RecordType recordType;
    try {
      recordType=RecordType.fromPrefix(record.substring(0,pos));
    }
 catch (    Throwable ignore) {
      throw t;
    }
    return new Record(recordType,"",0,0,record);
  }
}
