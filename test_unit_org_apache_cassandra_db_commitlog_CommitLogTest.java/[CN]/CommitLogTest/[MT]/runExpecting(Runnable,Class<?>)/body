{
  JVMStabilityInspector.Killer originalKiller;
  KillerForTests killerForTests;
  killerForTests=new KillerForTests();
  originalKiller=JVMStabilityInspector.replaceKiller(killerForTests);
  Throwable caught=null;
  try {
    r.run();
  }
 catch (  RuntimeException e) {
    if (expected != e.getCause().getClass())     throw new AssertionError("Expected exception " + expected + ", got "+ e,e);
    caught=e;
  }
  if (expected != null && caught == null)   Assert.fail("Expected exception " + expected + " but call completed successfully.");
  JVMStabilityInspector.replaceKiller(originalKiller);
  Assert.assertEquals("JVM killed",expected != null,killerForTests.wasKilled());
}
