{
  CommitLog.instance.resetUnsafe(true);
  ColumnFamilyStore cfs1=Keyspace.open(KEYSPACE1).getColumnFamilyStore(STANDARD1);
  ColumnFamilyStore cfs2=Keyspace.open(KEYSPACE1).getColumnFamilyStore(STANDARD2);
  Mutation m=new RowUpdateBuilder(cfs1.metadata,0,"k").clustering("bytes").add("val",ByteBuffer.allocate(DatabaseDescriptor.getCommitLogSegmentSize() / 4)).build();
  CommitLog.instance.add(m);
  CommitLog.instance.add(m);
  CommitLog.instance.add(m);
  CommitLog.instance.add(m);
  CommitLog.instance.add(m);
  Mutation m2=new RowUpdateBuilder(cfs2.metadata,0,"k").clustering("bytes").add("val",ByteBuffer.allocate(4)).build();
  CommitLog.instance.add(m2);
  assertEquals(2,CommitLog.instance.activeSegments());
  UUID cfid2=m2.getColumnFamilyIds().iterator().next();
  CommitLog.instance.discardCompletedSegments(cfid2,CommitLog.instance.getContext());
  assertEquals(2,CommitLog.instance.activeSegments());
}
