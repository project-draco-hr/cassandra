{
  Integer r;
  if ((r=queryIds.get(query)) != null)   return r;
  r=queryIdCounter.incrementAndGet();
  if (queryIds.putIfAbsent(query,r) == null)   return r;
  queryStrings.put(r,query);
  return queryIds.get(query);
}
