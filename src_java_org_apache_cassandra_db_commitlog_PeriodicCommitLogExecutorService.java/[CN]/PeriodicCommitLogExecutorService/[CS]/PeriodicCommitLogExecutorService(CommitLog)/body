{
  queue=new LinkedBlockingQueue<Runnable>(DatabaseDescriptor.getCommitLogPeriodicQueueSize());
  Runnable runnable=new WrappedRunnable(){
    public void runMayThrow() throws Exception {
      while (run) {
        Runnable r=queue.poll(100,TimeUnit.MILLISECONDS);
        if (r == null)         continue;
        r.run();
        completedTaskCount++;
      }
      commitLog.sync();
    }
  }
;
  appendingThread=new Thread(runnable,"COMMIT-LOG-WRITER");
  appendingThread.start();
  final Callable syncer=new Callable(){
    public Object call() throws Exception {
      commitLog.sync();
      return null;
    }
  }
;
  new Thread(new Runnable(){
    public void run(){
      while (run) {
        try {
          FBUtilities.waitOnFuture(submit(syncer));
          Uninterruptibles.sleepUninterruptibly(DatabaseDescriptor.getCommitLogSyncPeriod(),TimeUnit.MILLISECONDS);
        }
 catch (        Throwable t) {
          if (!CommitLog.handleCommitError("Failed to persist commits to disk",t)) {
            PeriodicCommitLogExecutorService.this.run=false;
            try {
              appendingThread.join();
            }
 catch (            InterruptedException e) {
              throw new IllegalStateException();
            }
            return;
          }
        }
      }
    }
  }
,"PERIODIC-COMMIT-LOG-SYNCER").start();
}
