{
  queue=new LinkedBlockingQueue<Runnable>(DatabaseDescriptor.getCommitLogPeriodicQueueSize());
  Runnable runnable=new WrappedRunnable(){
    public void runMayThrow() throws Exception {
      while (run) {
        Runnable r=queue.poll(100,TimeUnit.MILLISECONDS);
        if (r == null)         continue;
        r.run();
        completedTaskCount++;
      }
      commitLog.sync();
    }
  }
;
  appendingThread=new Thread(runnable,"COMMIT-LOG-WRITER");
  appendingThread.start();
  final Callable syncer=new Callable(){
    public Object call() throws Exception {
      commitLog.sync();
      return null;
    }
  }
;
  new Thread(new Runnable(){
    public void run(){
      while (run) {
        FBUtilities.waitOnFuture(submit(syncer));
        Uninterruptibles.sleepUninterruptibly(DatabaseDescriptor.getCommitLogSyncPeriod(),TimeUnit.MILLISECONDS);
      }
    }
  }
,"PERIODIC-COMMIT-LOG-SYNCER").start();
}
