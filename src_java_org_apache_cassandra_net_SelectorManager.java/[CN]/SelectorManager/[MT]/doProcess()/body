{
  SelectionKey[] keys=selector.selectedKeys().toArray(new SelectionKey[0]);
  for (  SelectionKey key : keys) {
    selector.selectedKeys().remove(key);
    SelectionKeyHandler skh=(SelectionKeyHandler)key.attachment();
    if (skh != null) {
      if (key.isValid() && key.isAcceptable()) {
        skh.accept(key);
      }
      if (key.isValid() && key.isConnectable()) {
        skh.connect(key);
      }
      if (key.isValid() && key.isReadable()) {
        skh.read(key);
      }
      if (key.isValid() && key.isWritable()) {
        skh.write(key);
      }
    }
  }
}
