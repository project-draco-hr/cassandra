{
  Map<Range,List<Range>> splitRanges=LeaveJoinProtocolHelper.getRangeSplitRangeMapping(oldRangeToEndPointMap.keySet().toArray(new Range[0]),tokens_);
  Map<Range,List<EndPoint>> replicasForSplitRanges=new HashMap<Range,List<EndPoint>>();
  Set<Range> rangesSplit=splitRanges.keySet();
  for (  Range splitRange : rangesSplit) {
    replicasForSplitRanges.put(splitRange,oldRangeToEndPointMap.get(splitRange));
  }
  for (  Range splitRange : rangesSplit) {
    oldRangeToEndPointMap.remove(splitRange);
  }
  for (  Range splitRange : rangesSplit) {
    List<Range> subRanges=splitRanges.get(splitRange);
    List<EndPoint> replicas=replicasForSplitRanges.get(splitRange);
    for (    Range subRange : subRanges) {
      oldRangeToEndPointMap.put(subRange,new ArrayList<EndPoint>(replicas));
    }
  }
}
