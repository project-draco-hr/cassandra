{
  ColumnDefinition cdef=indexDef.indexedColumn(baseCfs.metadata);
  if (indexesByColumn.containsKey(cdef.name.bytes))   return null;
  SecondaryIndex index=SecondaryIndex.createInstance(baseCfs,indexDef);
  if (index instanceof PerRowSecondaryIndex) {
    SecondaryIndex currentIndex=rowLevelIndexMap.get(index.getClass());
    if (currentIndex == null) {
      rowLevelIndexMap.put(index.getClass(),index);
      index.init();
    }
 else {
      index=currentIndex;
      index.setIndexMetadata(indexDef);
      logger.info("Creating new index : {}",indexDef.name);
    }
  }
 else {
    if (indexDef.isCustom() && index instanceof AbstractSimplePerColumnSecondaryIndex)     throw new RuntimeException("Cannot use a subclass of AbstractSimplePerColumnSecondaryIndex as a CUSTOM index, as they assume they are CFS backed");
    index.init();
  }
  indexesByColumn.put(cdef.name.bytes,index);
  allIndexes.add(index);
  if (index.isIndexBuilt(cdef.name.bytes))   return null;
  return index.buildIndexAsync();
}
