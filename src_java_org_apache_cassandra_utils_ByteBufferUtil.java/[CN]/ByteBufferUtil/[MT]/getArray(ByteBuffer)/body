{
  int length=buffer.remaining();
  if (buffer.hasArray()) {
    int boff=buffer.arrayOffset() + buffer.position();
    if (boff == 0 && length == buffer.array().length)     return buffer.array();
 else     return Arrays.copyOfRange(buffer.array(),boff,boff + length);
  }
  byte[] bytes=new byte[length];
  buffer.duplicate().get(bytes);
  return bytes;
}
