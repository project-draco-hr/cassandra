{
  int length=buffer.remaining();
  if (buffer.hasArray()) {
    int start=buffer.position();
    if (buffer.arrayOffset() == 0 && start == 0 && length == buffer.array().length)     return buffer.array();
 else     return Arrays.copyOfRange(buffer.array(),start + buffer.arrayOffset(),start + length + buffer.arrayOffset());
  }
  byte[] bytes=new byte[length];
  buffer.duplicate().get(bytes);
  return bytes;
}
