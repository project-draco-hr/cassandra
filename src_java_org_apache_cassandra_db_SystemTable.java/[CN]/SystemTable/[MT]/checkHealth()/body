{
  Table table;
  try {
    table=Table.open(Table.SYSTEM_KS);
  }
 catch (  AssertionError err) {
    ConfigurationException ex=new ConfigurationException("Could not read system table!");
    ex.initCause(err);
    throw ex;
  }
  String savedClusterName;
  ColumnFamilyStore oldStatusCfs=table.getColumnFamilyStore(OLD_STATUS_CF);
  if (oldStatusCfs.getSSTables().size() > 0) {
    logger.debug("Detected system data in {}.{}, checking saved cluster name",Table.SYSTEM_KS,OLD_STATUS_CF);
    SortedSet<ByteBuffer> cols=new TreeSet<ByteBuffer>(BytesType.instance);
    cols.add(ByteBufferUtil.bytes("ClusterName"));
    QueryFilter filter=QueryFilter.getNamesFilter(decorate(ByteBufferUtil.bytes("L")),new QueryPath(OLD_STATUS_CF),cols);
    ColumnFamily oldCf=oldStatusCfs.getColumnFamily(filter);
    try {
      savedClusterName=ByteBufferUtil.string(oldCf.getColumn(ByteBufferUtil.bytes("ClusterName")).value());
    }
 catch (    CharacterCodingException e) {
      throw new RuntimeException(e);
    }
  }
 else {
    ColumnFamilyStore cfs=table.getColumnFamilyStore(LOCAL_CF);
    String req="SELECT cluster_name FROM system.%s WHERE key='%s'";
    UntypedResultSet result=processInternal(String.format(req,LOCAL_CF,LOCAL_KEY));
    if (result.isEmpty() || !result.one().has("cluster_name")) {
      if (!cfs.getSSTables().isEmpty())       throw new ConfigurationException("Found system table files, but they couldn't be loaded!");
      req="INSERT INTO system.%s (key, cluster_name) VALUES ('%s', '%s')";
      processInternal(String.format(req,LOCAL_CF,LOCAL_KEY,DatabaseDescriptor.getClusterName()));
      return;
    }
    savedClusterName=result.one().getString("cluster_name");
  }
  if (!DatabaseDescriptor.getClusterName().equals(savedClusterName))   throw new ConfigurationException("Saved cluster name " + savedClusterName + " != configured name "+ DatabaseDescriptor.getClusterName());
}
