{
  Table table=null;
  try {
    table=Table.open(Table.SYSTEM_TABLE);
  }
 catch (  AssertionError err) {
    ConfigurationException ex=new ConfigurationException("Could not read system table. Did you change partitioners?");
    ex.initCause(err);
    throw ex;
  }
  SortedSet<byte[]> cols=new TreeSet<byte[]>(BytesType.instance);
  cols.add(TOKEN);
  cols.add(GENERATION);
  cols.add(PARTITIONER);
  QueryFilter filter=QueryFilter.getNamesFilter(decorate(LOCATION_KEY),new QueryPath(STATUS_CF),cols);
  ColumnFamily cf=table.getColumnFamilyStore(STATUS_CF).getColumnFamily(filter);
  if (cf == null) {
    for (    String path : DatabaseDescriptor.getAllDataFileLocationsForTable("system")) {
      File[] dbContents=new File(path).listFiles(new FilenameFilter(){
        public boolean accept(        File dir,        String name){
          return name.endsWith(".db");
        }
      }
);
      if (dbContents.length > 0)       throw new ConfigurationException("Found system table files, but they couldn't be loaded. Did you change the partitioner?");
    }
    return;
  }
  if (cf.getColumnCount() > 0 && (cf.getColumn(GENERATION) == null || cf.getColumn(TOKEN) == null))   throw new ConfigurationException("Couldn't read system generation or token. Did you change the partitioner?");
  IColumn partitionerCol=cf.getColumn(PARTITIONER);
  if (partitionerCol != null && !DatabaseDescriptor.getPartitioner().getClass().getName().equals(new String(partitionerCol.value(),UTF_8)))   throw new ConfigurationException("Detected partitioner mismatch! Did you change the partitioner?");
  if (partitionerCol == null)   logger.info("Did not see a partitioner in system storage.");
}
