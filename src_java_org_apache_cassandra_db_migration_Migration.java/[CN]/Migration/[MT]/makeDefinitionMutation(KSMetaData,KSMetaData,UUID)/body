{
  final long now=System.currentTimeMillis();
  RowMutation rm=new RowMutation(Table.SYSTEM_TABLE,toBytes(versionId));
  if (remove != null)   rm.delete(new QueryPath(SCHEMA_CF,null,remove.name.getBytes()),new TimestampClock(System.currentTimeMillis()));
  if (add != null)   rm.add(new QueryPath(SCHEMA_CF,null,add.name.getBytes()),KSMetaData.serialize(add),new TimestampClock(now));
  for (  String tableName : DatabaseDescriptor.getNonSystemTables()) {
    if (add != null && add.name.equals(tableName) || remove != null && remove.name.equals(tableName))     continue;
    KSMetaData ksm=DatabaseDescriptor.getTableDefinition(tableName);
    rm.add(new QueryPath(SCHEMA_CF,null,ksm.name.getBytes()),KSMetaData.serialize(ksm),new TimestampClock(now));
  }
  return rm;
}
