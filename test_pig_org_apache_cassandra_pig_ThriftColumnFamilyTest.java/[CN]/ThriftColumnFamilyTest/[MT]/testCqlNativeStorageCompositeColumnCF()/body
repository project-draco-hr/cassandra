{
  pig.registerQuery("compo = load 'cql://thrift_ks/compo?" + defaultParameters + nativeParameters+ "&input_cql=select%20*%20from%20compo%20where%20token(key)%20%3E%20%3F%20and%20token(key)%20%3C%3D%20%3F' using CqlNativeStorage();");
  pig.registerQuery("lee = filter compo by column1 == 'bruce' AND column2 == 'lee';");
  Iterator<Tuple> it=pig.openIterator("lee");
  int count=0;
  while (it.hasNext()) {
    count++;
    Tuple t=it.next();
    Assert.assertEquals(t.get(1),"bruce");
    Assert.assertEquals(t.get(2),"lee");
    if ("kick".equals(t.get(0)))     Assert.assertEquals(t.get(3),"oww");
 else     Assert.assertEquals(t.get(3),"ouch");
  }
  Assert.assertEquals(count,2);
  pig.registerQuery("night = load 'cql://thrift_ks/compo_int?" + defaultParameters + nativeParameters+ "&input_cql=select%20*%20from%20compo_int%20where%20token(key)%20%3E%20%3F%20and%20token(key)%20%3C%3D%20%3F' using CqlNativeStorage();");
  pig.registerQuery("night = foreach night generate (int)column1+(double)column2/60 as hour, value as noise;");
  pig.registerQuery("darkest = filter night by hour > 2 and hour < 5;");
  it=pig.openIterator("darkest");
  if (it.hasNext()) {
    Tuple t=it.next();
    Assert.assertEquals(t.get(0),2.5d);
    Assert.assertEquals(t.get(1),"daddy?");
  }
  pig.setBatchOn();
  pig.registerQuery("compo_int_rows = LOAD 'cql://thrift_ks/compo_int?" + defaultParameters + nativeParameters+ "&input_cql=select%20*%20from%20compo_int%20where%20token(key)%20%3E%20%3F%20and%20token(key)%20%3C%3D%20%3F' using CqlNativeStorage();");
  pig.registerQuery("STORE compo_int_rows INTO 'cql://thrift_ks/compo_int_copy?" + defaultParameters + nativeParameters+ "&output_query=UPDATE+thrift_ks.compo_int_copy+set+column1+%3D+%3F,+column2+%3D+%3F,+value+%3D+%3F' using CqlNativeStorage();");
  pig.executeBatch();
  pig.registerQuery("compocopy_int_rows = LOAD 'cql://thrift_ks/compo_int_copy?" + defaultParameters + nativeParameters+ "&input_cql=select%20*%20from%20compo_int_copy%20where%20token(key)%20%3E%20%3F%20and%20token(key)%20%3C%3D%20%3F' using CqlNativeStorage();");
  it=pig.openIterator("compocopy_int_rows");
  count=0;
  if (it.hasNext()) {
    Tuple t=it.next();
    Assert.assertEquals(t.get(0),"clock");
    DataBag columns=(DataBag)t.get(1);
    for (    Tuple t1 : columns) {
      count++;
      Tuple inner=(Tuple)t1.get(0);
      if ((Long)inner.get(0) == 1L && (Long)inner.get(1) == 0L)       Assert.assertEquals(t1.get(1),"z");
 else       if ((Long)inner.get(0) == 1L && (Long)inner.get(1) == 30L)       Assert.assertEquals(t1.get(1),"zzzz");
 else       if ((Long)inner.get(0) == 2L && (Long)inner.get(1) == 30L)       Assert.assertEquals(t1.get(1),"daddy?");
 else       if ((Long)inner.get(0) == 6L && (Long)inner.get(1) == 30L)       Assert.assertEquals(t1.get(1),"coffee...");
    }
    Assert.assertEquals(count,4);
  }
}
