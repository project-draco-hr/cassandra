{
  TraceState state=this.state.get();
  if (state == null) {
    logger.debug("request complete");
  }
 else {
    final int elapsed=state.elapsed();
    final ByteBuffer sessionId=state.sessionIdBytes;
    final int ttl=state.ttl;
    TraceState.executeMutation(TraceKeyspace.makeStopSessionMutation(sessionId,elapsed,ttl));
    state.stop();
    sessions.remove(state.sessionId);
    this.state.set(null);
  }
}
