{
  TraceState state=this.state.get();
  if (state == null) {
    logger.debug("request complete");
  }
 else {
    final long finished_at=System.currentTimeMillis();
    final ByteBuffer sessionIdBytes=state.sessionIdBytes;
    StageManager.getStage(Stage.TRACING).execute(new WrappedRunnable(){
      public void runMayThrow() throws Exception {
        ColumnFamily cf=ColumnFamily.create(CFMetaData.TraceSessionsCf);
        addColumn(cf,buildName(CFMetaData.TraceSessionsCf,bytes("finished_at")),LongType.instance.decompose(finished_at));
        RowMutation mutation=new RowMutation(TRACE_KS,sessionIdBytes);
        mutation.add(cf);
        StorageProxy.mutate(Arrays.asList(mutation),ConsistencyLevel.ANY);
      }
    }
);
    sessions.remove(state.sessionId);
    this.state.set(null);
  }
}
