{
  Lock lock=LOCKS.get(proposal.key);
  lock.lock();
  try {
    Commit promised=SystemKeyspace.loadPaxosPromise(proposal.key,proposal.update.metadata());
    if (proposal.hasBallot(promised.ballot) || proposal.isAfter(promised)) {
      Tracing.trace("Accepting proposal {}",proposal);
      SystemKeyspace.savePaxosProposal(proposal);
      return true;
    }
 else {
      Tracing.trace("Rejecting proposal for {} because inProgress is now {}",proposal,promised);
      return false;
    }
  }
  finally {
    lock.unlock();
  }
}
