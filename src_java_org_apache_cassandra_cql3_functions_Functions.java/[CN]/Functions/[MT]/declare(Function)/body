{
synchronized (declared) {
    List<Function> functions=declared.get(fun.name());
    if (functions == null) {
      functions=new CopyOnWriteArrayList<>();
      List<Function> existing=declared.putIfAbsent(fun.name(),functions);
      if (existing != null)       functions=existing;
    }
    functions.add(fun);
  }
}
