{
  RandomAccessFile raf;
  try {
    raf=new RandomAccessFile(path,"r");
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  long[] boundaries=this.boundaries.finish(length,isFinal);
  int segcount=boundaries.length - 1;
  Segment[] segments=new Segment[segcount];
  try {
    for (int i=0; i < segcount; i++) {
      long start=boundaries[i];
      long size=boundaries[i + 1] - start;
      MappedByteBuffer segment=size <= MAX_SEGMENT_SIZE ? raf.getChannel().map(FileChannel.MapMode.READ_ONLY,start,size) : null;
      segments[i]=new Segment(start,segment);
    }
  }
 catch (  IOException e) {
    throw new FSReadError(e,path);
  }
 finally {
    FileUtils.closeQuietly(raf);
  }
  return segments;
}
