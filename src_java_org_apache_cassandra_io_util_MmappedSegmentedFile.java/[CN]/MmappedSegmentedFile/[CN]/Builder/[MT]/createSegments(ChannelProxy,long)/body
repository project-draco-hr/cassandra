{
  while (length < boundaries.get(boundaries.size() - 1))   boundaries.remove(boundaries.size() - 1);
  List<Long> boundaries=new ArrayList<>(this.boundaries);
  if (length != boundaries.get(boundaries.size() - 1))   boundaries.add(length);
  int segcount=boundaries.size() - 1;
  Segment[] segments=new Segment[segcount];
  for (int i=0; i < segcount; i++) {
    long start=boundaries.get(i);
    long size=boundaries.get(i + 1) - start;
    MappedByteBuffer segment=size <= MAX_SEGMENT_SIZE ? channel.map(FileChannel.MapMode.READ_ONLY,start,size) : null;
    segments[i]=new Segment(start,segment);
  }
  return segments;
}
