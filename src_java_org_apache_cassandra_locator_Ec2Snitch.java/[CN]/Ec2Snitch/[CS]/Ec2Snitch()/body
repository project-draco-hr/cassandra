{
  HttpURLConnection conn=(HttpURLConnection)new URL("http://169.254.169.254/latest/meta-data/placement/availability-zone").openConnection();
  conn.setRequestMethod("GET");
  if (conn.getResponseCode() != 200) {
    throw new ConfigurationException("Ec2Snitch was unable to find region/zone data. Not an ec2 node?");
  }
  int cl=conn.getContentLength();
  byte[] b=new byte[cl];
  DataInputStream d=new DataInputStream((FilterInputStream)conn.getContent());
  d.readFully(b);
  String azone=new String(b,"UTF-8");
  String[] splits=azone.split("-");
  ec2zone=splits[splits.length - 1];
  ec2region=splits.length < 3 ? splits[0] : splits[0] + "-" + splits[1];
  logger.info("EC2Snitch using region: " + ec2region + ", zone: "+ ec2zone+ ".");
}
