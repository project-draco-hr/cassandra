{
  String KEYSPACE1="Keyspace1";
  ColumnFamilyStore cfs=Keyspace.open("Keyspace1").getColumnFamilyStore("Standard1");
  cfs.disableAutoCompaction();
  cfs.metadata.gcGraceSeconds(0);
  DecoratedKey ttlKey=Util.dk("ttl");
  RowMutation rm=new RowMutation("Keyspace1",ttlKey.key);
  rm.add("Standard1",ByteBufferUtil.bytes("col1"),ByteBufferUtil.EMPTY_BYTE_BUFFER,1,1);
  rm.add("Standard1",ByteBufferUtil.bytes("col2"),ByteBufferUtil.EMPTY_BYTE_BUFFER,3,1);
  rm.applyUnsafe();
  cfs.forceBlockingFlush();
  rm=new RowMutation(KEYSPACE1,ttlKey.key);
  rm.add("Standard1",ByteBufferUtil.bytes("col1"),ByteBufferUtil.EMPTY_BYTE_BUFFER,2,1);
  rm.add("Standard1",ByteBufferUtil.bytes("col2"),ByteBufferUtil.EMPTY_BYTE_BUFFER,5,1);
  rm.applyUnsafe();
  cfs.forceBlockingFlush();
  rm=new RowMutation(KEYSPACE1,ttlKey.key);
  rm.add("Standard1",ByteBufferUtil.bytes("col1"),ByteBufferUtil.EMPTY_BYTE_BUFFER,4,1);
  rm.add("Standard1",ByteBufferUtil.bytes("shadow"),ByteBufferUtil.EMPTY_BYTE_BUFFER,7,1);
  rm.applyUnsafe();
  cfs.forceBlockingFlush();
  rm=new RowMutation(KEYSPACE1,ttlKey.key);
  rm.add("Standard1",ByteBufferUtil.bytes("shadow"),ByteBufferUtil.EMPTY_BYTE_BUFFER,6,3);
  rm.add("Standard1",ByteBufferUtil.bytes("col2"),ByteBufferUtil.EMPTY_BYTE_BUFFER,8,1);
  rm.applyUnsafe();
  cfs.forceBlockingFlush();
  Set<SSTableReader> sstables=Sets.newHashSet(cfs.getSSTables());
  int now=(int)(System.currentTimeMillis() / 1000);
  int gcBefore=now + 2;
  Set<SSTableReader> expired=CompactionController.getFullyExpiredSSTables(cfs,sstables,Collections.EMPTY_SET,gcBefore);
  assertEquals(2,expired.size());
  cfs.clearUnsafe();
}
