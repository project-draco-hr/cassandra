{
  DecoratedKey key=partition.partitionKey();
  if (lastKey == null || !lastKey.equals(key))   remainingInPartition=limits.perPartitionCount();
  lastKey=key;
  if (isFirstPartition) {
    isFirstPartition=false;
    if (isPreviouslyReturnedPartition(key) && !partition.hasNext()) {
      partition.close();
      return null;
    }
  }
  return Transformation.apply(counter.applyTo(partition),this);
}
