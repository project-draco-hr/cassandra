def waitfor(secs, fn, *args, **kwargs):
    start = time.time()
    success = False
    last_exception = None
    while ((not success) and (time.time() < (start + secs))):
        try:
            fn(*args, **kwargs)
            success = True
        except KeyboardInterrupt:
            raise
        except Exception as e:
            last_exception = e
            pass
    if ((not success) and last_exception):
        raise last_exception
