{
  long start=System.currentTimeMillis();
  String msgSuffix=savedCachePath.getName() + " for " + cfname+ " of "+ ksname;
  logger.info("saving " + msgSuffix);
  int count=0;
  File tmpFile=File.createTempFile(savedCachePath.getName(),null,savedCachePath.getParentFile());
  FileOutputStream fout=null;
  ObjectOutputStream out=null;
  try {
    fout=new FileOutputStream(tmpFile);
    out=new ObjectOutputStream(new BufferedOutputStream(fout));
    FileDescriptor fd=fout.getFD();
    for (    K key : cache.getKeySet()) {
      ByteBuffer bytes=converter.apply(key);
      out.writeInt(bytes.remaining());
      out.write(bytes.array(),bytes.position() + bytes.arrayOffset(),bytes.remaining());
      ++count;
    }
    out.flush();
    fd.sync();
  }
  finally {
    FileUtils.closeQuietly(out);
    FileUtils.closeQuietly(fout);
  }
  if (!tmpFile.renameTo(savedCachePath))   throw new IOException("Unable to rename cache to " + savedCachePath);
  if (logger.isDebugEnabled())   logger.debug("saved " + count + " keys in "+ (System.currentTimeMillis() - start)+ " ms from "+ msgSuffix);
}
