{
  String keyspace="cql_keyspace";
  String table="table1";
  ColumnFamilyStore cfs=Keyspace.open(keyspace).getColumnFamilyStore(table);
  cfs.disableAutoCompaction();
  QueryProcessor.executeInternal(String.format("INSERT INTO %s.%s (k, v1, v2) VALUES (%d, '%s', %d)",keyspace,table,1,"foo",1));
  cfs.forceBlockingFlush();
  UntypedResultSet result=QueryProcessor.executeInternal(String.format("SELECT * FROM %s.%s WHERE k = %d",keyspace,table,1));
  assertEquals(1,result.size());
  QueryProcessor.executeInternal(String.format("DELETE FROM %s.%s WHERE k = %d",keyspace,table,1));
  cfs.forceBlockingFlush();
  assertEquals(2,cfs.getLiveSSTables().size());
  result=QueryProcessor.executeInternal(String.format("SELECT * FROM %s.%s WHERE k = %d",keyspace,table,1));
  assertEquals(0,result.size());
  FBUtilities.waitOnFutures(CompactionManager.instance.submitMaximal(cfs,(int)(System.currentTimeMillis() / 1000) - 10000,false));
  assertEquals(1,cfs.getLiveSSTables().size());
  result=QueryProcessor.executeInternal(String.format("SELECT * FROM %s.%s WHERE k = %d",keyspace,table,1));
  assertEquals(0,result.size());
  QueryProcessor.executeInternal(String.format("INSERT INTO %s.%s (k, v1, v2) VALUES (%d, '%s', %d)",keyspace,table,1,"foo",1));
  cfs.forceBlockingFlush();
  assertEquals(2,cfs.getLiveSSTables().size());
  result=QueryProcessor.executeInternal(String.format("SELECT * FROM %s.%s WHERE k = %d",keyspace,table,1));
  assertEquals(1,result.size());
  QueryProcessor.executeInternal(String.format("DELETE FROM %s.%s WHERE k = %d",keyspace,table,1));
  cfs.forceBlockingFlush();
  FBUtilities.waitOnFutures(CompactionManager.instance.submitMaximal(cfs,(int)(System.currentTimeMillis() / 1000) + 10000,false));
  assertEquals(0,cfs.getLiveSSTables().size());
  result=QueryProcessor.executeInternal(String.format("SELECT * FROM %s.%s WHERE k = %d",keyspace,table,1));
  assertEquals(0,result.size());
}
