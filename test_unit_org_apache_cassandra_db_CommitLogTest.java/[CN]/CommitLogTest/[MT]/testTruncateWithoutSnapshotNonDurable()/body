{
  CommitLog.instance.resetUnsafe(true);
  boolean originalState=DatabaseDescriptor.getAutoSnapshot();
  try {
    DatabaseDescriptor.setAutoSnapshot(false);
    Keyspace notDurableKs=Keyspace.open(KEYSPACE2);
    Assert.assertFalse(notDurableKs.getMetadata().params.durableWrites);
    ColumnFamilyStore cfs=notDurableKs.getColumnFamilyStore("Standard1");
    new RowUpdateBuilder(cfs.metadata,0,"key1").clustering("bytes").add("val",ByteBufferUtil.bytes("abcd")).build().applyUnsafe();
    assertTrue(Util.getOnlyRow(Util.cmd(cfs).columns("val").build()).iterator().next().value().equals(ByteBufferUtil.bytes("abcd")));
    cfs.truncateBlocking();
    Util.assertEmpty(Util.cmd(cfs).columns("val").build());
  }
  finally {
    DatabaseDescriptor.setAutoSnapshot(originalState);
  }
}
