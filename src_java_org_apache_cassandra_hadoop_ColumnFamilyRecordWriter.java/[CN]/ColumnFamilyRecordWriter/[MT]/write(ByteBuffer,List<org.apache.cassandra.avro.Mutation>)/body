{
  maybeFlush();
  byte[] key=copy(keybuff);
  InetAddress endpoint=getEndpoint(key);
  Map<byte[],Map<String,List<Mutation>>> mutationsByKey=mutationsByEndpoint.get(endpoint);
  if (mutationsByKey == null) {
    mutationsByKey=new TreeMap<byte[],Map<String,List<Mutation>>>(FBUtilities.byteArrayComparator);
    mutationsByEndpoint.put(endpoint,mutationsByKey);
  }
  Map<String,List<Mutation>> cfMutation=mutationsByKey.get(key);
  if (cfMutation == null) {
    cfMutation=new HashMap<String,List<Mutation>>();
    mutationsByKey.put(key,cfMutation);
  }
  List<Mutation> mutationList=cfMutation.get(ConfigHelper.getOutputColumnFamily(context.getConfiguration()));
  if (mutationList == null) {
    mutationList=new ArrayList<Mutation>();
    cfMutation.put(ConfigHelper.getOutputColumnFamily(context.getConfiguration()),mutationList);
  }
  for (  org.apache.cassandra.avro.Mutation amut : value)   mutationList.add(avroToThrift(amut));
}
