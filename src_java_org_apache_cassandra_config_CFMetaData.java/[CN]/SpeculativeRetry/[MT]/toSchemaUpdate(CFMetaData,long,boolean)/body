{
  Mutation mutation=new Mutation(Keyspace.SYSTEM_KS,SystemKeyspace.getSchemaKSKey(ksName));
  newState.toSchemaNoColumnsNoTriggers(mutation,modificationTimestamp);
  MapDifference<ByteBuffer,ColumnDefinition> columnDiff=Maps.difference(columnMetadata,newState.columnMetadata);
  for (  ColumnDefinition cd : columnDiff.entriesOnlyOnLeft().values()) {
    if (fromThrift && cd.kind != ColumnDefinition.Kind.REGULAR)     continue;
    cd.deleteFromSchema(mutation,modificationTimestamp);
  }
  for (  ColumnDefinition cd : columnDiff.entriesOnlyOnRight().values())   cd.toSchema(mutation,modificationTimestamp);
  for (  ByteBuffer name : columnDiff.entriesDiffering().keySet()) {
    ColumnDefinition cd=newState.columnMetadata.get(name);
    cd.toSchema(mutation,modificationTimestamp);
  }
  MapDifference<String,TriggerDefinition> triggerDiff=Maps.difference(triggers,newState.triggers);
  for (  TriggerDefinition td : triggerDiff.entriesOnlyOnLeft().values())   td.deleteFromSchema(mutation,cfName,modificationTimestamp);
  for (  TriggerDefinition td : triggerDiff.entriesOnlyOnRight().values())   td.toSchema(mutation,cfName,modificationTimestamp);
  return mutation;
}
