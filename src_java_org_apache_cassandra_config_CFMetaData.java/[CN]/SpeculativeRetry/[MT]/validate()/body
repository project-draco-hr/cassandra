{
  if (!isNameValid(ksName))   throw new ConfigurationException(String.format("Keyspace name must not be empty, more than %s characters long, or contain non-alphanumeric-underscore characters (got \"%s\")",Schema.NAME_LENGTH,ksName));
  if (!isNameValid(cfName))   throw new ConfigurationException(String.format("ColumnFamily name must not be empty, more than %s characters long, or contain non-alphanumeric-underscore characters (got \"%s\")",Schema.NAME_LENGTH,cfName));
  if (cfType == null)   throw new ConfigurationException(String.format("Invalid column family type for %s",cfName));
  if (comparator instanceof CounterColumnType)   throw new ConfigurationException("CounterColumnType is not a valid comparator");
  if (keyValidator instanceof CounterColumnType)   throw new ConfigurationException("CounterColumnType is not a valid key validator");
  if (defaultValidator instanceof CounterColumnType) {
    for (    ColumnDefinition def : regularColumns)     if (!(def.getValidator() instanceof CounterColumnType))     throw new ConfigurationException("Cannot add a non counter column (" + getColumnDefinitionComparator(def).getString(def.name) + ") in a counter column family");
  }
 else {
    for (    ColumnDefinition def : column_metadata.values())     if (def.getValidator() instanceof CounterColumnType)     throw new ConfigurationException("Cannot add a counter column (" + getColumnDefinitionComparator(def).getString(def.name) + ") in a non counter column family");
  }
  for (  ColumnDefinition def : partitionKeyColumns)   validateAlias(def,"Key");
  for (  ColumnDefinition def : clusteringKeyColumns)   validateAlias(def,"Column");
  if (compactValueColumn != null)   validateAlias(compactValueColumn,"Value");
  Set<String> indexNames=existingIndexNames(cfName);
  for (  ColumnDefinition c : column_metadata.values()) {
    AbstractType<?> comparator=getColumnDefinitionComparator(c);
    try {
      comparator.validate(c.name);
    }
 catch (    MarshalException e) {
      throw new ConfigurationException(String.format("Column name %s is not valid for comparator %s",ByteBufferUtil.bytesToHex(c.name),comparator));
    }
    if (c.getIndexType() == null) {
      if (c.getIndexName() != null)       throw new ConfigurationException("Index name cannot be set without index type");
    }
 else {
      if (cfType == ColumnFamilyType.Super)       throw new ConfigurationException("Secondary indexes are not supported on super column families");
      if (!isIndexNameValid(c.getIndexName()))       throw new ConfigurationException("Illegal index name " + c.getIndexName());
      if (indexNames.contains(c.getIndexName()))       throw new ConfigurationException("Duplicate index name " + c.getIndexName());
      indexNames.add(c.getIndexName());
      if (c.getIndexType() == IndexType.CUSTOM) {
        if (c.getIndexOptions() == null || !c.getIndexOptions().containsKey(SecondaryIndex.CUSTOM_INDEX_OPTION_NAME))         throw new ConfigurationException("Required index option missing: " + SecondaryIndex.CUSTOM_INDEX_OPTION_NAME);
      }
      SecondaryIndex.createInstance(null,c);
    }
  }
  validateCompactionThresholds();
  if (bloomFilterFpChance != null && bloomFilterFpChance == 0)   throw new ConfigurationException("Zero false positives is impossible; bloom filter false positive chance bffpc must be 0 < bffpc <= 1");
  return this;
}
