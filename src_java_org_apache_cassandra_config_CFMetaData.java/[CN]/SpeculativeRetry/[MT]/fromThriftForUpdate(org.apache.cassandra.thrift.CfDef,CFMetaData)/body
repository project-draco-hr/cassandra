{
  CFMetaData cfm=internalFromThrift(cf_def);
  boolean hasKeyAlias=cf_def.isSetKey_alias() && !(cfm.keyValidator instanceof CompositeType);
  if (hasKeyAlias)   cfm.column_metadata.put(cf_def.key_alias,ColumnDefinition.partitionKeyDef(cf_def.key_alias,cfm.keyValidator,null));
  for (  ColumnDefinition def : toUpdate.allColumns()) {
    if (def.isPartOfCellName())     continue;
    if (def.type == ColumnDefinition.Type.PARTITION_KEY && hasKeyAlias)     continue;
    cfm.addOrReplaceColumnDefinition(def);
  }
  return cfm.rebuild();
}
