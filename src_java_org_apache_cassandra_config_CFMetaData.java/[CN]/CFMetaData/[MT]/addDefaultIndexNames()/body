{
  UUID cfId=Schema.instance.getId(ksName,cfName);
  if (cfId != null) {
    CFMetaData cfm=Schema.instance.getCFMetaData(cfId);
    for (    ColumnDefinition newDef : allColumns()) {
      if (!cfm.columnMetadata.containsKey(newDef.name.bytes) || newDef.getIndexType() == null)       continue;
      String oldIndexName=cfm.getColumnDefinition(newDef.name).getIndexName();
      if (oldIndexName == null)       continue;
      if (newDef.getIndexName() != null && !oldIndexName.equals(newDef.getIndexName()))       throw new ConfigurationException("Can't modify index name: was '" + oldIndexName + "' changed to '"+ newDef.getIndexName()+ "'.");
      newDef.setIndexName(oldIndexName);
    }
  }
  Set<String> existingNames=existingIndexNames(null);
  for (  ColumnDefinition column : allColumns()) {
    if (column.getIndexType() != null && column.getIndexName() == null) {
      String baseName=getDefaultIndexName(cfName,column.name);
      String indexName=baseName;
      int i=0;
      while (existingNames.contains(indexName))       indexName=baseName + '_' + (++i);
      column.setIndexName(indexName);
    }
  }
}
