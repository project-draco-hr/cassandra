{
  socketChannel_=SocketChannel.open();
  socketChannel_.socket().bind(new InetSocketAddress(from,0));
  socketChannel_.configureBlocking(false);
  localEp_=from;
  remoteEp_=to;
  if (!socketChannel_.connect(new InetSocketAddress(remoteEp_,DatabaseDescriptor.getStoragePort()))) {
    key_=SelectorManager.getSelectorManager().register(socketChannel_,this,SelectionKey.OP_CONNECT);
  }
 else {
    key_=SelectorManager.getSelectorManager().register(socketChannel_,this,SelectionKey.OP_READ);
  }
  if ((pool != null && streaming) || (pool == null && !streaming))   throw new RuntimeException("Invalid configuration. You must either specify a pool or streaming, not both or neither.");
  if (pool != null)   pool_=pool;
  if (streaming) {
    bStream_=true;
    lock_=new ReentrantLock();
    condition_=lock_.newCondition();
  }
}
