{
  CompositesBuilder builder=new CompositesBuilder(ctype);
  int keyPosition=0;
  for (  Restriction r : restrictions) {
    ColumnDefinition def=r.getFirstColumn();
    if (keyPosition != def.position() || r.isContains())     break;
    if (r.isSlice()) {
      r.appendBoundTo(builder,bound,options);
      List<Composite> composites=filterAndSort(setEocs(r,bound,builder.build()));
      return Lists.transform(composites,new com.google.common.base.Function<Composite,Composite>(){
        @Override public Composite apply(        Composite composite){
          return composite.isEmpty() ? Composites.EMPTY : composite;
        }
      }
);
    }
    r.appendBoundTo(builder,bound,options);
    if (builder.hasMissingElements())     return Collections.emptyList();
    keyPosition=r.getLastColumn().position() + 1;
  }
  EOC eoc=!builder.hasRemaining() ? EOC.NONE : (bound.isEnd() ? EOC.END : EOC.START);
  return filterAndSort(builder.buildWithEOC(eoc));
}
