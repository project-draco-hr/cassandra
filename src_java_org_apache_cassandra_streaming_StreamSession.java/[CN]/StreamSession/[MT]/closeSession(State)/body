{
  state(finalState);
  if (finalState == State.FAILED) {
    for (    StreamTask task : Iterables.concat(receivers.values(),transfers.values()))     task.abort();
  }
  handler.close();
  Gossiper.instance.unregister(this);
  FailureDetector.instance.unregisterFailureDetectionEventListener(this);
  streamResult.handleSessionComplete(this);
}
