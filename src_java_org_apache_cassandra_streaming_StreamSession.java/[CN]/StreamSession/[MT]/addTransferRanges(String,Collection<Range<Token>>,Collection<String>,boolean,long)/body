{
  Collection<ColumnFamilyStore> stores=getColumnFamilyStores(keyspace,columnFamilies);
  if (flushTables)   flushSSTables(stores);
  List<Range<Token>> normalizedRanges=Range.normalize(ranges);
  List<SSTableStreamingSections> sections=getSSTableSectionsForRanges(normalizedRanges,stores,repairedAt,repairedAt != ActiveRepairService.UNREPAIRED_SSTABLE);
  try {
    addTransferFiles(sections);
  }
  finally {
    for (    SSTableStreamingSections release : sections)     release.ref.release();
  }
}
