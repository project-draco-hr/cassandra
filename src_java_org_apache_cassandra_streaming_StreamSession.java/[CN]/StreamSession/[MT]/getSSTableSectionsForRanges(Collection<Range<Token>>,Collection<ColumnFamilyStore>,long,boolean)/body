{
  Refs<SSTableReader> refs=new Refs<>();
  try {
    for (    ColumnFamilyStore cfStore : stores) {
      List<AbstractBounds<RowPosition>> rowBoundsList=new ArrayList<>(ranges.size());
      for (      Range<Token> range : ranges)       rowBoundsList.add(range.toRowBounds());
      refs.addAll(cfStore.selectAndReference(cfStore.viewFilter(rowBoundsList,!isIncremental)).refs);
    }
    List<SSTableStreamingSections> sections=new ArrayList<>(refs.size());
    for (    SSTableReader sstable : refs) {
      long repairedAt=overriddenRepairedAt;
      if (overriddenRepairedAt == ActiveRepairService.UNREPAIRED_SSTABLE)       repairedAt=sstable.getSSTableMetadata().repairedAt;
      sections.add(new SSTableStreamingSections(sstable,refs.get(sstable),sstable.getPositionsForRanges(ranges),sstable.estimatedKeysForRanges(ranges),repairedAt));
    }
    return sections;
  }
 catch (  Throwable t) {
    refs.release();
    throw t;
  }
}
