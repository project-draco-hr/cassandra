{
  Collection<ColumnFamilyStore> stores=new HashSet<>();
  if (columnFamilies.isEmpty()) {
    stores.addAll(Keyspace.open(keyspace).getColumnFamilyStores());
  }
 else {
    for (    String cf : columnFamilies)     stores.add(Keyspace.open(keyspace).getColumnFamilyStore(cf));
  }
  if (flushTables)   flushSSTables(stores);
  List<Range<Token>> normalizedRanges=Range.normalize(ranges);
  List<SSTableStreamingSections> sections=getSSTableSectionsForRanges(normalizedRanges,stores);
  try {
    addTransferFiles(sections);
  }
  finally {
    for (    SSTableStreamingSections release : sections)     release.sstable.releaseReference();
  }
}
