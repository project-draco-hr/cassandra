{
  Collection<ColumnFamilyStore> stores=new HashSet<>();
  if (columnFamilies.isEmpty()) {
    stores.addAll(Keyspace.open(keyspace).getColumnFamilyStores());
  }
 else {
    for (    String cf : columnFamilies)     stores.add(Keyspace.open(keyspace).getColumnFamilyStore(cf));
  }
  if (flushTables)   flushSSTables(stores);
  List<Range<Token>> normalizedRanges=Range.normalize(ranges);
  List<SSTableReader> sstables=Lists.newLinkedList();
  for (  ColumnFamilyStore cfStore : stores) {
    List<AbstractBounds<RowPosition>> rowBoundsList=Lists.newLinkedList();
    for (    Range<Token> range : normalizedRanges)     rowBoundsList.add(range.toRowBounds());
    ColumnFamilyStore.ViewFragment view=cfStore.markReferenced(rowBoundsList);
    sstables.addAll(view.sstables);
  }
  addTransferFiles(normalizedRanges,sstables);
}
