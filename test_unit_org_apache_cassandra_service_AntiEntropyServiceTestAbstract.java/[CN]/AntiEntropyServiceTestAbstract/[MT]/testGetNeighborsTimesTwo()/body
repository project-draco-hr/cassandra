{
  TokenMetadata tmd=StorageService.instance.getTokenMetadata();
  addTokens(2 * Table.open(tablename).getReplicationStrategy().getReplicationFactor());
  AbstractReplicationStrategy ars=Table.open(tablename).getReplicationStrategy();
  Set<InetAddress> expected=new HashSet<InetAddress>();
  for (  Range replicaRange : ars.getAddressRanges().get(FBUtilities.getLocalAddress())) {
    expected.addAll(ars.getRangeAddresses(tmd).get(replicaRange));
  }
  expected.remove(FBUtilities.getLocalAddress());
  Collection<Range> ranges=StorageService.instance.getLocalRanges(tablename);
  Set<InetAddress> neighbors=new HashSet<InetAddress>();
  for (  Range range : ranges) {
    neighbors.addAll(AntiEntropyService.getNeighbors(tablename,range));
  }
  assertEquals(expected,neighbors);
}
