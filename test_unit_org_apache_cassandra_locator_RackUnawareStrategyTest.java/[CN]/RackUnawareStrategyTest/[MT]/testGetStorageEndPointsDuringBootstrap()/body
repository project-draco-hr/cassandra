{
  TokenMetadata tmd=new TokenMetadata();
  IPartitioner partitioner=new RandomPartitioner();
  AbstractReplicationStrategy strategy=new RackUnawareStrategy(tmd,partitioner,3,7000);
  Token[] endPointTokens=new Token[5];
  Token[] keyTokens=new Token[5];
  for (int i=0; i < 5; i++) {
    endPointTokens[i]=new BigIntegerToken(String.valueOf(10 * i));
    keyTokens[i]=new BigIntegerToken(String.valueOf(10 * i + 5));
  }
  List<EndPoint> hosts=new ArrayList<EndPoint>();
  for (int i=0; i < endPointTokens.length; i++) {
    EndPoint ep=new EndPoint("127.0.0." + String.valueOf(i + 1),7001);
    tmd.update(endPointTokens[i],ep);
    hosts.add(ep);
  }
  Token bsToken=new BigIntegerToken(String.valueOf(25));
  EndPoint bootstrapEndPoint=new EndPoint("127.0.0.6",7001);
  tmd.update(bsToken,bootstrapEndPoint,true);
  for (int i=0; i < keyTokens.length; i++) {
    EndPoint[] endPoints=strategy.getWriteStorageEndPoints(keyTokens[i],strategy.getReadStorageEndPoints(keyTokens[i]));
    assertTrue(endPoints.length >= 3);
    List<EndPoint> endPointsList=Arrays.asList(endPoints);
    for (int j=0; j < 3; j++) {
      assertTrue(endPointsList.contains(hosts.get((i + j + 1) % hosts.size())));
    }
    if (i < 3)     assertTrue(endPointsList.contains(bootstrapEndPoint));
  }
}
