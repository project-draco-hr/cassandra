{
  String CONTENT="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam vitae.";
  File file=new File("testThrottledReadersAreNotCached");
  file.deleteOnExit();
  File metadata=new File(file.getPath() + ".meta");
  metadata.deleteOnExit();
  MetadataCollector sstableMetadataCollector=new MetadataCollector(new SimpleDenseCellNameType(BytesType.instance));
  try (SequentialWriter writer=new CompressedSequentialWriter(file,metadata.getPath(),new CompressionParameters(SnappyCompressor.instance),sstableMetadataCollector)){
    writer.write(CONTENT.getBytes());
    writer.finish();
  }
   CompressionMetadata meta=new CompressionMetadata(metadata.getPath(),file.length());
  try (ChannelProxy channel=new ChannelProxy(file);CompressedPoolingSegmentedFile segmentedFile=new CompressedPoolingSegmentedFile(channel,meta)){
    FileDataInput reader=segmentedFile.getSegment(0);
    assertNotNull(reader);
    reader.close();
    RateLimiter limiter=RateLimiter.create(1024);
    reader=segmentedFile.createThrottledReader(limiter);
    assertNotNull(reader);
    assertTrue(reader instanceof CompressedThrottledReader);
    reader.close();
    FileDataInput[] readers={segmentedFile.getSegment(0),segmentedFile.getSegment(0)};
    for (    FileDataInput r : readers) {
      assertNotNull(r);
      assertFalse(r instanceof CompressedThrottledReader);
    }
    for (    FileDataInput r : readers)     r.close();
  }
 }
