{
  SchemaLoader.cleanupAndLeaveDirs();
  DatabaseDescriptor.loadSchemas();
  assertEquals(0,Schema.instance.getNonSystemKeyspaces().size());
  Gossiper.instance.start((int)(System.currentTimeMillis() / 1000));
  try {
    MigrationManager.announceNewKeyspace(KSMetaData.testMetadata("ks0",SimpleStrategy.class,KSMetaData.optsWithRF(3)));
    MigrationManager.announceNewKeyspace(KSMetaData.testMetadata("ks1",SimpleStrategy.class,KSMetaData.optsWithRF(3)));
    assertNotNull(Schema.instance.getKSMetaData("ks0"));
    assertNotNull(Schema.instance.getKSMetaData("ks1"));
    Schema.instance.clearKeyspaceDefinition(Schema.instance.getKSMetaData("ks0"));
    Schema.instance.clearKeyspaceDefinition(Schema.instance.getKSMetaData("ks1"));
    assertNull(Schema.instance.getKSMetaData("ks0"));
    assertNull(Schema.instance.getKSMetaData("ks1"));
    DatabaseDescriptor.loadSchemas();
    assertNotNull(Schema.instance.getKSMetaData("ks0"));
    assertNotNull(Schema.instance.getKSMetaData("ks1"));
  }
  finally {
    Gossiper.instance.stop();
  }
}
