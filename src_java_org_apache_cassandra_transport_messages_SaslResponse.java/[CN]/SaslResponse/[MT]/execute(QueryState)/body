{
  try {
    SaslAuthenticator authenticator=((ServerConnection)connection).getAuthenticator();
    byte[] challenge=authenticator.evaluateResponse(token);
    if (authenticator.isComplete()) {
      AuthenticatedUser user=authenticator.getAuthenticatedUser();
      queryState.getClientState().login(user);
      return new ReadyMessage();
    }
 else {
      return new SaslChallenge(challenge);
    }
  }
 catch (  AuthenticationException e) {
    return ErrorMessage.fromException(e);
  }
}
