{
  Map<Token<?>,InetAddress> tokenMap=new HashMap<Token<?>,InetAddress>();
  int currentToken=TOKEN_STEP;
  for (int i=0; i < size; i++) {
    InetAddress endpoint=InetAddress.getByName("127.0.0." + String.valueOf(i + 1));
    Gossiper.instance.initializeNodeUnsafe(endpoint,UUID.randomUUID(),1);
    List<Token> tokens=new ArrayList<Token>();
    for (int j=0; j < TOKENS_PER_NODE; j++) {
      Token token=new BigIntegerToken(String.valueOf(currentToken));
      tokenMap.put(token,endpoint);
      tokens.add(token);
      currentToken+=TOKEN_STEP;
    }
    Gossiper.instance.injectApplicationState(endpoint,ApplicationState.TOKENS,vvFactory.tokens(tokens));
    StorageService.instance.onChange(endpoint,ApplicationState.STATUS,vvFactory.normal(tokens));
  }
  return tokenMap;
}
