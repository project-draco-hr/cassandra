{
  createInitialRing(5);
  InetAddress relocator=InetAddress.getByName("127.0.0.3");
  Token relocatee=new BigIntegerToken(String.valueOf(TOKEN_STEP));
  ss.onChange(relocator,ApplicationState.STATUS,vvFactory.relocating(Collections.singleton(relocatee)));
  assertTrue(tmd.isRelocating(relocatee));
  List<Token> tokens=new ArrayList<Token>(tmd.getTokens(relocator));
  tokens.add(relocatee);
  Gossiper.instance.injectApplicationState(relocator,ApplicationState.TOKENS,vvFactory.tokens(tokens));
  ss.onChange(relocator,ApplicationState.STATUS,vvFactory.normal(tokens));
  try {
    Thread.sleep(StorageService.RING_DELAY + 10);
  }
 catch (  InterruptedException e) {
    System.err.println("ACHTUNG! Interrupted; testRelocationSuccess() will almost certainly fail!");
  }
  assertTrue(!tmd.isRelocating(relocatee));
  assertEquals(tmd.getEndpoint(relocatee),relocator);
}
