{
  List<RawKeyspace> keyspaces=new ArrayList<RawKeyspace>();
  try {
    String endPointSnitchClassName=null;
    NodeList tablesxml=xmlUtils.getRequestedNodeList("/Storage/Keyspaces/Keyspace");
    String gcGrace=xmlUtils.getNodeValue("/Storage/GCGraceSeconds");
    int gc_grace_seconds=CFMetaData.DEFAULT_GC_GRACE_SECONDS;
    if (gcGrace != null)     gc_grace_seconds=Integer.parseInt(gcGrace);
    String lifetime=xmlUtils.getNodeValue("/Storage/MemtableFlushAfterMinutes");
    int memtime=CFMetaData.DEFAULT_MEMTABLE_LIFETIME_IN_MINS;
    if (lifetime != null)     memtime=Integer.parseInt(lifetime);
    String memtableSize=xmlUtils.getNodeValue("/Storage/MemtableThroughputInMB");
    int memsize=CFMetaData.DEFAULT_MEMTABLE_THROUGHPUT_IN_MB;
    if (memtableSize != null)     memsize=Integer.parseInt(memtableSize);
    String memtableOps=xmlUtils.getNodeValue("/Storage/MemtableOperationsInMillions");
    double memops=CFMetaData.DEFAULT_MEMTABLE_OPERATIONS_IN_MILLIONS;
    if (memtableOps != null)     memops=Double.parseDouble(memtableOps);
    int size=tablesxml.getLength();
    for (int i=0; i < size; ++i) {
      String value;
      RawKeyspace ks=new RawKeyspace();
      Node table=tablesxml.item(i);
      ks.name=XMLUtils.getAttributeValue(table,"Name");
      value=xmlUtils.getNodeValue("/Storage/Keyspaces/Keyspace[@Name='" + ks.name + "']/EndPointSnitch");
      if (endPointSnitchClassName == null) {
        endPointSnitchClassName=value;
      }
 else       if (!endPointSnitchClassName.equals(value)) {
        throw new ConfigurationException("ERROR : EndPointSnitch is global in 0.7 -- multiple choices present.");
      }
      ks.replica_placement_strategy=xmlUtils.getNodeValue("/Storage/Keyspaces/Keyspace[@Name='" + ks.name + "']/ReplicaPlacementStrategy");
      value=xmlUtils.getNodeValue("/Storage/Keyspaces/Keyspace[@Name='" + ks.name + "']/ReplicationFactor");
      if (value != null) {
        ks.replication_factor=Integer.parseInt(value);
      }
      String xqlTable="/Storage/Keyspaces/Keyspace[@Name='" + ks.name + "']/";
      NodeList columnFamilies=xmlUtils.getRequestedNodeList(xqlTable + "ColumnFamily");
      int size2=columnFamilies.getLength();
      ks.column_families=new RawColumnFamily[size2];
      for (int j=0; j < size2; ++j) {
        Node columnFamily=columnFamilies.item(j);
        ks.column_families[j]=new RawColumnFamily();
        ks.column_families[j].name=XMLUtils.getAttributeValue(columnFamily,"Name");
        String xqlCF=xqlTable + "ColumnFamily[@Name='" + ks.column_families[j].name+ "']/";
        ks.column_families[j].column_type=ColumnFamilyType.create(XMLUtils.getAttributeValue(columnFamily,"ColumnType"));
        ks.column_families[j].compare_with=XMLUtils.getAttributeValue(columnFamily,"CompareWith");
        if (ks.column_families[j].column_type != null && ks.column_families[j].column_type == ColumnFamilyType.Super)         ks.column_families[j].compare_subcolumns_with=XMLUtils.getAttributeValue(columnFamily,"CompareSubcolumnsWith");
        if ((value=XMLUtils.getAttributeValue(columnFamily,"KeysCached")) != null) {
          ks.column_families[j].keys_cached=FBUtilities.parseDoubleOrPercent(value);
        }
        if ((value=XMLUtils.getAttributeValue(columnFamily,"RowsCached")) != null) {
          ks.column_families[j].rows_cached=FBUtilities.parseDoubleOrPercent(value);
        }
        if ((value=XMLUtils.getAttributeValue(columnFamily,"RowCacheSavePeriodInSeconds")) != null) {
          ks.column_families[j].row_cache_save_period_in_seconds=Integer.parseInt(value);
        }
        if ((value=XMLUtils.getAttributeValue(columnFamily,"KeyCacheSavePeriodInSeconds")) != null) {
          ks.column_families[j].key_cache_save_period_in_seconds=Integer.parseInt(value);
        }
        if ((value=XMLUtils.getAttributeValue(columnFamily,"ReadRepairChance")) != null) {
          ks.column_families[j].read_repair_chance=FBUtilities.parseDoubleOrPercent(value);
        }
        ks.column_families[j].gc_grace_seconds=gc_grace_seconds;
        ks.column_families[j].memtable_flush_after_mins=memtime;
        ks.column_families[j].memtable_throughput_in_mb=memsize;
        ks.column_families[j].memtable_operations_in_millions=memops;
        ks.column_families[j].comment=xmlUtils.getNodeValue(xqlCF + "Comment");
      }
      keyspaces.add(ks);
    }
    if (endPointSnitchClassName.equals("org.apache.cassandra.locator.EndPointSnitch")) {
      endPointSnitchClassName="org.apache.cassandra.locator.RackInferringSnitch";
      System.out.println("WARN : org.apache.cassandra.locator.EndPointSnitch has been replaced by org.apache.cassandra.locator.RackInferringSnitch");
    }
 else     if (endPointSnitchClassName.equals("org.apache.cassandra.locator.PropertyFileEndpointSnitch")) {
      endPointSnitchClassName="org.apache.cassandra.locator.PropertyFileSnitch";
      System.out.println("WARN : org.apache.cassandra.locator.PropertyFileEndpointSnich has been replaced by org.apache.cassandra.locator.PropertyFileSnitch");
    }
 else {
      System.out.println("INFO : EndPointSnitch is global in 0.7 and may need to be updated.");
    }
    conf.endpoint_snitch=endPointSnitchClassName;
    return keyspaces;
  }
 catch (  XPathExpressionException e) {
    throw new ConfigurationException("XPath expression error.");
  }
catch (  TransformerException e) {
    throw new ConfigurationException("Error occurred during the transformation process.");
  }
}
