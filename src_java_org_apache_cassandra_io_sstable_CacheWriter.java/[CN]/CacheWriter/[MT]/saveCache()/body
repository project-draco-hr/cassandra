{
  long start=System.currentTimeMillis();
  logger.debug("Saving {}",path);
  File tmpFile=File.createTempFile(path.getName(),null,path.getParentFile());
  BufferedRandomAccessFile out=new BufferedRandomAccessFile(tmpFile,"w",BufferedRandomAccessFile.DEFAULT_BUFFER_SIZE,true);
  try {
    for (    K key : keys) {
      ByteBuffer bytes=converter.apply(key);
      ByteBufferUtil.writeWithLength(bytes,out);
      bytesWritten+=bytes.remaining();
    }
  }
  finally {
    out.close();
  }
  if (!tmpFile.renameTo(path))   throw new IOException("Unable to rename cache to " + path);
  logger.info(String.format("Saved %s (%d items) in %d ms",path.getName(),keys.size(),(System.currentTimeMillis() - start)));
}
