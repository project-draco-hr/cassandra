{
  List<ByteBuffer> variables=options.getValues();
  List<ByteBuffer> keys=buildPartitionKeyNames(variables);
  if (keys.size() > 1)   throw new InvalidRequestException("IN on the partition key is not supported with conditional updates");
  Composite clusteringPrefix=createClusteringPrefix(variables);
  ByteBuffer key=keys.get(0);
  ThriftValidation.validateKey(cfm,key);
  UpdateParameters updParams=new UpdateParameters(cfm,variables,queryState.getTimestamp(),getTimeToLive(variables),null);
  ColumnFamily updates=updateForKey(key,clusteringPrefix,updParams);
  UpdateParameters condParams=new UpdateParameters(cfm,variables,queryState.getTimestamp(),0,null);
  ColumnFamily expected=buildConditions(key,clusteringPrefix,condParams);
  ColumnFamily result=StorageProxy.cas(keyspace(),columnFamily(),key,clusteringPrefix,expected,updates,options.getSerialConsistency(),options.getConsistency());
  return new ResultMessage.Rows(buildCasResultSet(key,result));
}
