{
  CFDefinition cfDef=cf.metadata().getCfDef();
  Selection selection;
  if (columnsWithConditions == null) {
    selection=Selection.wildcard(cfDef);
  }
 else {
    Set<CFDefinition.Name> names=new LinkedHashSet<CFDefinition.Name>();
    if (isBatch) {
      names.addAll(cfDef.partitionKeys());
      names.addAll(cfDef.clusteringColumns());
    }
    for (    ColumnIdentifier id : columnsWithConditions)     names.add(cfDef.get(id));
    selection=Selection.forColumns(names);
  }
  long now=System.currentTimeMillis();
  Selection.ResultSetBuilder builder=selection.resultSetBuilder(now);
  SelectStatement.forSelection(cfDef,selection).processColumnFamily(key,cf,Collections.<ByteBuffer>emptyList(),now,builder);
  return builder.build();
}
