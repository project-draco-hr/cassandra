{
  logger.debug("Updating column {} definition for index {}",columnName,indexName);
  CFMetaData cfm=Schema.instance.getCFMetaData(keyspace(),columnFamily()).clone();
  CFDefinition cfDef=cfm.getCfDef();
  ColumnDefinition cd=cfm.getColumnDefinition(columnName.key);
  if (isCustom) {
    cd.setIndexType(IndexType.CUSTOM,Collections.singletonMap(SecondaryIndex.CUSTOM_INDEX_OPTION_NAME,indexClass));
  }
 else   if (cfDef.isComposite) {
    CompositeType composite=(CompositeType)cfm.comparator;
    Map<String,String> opts=new HashMap<String,String>();
    opts.put(CompositesIndex.PREFIX_SIZE_OPTION,String.valueOf(composite.types.size() - (cfDef.hasCollections ? 2 : 1)));
    cd.setIndexType(IndexType.COMPOSITES,opts);
  }
 else {
    cd.setIndexType(IndexType.KEYS,Collections.<String,String>emptyMap());
  }
  cd.setIndexName(indexName);
  cfm.addDefaultIndexNames();
  MigrationManager.announceColumnFamilyUpdate(cfm);
}
