{
  CFMetaData cfm=ThriftValidation.validateColumnFamily(keyspace(),columnFamily());
  ColumnDefinition cd=cfm.getColumnDefinition(columnName.key);
  if (cd == null)   throw new InvalidRequestException("No column definition found for column " + columnName);
  if (cd.getIndexType() != null)   throw new InvalidRequestException("Index already exists");
  if (cfm.getCfDef().isCompact && cd.type != ColumnDefinition.Type.REGULAR)   throw new InvalidRequestException(String.format("Secondary index on %s column %s is not yet supported for compact table",cd.type,columnName));
  if (cd.getValidator().isCollection())   throw new InvalidRequestException("Indexes on collections are no yet supported");
  if (cd.type == ColumnDefinition.Type.PARTITION_KEY && (cd.componentIndex == null || cd.componentIndex == 0))   throw new InvalidRequestException(String.format("Cannot add secondary index to already primarily indexed column %s",columnName));
  props.validate(isCustom);
}
