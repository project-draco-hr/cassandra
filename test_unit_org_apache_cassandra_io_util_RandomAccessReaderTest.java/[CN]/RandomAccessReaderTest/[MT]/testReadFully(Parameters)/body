{
  final File f=writeFile(params);
  try (ChannelProxy channel=new ChannelProxy(f)){
    RandomAccessReader.Builder builder=RandomAccessReader.builder(channel).bufferType(params.bufferType).bufferSize(params.bufferSize);
    MmappedRegions regions=null;
    if (params.mmappedRegions) {
      regions=MmappedRegions.map(channel,f.length());
      builder.regions(regions);
    }
    try (RandomAccessReader reader=builder.build()){
      assertEquals(f.getAbsolutePath(),reader.getPath());
      assertEquals(f.length(),reader.length());
      assertEquals(f.length(),reader.bytesRemaining());
      assertEquals(Math.min(Integer.MAX_VALUE,f.length()),reader.available());
      byte[] b=new byte[params.expected.length];
      long numRead=0;
      while (numRead < params.fileLength) {
        reader.readFully(b);
        assertTrue(Arrays.equals(params.expected,b));
        numRead+=b.length;
      }
      assertTrue(reader.isEOF());
      assertEquals(0,reader.bytesRemaining());
    }
     if (regions != null)     assertNull(regions.close(null));
  }
 }
