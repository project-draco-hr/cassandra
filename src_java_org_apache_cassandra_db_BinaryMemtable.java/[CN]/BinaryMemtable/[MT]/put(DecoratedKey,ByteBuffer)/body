{
  if (isThresholdViolated()) {
    lock.lock();
    try {
      if (!isFrozen) {
        isFrozen=true;
        cfs.submitFlush(this,new CountDownLatch(1));
        cfs.switchBinaryMemtable(key,buffer);
      }
 else {
        cfs.applyBinary(key,buffer);
      }
    }
  finally {
      lock.unlock();
    }
  }
 else {
    resolve(key,buffer);
  }
}
