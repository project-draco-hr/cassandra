{
  switchWriter(null);
  if (throwEarly)   throw new RuntimeException("exception thrown early in finish, for testing");
  for (  Finished f : finishedWriters) {
    if (f.reader != null)     discard.add(f.reader);
    f.writer.setRepairedAt(repairedAt).setMaxDataAge(maxAge).setOpenResult(true).prepareToCommit();
    SSTableReader newReader=f.writer.finished();
    if (f.reader != null)     f.reader.setReplacedBy(newReader);
    preparedForCommit.add(newReader);
  }
  if (throwLate)   throw new RuntimeException("exception thrown after all sstables finished, for testing");
}
