{
  DecoratedKey key=partition.partitionKey();
  maybeReopenEarly(key);
  RowIndexEntry index=writer.append(partition);
  if (!transaction.isOffline() && index != null) {
    boolean save=false;
    for (    SSTableReader reader : transaction.originals()) {
      if (reader.getCachedPosition(key,false) != null) {
        save=true;
        break;
      }
    }
    if (save)     cachedKeys.put(key,index);
  }
  return index;
}
