{
  byte[] body=message.getMessageBody();
  ByteArrayInputStream bufIn=new ByteArrayInputStream(body);
  if (logger.isDebugEnabled())   logger.debug(String.format("StreamInitiateVerbeHandler.doVerb %s %s %s",message.getVerb(),message.getMessageId(),message.getMessageType()));
  try {
    StreamInitiateMessage biMsg=StreamInitiateMessage.serializer().deserialize(new DataInputStream(bufIn));
    PendingFile[] pendingFiles=biMsg.getStreamContext();
    if (pendingFiles.length == 0) {
      if (logger.isDebugEnabled())       logger.debug("no data needed from " + message.getFrom());
      if (StorageService.instance.isBootstrapMode())       StorageService.instance.removeBootstrapSource(message.getFrom(),new String(message.getHeader(StreamOut.TABLE_NAME)));
      return;
    }
    Map<String,String> fileNames=getNewNames(pendingFiles);
    Map<String,String> pathNames=new HashMap<String,String>();
    for (    String ssName : fileNames.keySet())     pathNames.put(ssName,DatabaseDescriptor.getNextAvailableDataLocation());
    for (    PendingFile pendingFile : pendingFiles) {
      CompletedFileStatus streamStatus=new CompletedFileStatus(pendingFile.getTargetFile(),pendingFile.getExpectedBytes());
      String file=getNewFileNameFromOldContextAndNames(fileNames,pathNames,pendingFile);
      if (logger.isDebugEnabled())       logger.debug("Received Data from  : " + message.getFrom() + " "+ pendingFile.getTargetFile()+ " "+ file);
      pendingFile.setTargetFile(file);
      addStreamContext(message.getFrom(),pendingFile,streamStatus);
    }
    StreamInManager.registerStreamCompletionHandler(message.getFrom(),new StreamCompletionHandler());
    if (logger.isDebugEnabled())     logger.debug("Sending a stream initiate done message ...");
    Message doneMessage=new Message(FBUtilities.getLocalAddress(),"",StorageService.Verb.STREAM_INITIATE_DONE,new byte[0]);
    MessagingService.instance.sendOneWay(doneMessage,message.getFrom());
  }
 catch (  IOException ex) {
    throw new IOError(ex);
  }
}
