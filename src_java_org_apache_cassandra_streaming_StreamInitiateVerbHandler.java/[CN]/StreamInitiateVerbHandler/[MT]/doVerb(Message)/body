{
  byte[] body=message.getMessageBody();
  ByteArrayInputStream bufIn=new ByteArrayInputStream(body);
  if (logger.isDebugEnabled())   logger.debug(String.format("StreamInitiateVerbeHandler.doVerb %s %s %s",message.getVerb(),message.getMessageId(),message.getMessageType()));
  try {
    StreamInitiateMessage biMsg=StreamInitiateMessage.serializer().deserialize(new DataInputStream(bufIn));
    StreamContextManager.StreamContext[] streamContexts=biMsg.getStreamContext();
    if (streamContexts.length == 0) {
      if (logger.isDebugEnabled())       logger.debug("no data needed from " + message.getFrom());
      if (StorageService.instance.isBootstrapMode())       StorageService.instance.removeBootstrapSource(message.getFrom(),new String(message.getHeader(Streaming.TABLE_NAME)));
      return;
    }
    Map<String,String> fileNames=getNewNames(streamContexts);
    Map<String,String> pathNames=new HashMap<String,String>();
    for (    String ssName : fileNames.keySet())     pathNames.put(ssName,DatabaseDescriptor.getNextAvailableDataLocation());
    for (    StreamContextManager.StreamContext streamContext : streamContexts) {
      StreamContextManager.StreamStatus streamStatus=new StreamContextManager.StreamStatus(streamContext.getTargetFile(),streamContext.getExpectedBytes());
      String file=getNewFileNameFromOldContextAndNames(fileNames,pathNames,streamContext);
      if (logger.isDebugEnabled())       logger.debug("Received Data from  : " + message.getFrom() + " "+ streamContext.getTargetFile()+ " "+ file);
      streamContext.setTargetFile(file);
      addStreamContext(message.getFrom(),streamContext,streamStatus);
    }
    StreamContextManager.registerStreamCompletionHandler(message.getFrom(),new StreamCompletionHandler());
    if (logger.isDebugEnabled())     logger.debug("Sending a stream initiate done message ...");
    Message doneMessage=new Message(FBUtilities.getLocalAddress(),"",StorageService.Verb.STREAM_INITIATE_DONE,new byte[0]);
    MessagingService.instance.sendOneWay(doneMessage,message.getFrom());
  }
 catch (  IOException ex) {
    throw new IOError(ex);
  }
}
