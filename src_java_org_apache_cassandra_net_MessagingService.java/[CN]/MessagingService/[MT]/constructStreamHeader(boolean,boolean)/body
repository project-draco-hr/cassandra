{
  int n=0;
  n|=serializerType_.ordinal();
  if (compress)   n|=4;
  if (stream)   n|=8;
  n|=(version_ << 8);
  byte[] header=toByteArray(n);
  ByteBuffer buffer=ByteBuffer.allocate(16 + header.length);
  buffer.put(protocol_);
  buffer.put(header);
  buffer.flip();
  return buffer;
}
