{
  Collection<InetAddress> addresses=targets.get(messageId);
  if (addresses == null) {
    addresses=new NonBlockingHashSet<InetAddress>();
    Collection<InetAddress> oldAddresses=targets.putIfAbsent(messageId,addresses);
    if (oldAddresses != null)     addresses=oldAddresses;
  }
  addresses.add(endpoint);
}
