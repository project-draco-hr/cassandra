{
  ColumnStats.MinLongTracker minTimestampTracker=new ColumnStats.MinLongTracker(Long.MIN_VALUE);
  ColumnStats.MaxLongTracker maxTimestampTracker=new ColumnStats.MaxLongTracker(Long.MAX_VALUE);
  StreamingHistogram tombstones=new StreamingHistogram(SSTable.TOMBSTONE_HISTOGRAM_BIN_SIZE);
  ColumnStats.MaxIntTracker maxDeletionTimeTracker=new ColumnStats.MaxIntTracker(Integer.MAX_VALUE);
  List<ByteBuffer> minColumnNamesSeen=Collections.emptyList();
  List<ByteBuffer> maxColumnNamesSeen=Collections.emptyList();
  boolean hasLegacyCounterShards=false;
  if (deletionInfo().getTopLevelDeletion().localDeletionTime < Integer.MAX_VALUE) {
    tombstones.update(deletionInfo().getTopLevelDeletion().localDeletionTime);
    maxDeletionTimeTracker.update(deletionInfo().getTopLevelDeletion().localDeletionTime);
    minTimestampTracker.update(deletionInfo().getTopLevelDeletion().markedForDeleteAt);
    maxTimestampTracker.update(deletionInfo().getTopLevelDeletion().markedForDeleteAt);
  }
  Iterator<RangeTombstone> it=deletionInfo().rangeIterator();
  while (it.hasNext()) {
    RangeTombstone rangeTombstone=it.next();
    tombstones.update(rangeTombstone.getLocalDeletionTime());
    minTimestampTracker.update(rangeTombstone.timestamp());
    maxTimestampTracker.update(rangeTombstone.timestamp());
    maxDeletionTimeTracker.update(rangeTombstone.getLocalDeletionTime());
    minColumnNamesSeen=ColumnNameHelper.minComponents(minColumnNamesSeen,rangeTombstone.min,metadata.comparator);
    maxColumnNamesSeen=ColumnNameHelper.maxComponents(maxColumnNamesSeen,rangeTombstone.max,metadata.comparator);
  }
  for (  Cell cell : this) {
    minTimestampTracker.update(cell.timestamp());
    maxTimestampTracker.update(cell.timestamp());
    maxDeletionTimeTracker.update(cell.getLocalDeletionTime());
    int deletionTime=cell.getLocalDeletionTime();
    if (deletionTime < Integer.MAX_VALUE)     tombstones.update(deletionTime);
    minColumnNamesSeen=ColumnNameHelper.minComponents(minColumnNamesSeen,cell.name(),metadata.comparator);
    maxColumnNamesSeen=ColumnNameHelper.maxComponents(maxColumnNamesSeen,cell.name(),metadata.comparator);
    if (cell instanceof CounterCell)     hasLegacyCounterShards=hasLegacyCounterShards || ((CounterCell)cell).hasLegacyShards();
  }
  return new ColumnStats(getColumnCount(),minTimestampTracker.get(),maxTimestampTracker.get(),maxDeletionTimeTracker.get(),tombstones,minColumnNamesSeen,maxColumnNamesSeen,hasLegacyCounterShards);
}
