{
  FileOutputStream fos=new FileOutputStream(filterFilename());
  DataOutputStream stream=new DataOutputStream(fos);
  BloomFilter.serializer().serialize(bf,stream);
  stream.flush();
  fos.getFD().sync();
  stream.close();
  indexRAF.getChannel().force(true);
  indexRAF.close();
  dataWriter.close();
  rename(indexFilename());
  rename(filterFilename());
  dataFile=rename(dataFile);
  ConcurrentLinkedHashMap<String,Long> keyCache=cacheFraction > 0 ? SSTableReader.createKeyCache((int)(cacheFraction * keysWritten)) : null;
  return new SSTableReader(dataFile,partitioner,indexPositions,bf,keyCache);
}
