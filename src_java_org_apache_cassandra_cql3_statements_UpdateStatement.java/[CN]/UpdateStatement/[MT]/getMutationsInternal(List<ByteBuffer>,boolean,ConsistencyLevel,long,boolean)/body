{
  List<ByteBuffer> keys=buildKeyNames(cfDef,processedKeys,variables);
  ColumnNameBuilder builder=cfDef.getColumnNameBuilder();
  buildColumnNames(cfDef,processedKeys,builder,variables,true);
  Set<ByteBuffer> toRead=null;
  for (  Operation op : processedColumns) {
    if (op.requiresRead()) {
      if (toRead == null)       toRead=new TreeSet<ByteBuffer>(UTF8Type.instance);
      toRead.add(op.columnName.key);
    }
  }
  Map<ByteBuffer,ColumnGroupMap> rows=toRead != null ? readRows(keys,builder,toRead,(CompositeType)cfDef.cfm.comparator,local,cl) : null;
  Collection<IMutation> mutations=new LinkedList<IMutation>();
  UpdateParameters params=new UpdateParameters(cfDef.cfm,variables,getTimestamp(now),getTimeToLive(),rows);
  for (  ByteBuffer key : keys)   mutations.add(mutationForKey(cfDef,key,builder,params,cl,isBatch));
  return mutations;
}
