{
  SchemaKeyspace.makeCreateKeyspaceMutation(Schema.instance.getKSMetaData(KEYSPACE6),FBUtilities.timestampMicros()).applyUnsafe();
  ColumnFamilyStore cfs=Keyspace.open(KEYSPACE6).getColumnFamilyStore(TABLE1i);
  QueryProcessor.executeInternal(String.format("INSERT INTO %s.%s (key, c1, birthdate, notbirthdate) VALUES (?, ?, ?, ?)",KEYSPACE6,TABLE1i),"key0","col0",1L,1L);
  cfs.forceBlockingFlush();
  ColumnDefinition indexedColumn=cfs.metadata.getColumnDefinition(ByteBufferUtil.bytes("birthdate"));
  SecondaryIndex index=cfs.indexManager.getIndexForColumn(indexedColumn);
  ColumnFamilyStore indexedCfs=index.getIndexCfs();
  Descriptor desc=indexedCfs.getLiveSSTables().iterator().next().descriptor;
  CFMetaData meta=cfs.metadata.copy();
  IndexMetadata existing=meta.getIndexes().iterator().next();
  meta.indexes(meta.getIndexes().without(existing.name));
  MigrationManager.announceColumnFamilyUpdate(meta,false);
  assertTrue(cfs.indexManager.getIndexes().isEmpty());
  TransactionLog.waitForDeletions();
  assertFalse(new File(desc.filenameFor(Component.DATA)).exists());
}
