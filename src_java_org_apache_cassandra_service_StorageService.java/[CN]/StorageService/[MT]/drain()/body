{
  ExecutorService mutationStage=StageManager.getStage(Stage.MUTATION);
  if (mutationStage.isTerminated()) {
    logger_.warn("Cannot drain node (did it already happen?)");
    return;
  }
  setMode("Starting drain process",true);
  Gossiper.instance.stop();
  setMode("Draining: shutting down MessageService",false);
  MessagingService.shutdown();
  setMode("Draining: emptying MessageService pools",false);
  MessagingService.waitFor();
  setMode("Draining: clearing mutation stage",false);
  mutationStage.shutdown();
  mutationStage.awaitTermination(3600,TimeUnit.SECONDS);
  setMode("Draining: flushing column families",false);
  for (  String tableName : DatabaseDescriptor.getNonSystemTables())   for (  Future f : Table.open(tableName).flush())   f.get();
  ColumnFamilyStore.postFlushExecutor.shutdown();
  ColumnFamilyStore.postFlushExecutor.awaitTermination(60,TimeUnit.SECONDS);
  DeletionService.waitFor();
  setMode("Node is drained",true);
}
