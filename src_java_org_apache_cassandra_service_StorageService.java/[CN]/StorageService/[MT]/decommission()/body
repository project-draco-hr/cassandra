{
  if (!tokenMetadata_.isMember(FBUtilities.getLocalAddress()))   throw new UnsupportedOperationException("local node is not a member of the token ring yet");
  if (tokenMetadata_.cloneAfterAllLeft().sortedTokens().size() < 2)   throw new UnsupportedOperationException("no other normal nodes in the ring; decommission would be pointless");
  for (  String table : DatabaseDescriptor.getNonSystemTables()) {
    if (tokenMetadata_.getPendingRanges(table,FBUtilities.getLocalAddress()).size() > 0)     throw new UnsupportedOperationException("data is currently moving to this node; unable to leave the ring");
  }
  if (logger_.isDebugEnabled())   logger_.debug("DECOMMISSIONING");
  startLeaving();
  setMode("Leaving: sleeping " + RING_DELAY + " ms for pending range setup",true);
  Thread.sleep(RING_DELAY);
  Runnable finishLeaving=new Runnable(){
    public void run(){
      Gossiper.instance.stop();
      MessagingService.shutdown();
      StageManager.shutdownNow();
      setMode("Decommissioned",true);
    }
  }
;
  unbootstrap(finishLeaving);
}
