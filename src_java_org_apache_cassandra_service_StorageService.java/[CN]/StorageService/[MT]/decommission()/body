{
  if (!tokenMetadata.isMember(FBUtilities.getBroadcastAddress()))   throw new UnsupportedOperationException("local node is not a member of the token ring yet");
  if (tokenMetadata.cloneAfterAllLeft().sortedTokens().size() < 2)   throw new UnsupportedOperationException("no other normal nodes in the ring; decommission would be pointless");
  if (operationMode != Mode.NORMAL)   throw new UnsupportedOperationException("Node in " + operationMode + " state; wait for status to become normal or restart");
  PendingRangeCalculatorService.instance.blockUntilFinished();
  for (  String keyspaceName : Schema.instance.getNonSystemKeyspaces()) {
    if (tokenMetadata.getPendingRanges(keyspaceName,FBUtilities.getBroadcastAddress()).size() > 0)     throw new UnsupportedOperationException("data is currently moving to this node; unable to leave the ring");
  }
  if (logger.isDebugEnabled())   logger.debug("DECOMMISSIONING");
  startLeaving();
  long timeout=Math.max(RING_DELAY,BatchlogManager.instance.getBatchlogTimeout());
  setMode(Mode.LEAVING,"sleeping " + timeout + " ms for batch processing and pending range setup",true);
  Thread.sleep(timeout);
  Runnable finishLeaving=new Runnable(){
    public void run(){
      shutdownClientServers();
      Gossiper.instance.stop();
      MessagingService.instance().shutdown();
      StageManager.shutdownNow();
      setMode(Mode.DECOMMISSIONED,true);
    }
  }
;
  unbootstrap(finishLeaving);
}
