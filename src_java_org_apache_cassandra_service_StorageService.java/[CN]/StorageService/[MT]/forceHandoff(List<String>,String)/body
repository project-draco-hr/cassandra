{
  List<File> filesList=new ArrayList<File>();
  List<StreamContextManager.StreamContext> streamContexts=new ArrayList<StreamContextManager.StreamContext>();
  for (  String dataDir : dataDirectories) {
    File directory=new File(dataDir);
    Collections.addAll(filesList,directory.listFiles());
    for (    File tableDir : directory.listFiles()) {
      String tableName=tableDir.getName();
      for (      File file : tableDir.listFiles()) {
        streamContexts.add(new StreamContextManager.StreamContext(file.getAbsolutePath(),file.length(),tableName));
        if (logger_.isDebugEnabled())         logger_.debug("Stream context metadata " + streamContexts);
      }
    }
  }
  if (streamContexts.size() > 0) {
    EndPoint target=new EndPoint(host,DatabaseDescriptor.getStoragePort());
    final StreamContextManager.StreamContext[] contexts=streamContexts.toArray(new StreamContextManager.StreamContext[streamContexts.size()]);
    StreamManager.instance(target).addFilesToStream(contexts);
    final StreamContextManager.StreamContext[] bootContexts=streamContexts.toArray(new StreamContextManager.StreamContext[streamContexts.size()]);
    BootstrapInitiateMessage biMessage=new BootstrapInitiateMessage(bootContexts);
    Message message=BootstrapInitiateMessage.makeBootstrapInitiateMessage(biMessage);
    if (logger_.isDebugEnabled())     logger_.debug("Sending a bootstrap initiate message to " + target + " ...");
    MessagingService.instance().sendOneWay(message,target);
    if (logger_.isDebugEnabled())     logger_.debug("Waiting for transfer to " + target + " to complete");
    StreamManager.instance(target).waitForStreamCompletion();
    if (logger_.isDebugEnabled())     logger_.debug("Done with transfer to " + target);
  }
}
