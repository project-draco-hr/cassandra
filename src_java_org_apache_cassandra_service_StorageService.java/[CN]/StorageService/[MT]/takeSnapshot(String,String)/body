{
  if (tag == null || tag.equals(""))   throw new IOException("You must supply a snapshot name.");
  Iterable<Table> tables;
  if (tableNames.length == 0) {
    tables=Table.all();
  }
 else {
    ArrayList<Table> t=new ArrayList<Table>(tableNames.length);
    for (    String table : tableNames)     t.add(getValidTable(table));
    tables=t;
  }
  for (  Table table : tables)   if (table.snapshotExists(tag))   throw new IOException("Snapshot " + tag + " already exists.");
  for (  Table table : tables)   table.snapshot(tag);
}
