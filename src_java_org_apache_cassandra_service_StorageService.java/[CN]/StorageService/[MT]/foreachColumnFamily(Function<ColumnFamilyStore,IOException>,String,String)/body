{
  if (DatabaseDescriptor.getTable(tableName) == null) {
    throw new IOException("Table " + tableName + "does not exist");
  }
  Table table=Table.open(tableName);
  Set<String> positiveColumnFamilies=table.getColumnFamilies();
  if (columnFamilies == null || columnFamilies.length == 0) {
    columnFamilies=positiveColumnFamilies.toArray(new String[positiveColumnFamilies.size()]);
  }
  for (  String columnFamily : columnFamilies) {
    if (positiveColumnFamilies.contains(columnFamily)) {
      ColumnFamilyStore cfStore=table.getColumnFamilyStore(columnFamily);
      IOException result=function.apply(cfStore);
      if (result != null)       throw result;
    }
 else {
      logger_.warn(String.format("Invalid column family specified: %s. Proceeding with others.",columnFamily));
    }
  }
}
