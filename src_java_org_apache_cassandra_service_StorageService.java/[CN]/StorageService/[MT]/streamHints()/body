{
  ColumnFamilyStore hintsCF=Keyspace.open(SystemKeyspace.NAME).getColumnFamilyStore(SystemKeyspace.LEGACY_HINTS);
  FBUtilities.waitOnFuture(hintsCF.forceFlush());
  List<InetAddress> candidates=new ArrayList<>(StorageService.instance.getTokenMetadata().cloneAfterAllLeft().getAllEndpoints());
  candidates.remove(FBUtilities.getBroadcastAddress());
  for (Iterator<InetAddress> iter=candidates.iterator(); iter.hasNext(); ) {
    InetAddress address=iter.next();
    if (!FailureDetector.instance.isAlive(address))     iter.remove();
  }
  if (candidates.isEmpty()) {
    logger.warn("Unable to stream hints since no live endpoints seen");
    return Futures.immediateFuture(null);
  }
 else {
    DatabaseDescriptor.getEndpointSnitch().sortByProximity(FBUtilities.getBroadcastAddress(),candidates);
    InetAddress hintsDestinationHost=candidates.get(0);
    InetAddress preferred=SystemKeyspace.getPreferredIP(hintsDestinationHost);
    Token token=tokenMetadata.partitioner.getMinimumToken();
    List<Range<Token>> ranges=Collections.singletonList(new Range<>(token,token));
    return new StreamPlan("Hints").transferRanges(hintsDestinationHost,preferred,SystemKeyspace.NAME,ranges,SystemKeyspace.LEGACY_HINTS).execute();
  }
}
