{
  if (HintedHandOffManager.instance.listEndpointsPendingHints().size() == 0)   return Futures.immediateFuture(null);
  List<InetAddress> candidates=new ArrayList<InetAddress>(StorageService.instance.getTokenMetadata().cloneAfterAllLeft().getAllEndpoints());
  candidates.remove(FBUtilities.getBroadcastAddress());
  for (Iterator<InetAddress> iter=candidates.iterator(); iter.hasNext(); ) {
    InetAddress address=iter.next();
    if (!FailureDetector.instance.isAlive(address))     iter.remove();
  }
  if (candidates.isEmpty()) {
    logger.warn("Unable to stream hints since no live endpoints seen");
    return Futures.immediateFuture(null);
  }
 else {
    DatabaseDescriptor.getEndpointSnitch().sortByProximity(FBUtilities.getBroadcastAddress(),candidates);
    InetAddress hintsDestinationHost=candidates.get(0);
    Token token=StorageService.getPartitioner().getMinimumToken();
    List<Range<Token>> ranges=Collections.singletonList(new Range<Token>(token,token));
    return new StreamPlan("Hints").transferRanges(hintsDestinationHost,Table.SYSTEM_KS,ranges,SystemTable.HINTS_CF).execute();
  }
}
