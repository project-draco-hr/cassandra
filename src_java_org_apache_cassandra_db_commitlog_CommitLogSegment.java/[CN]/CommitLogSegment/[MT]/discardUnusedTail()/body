{
  OpOrder.Group group=appendOrder.start();
  try {
    while (true) {
      int prev=allocatePosition.get();
      int next=buffer.capacity() + 1;
      if (prev == next)       return;
      if (allocatePosition.compareAndSet(prev,next)) {
        discardedTailFrom=prev;
        return;
      }
    }
  }
  finally {
    group.finishOne();
  }
}
