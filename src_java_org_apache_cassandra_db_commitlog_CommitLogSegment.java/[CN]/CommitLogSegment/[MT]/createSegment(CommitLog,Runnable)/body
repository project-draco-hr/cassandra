{
  CommitLogSegment segment=commitLog.encryptionContext.isEnabled() ? new EncryptedSegment(commitLog,commitLog.encryptionContext,onClose) : commitLog.compressor != null ? new CompressedSegment(commitLog,onClose) : new MemoryMappedSegment(commitLog);
  segment.writeLogHeader();
  return segment;
}
