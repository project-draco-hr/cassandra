{
  Configuration config=commitLog.configuration;
  CommitLogSegment segment=config.useEncryption() ? new EncryptedSegment(commitLog,onClose) : config.useCompression() ? new CompressedSegment(commitLog,onClose) : new MemoryMappedSegment(commitLog);
  segment.writeLogHeader();
  return segment;
}
