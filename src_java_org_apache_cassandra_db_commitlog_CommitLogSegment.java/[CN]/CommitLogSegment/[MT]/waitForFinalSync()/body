{
  while (true) {
    WaitQueue.Signal signal=syncComplete.register();
    if (lastSyncedOffset < buffer.capacity()) {
      signal.awaitUninterruptibly();
    }
 else {
      signal.cancel();
      break;
    }
  }
}
