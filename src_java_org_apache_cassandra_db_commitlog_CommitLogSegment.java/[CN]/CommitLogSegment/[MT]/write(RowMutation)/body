{
  long currentPosition=-1L;
  try {
    ReplayPosition cLogCtx=getContext();
    for (    ColumnFamily columnFamily : rowMutation.getColumnFamilies()) {
      CFMetaData cfm=Schema.instance.getCFMetaData(columnFamily.id());
      if (cfm == null) {
        logger.error("Attempted to write commit log entry for unrecognized column family: " + columnFamily.id());
      }
 else {
        turnOn(cfm.cfId,(int)currentPosition);
      }
    }
    Checksum checksum=new CRC32();
    byte[] serializedRow=rowMutation.getSerializedBuffer(MessagingService.version_);
    checksum.update(serializedRow.length);
    logWriter.stream.writeInt(serializedRow.length);
    logWriter.stream.writeLong(checksum.getValue());
    logWriter.write(serializedRow);
    checksum.update(serializedRow,0,serializedRow.length);
    logWriter.stream.writeLong(checksum.getValue());
    return cLogCtx;
  }
 catch (  IOException e) {
    if (currentPosition != -1)     logWriter.truncate(currentPosition);
    throw e;
  }
}
