{
  Configuration config=commitLog.configuration;
  CommitLogSegment segment=config.useEncryption() ? new EncryptedSegment(commitLog,manager,onClose) : config.useCompression() ? new CompressedSegment(commitLog,manager,onClose) : new MemoryMappedSegment(commitLog,manager);
  segment.writeLogHeader();
  return segment;
}
