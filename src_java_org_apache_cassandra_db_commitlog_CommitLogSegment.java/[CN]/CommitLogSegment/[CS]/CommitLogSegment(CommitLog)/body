{
  this.commitLog=commitLog;
  id=getNextId();
  descriptor=new CommitLogDescriptor(id,commitLog.compressorClass);
  logFile=new File(commitLog.location,descriptor.fileName());
  try {
    channel=FileChannel.open(logFile.toPath(),StandardOpenOption.WRITE,StandardOpenOption.READ,StandardOpenOption.CREATE);
    fd=CLibrary.getfd(channel);
  }
 catch (  IOException e) {
    throw new FSWriteError(e,logFile);
  }
  buffer=createBuffer(commitLog);
  CommitLogDescriptor.writeHeader(buffer,descriptor);
  endOfBuffer=buffer.capacity();
  lastSyncedOffset=buffer.position();
  allocatePosition.set(lastSyncedOffset + SYNC_MARKER_SIZE);
}
