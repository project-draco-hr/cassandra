{
  Map<Descriptor,Pair<SSTableMetadata,Set<Integer>>> beforeMigration=new HashMap<>();
  for (int i=0; i <= 2; i++) {
    Descriptor descriptor=Descriptor.fromFilename(destDir + File.separator + KS+ "-"+ CF+ "-"+ LEGACY_VERSION+ "-"+ i+ "-Statistics.db");
    beforeMigration.put(descriptor,SSTableMetadata.serializer.deserialize(descriptor,false));
  }
  LegacyLeveledManifest.migrateManifests(KS,CF);
  for (  Map.Entry<Descriptor,Pair<SSTableMetadata,Set<Integer>>> entry : beforeMigration.entrySet()) {
    Pair<SSTableMetadata,Set<Integer>> newMetaPair=SSTableMetadata.serializer.deserialize(entry.getKey());
    SSTableMetadata newMetadata=newMetaPair.left;
    SSTableMetadata oldMetadata=entry.getValue().left;
    assertEquals(newMetadata.estimatedRowSize,oldMetadata.estimatedRowSize);
    assertEquals(newMetadata.estimatedColumnCount,oldMetadata.estimatedColumnCount);
    assertEquals(newMetadata.replayPosition,oldMetadata.replayPosition);
    assertEquals(newMetadata.minTimestamp,oldMetadata.minTimestamp);
    assertEquals(newMetadata.maxTimestamp,oldMetadata.maxTimestamp);
    assertEquals(newMetadata.compressionRatio,oldMetadata.compressionRatio,0.01);
    assertEquals(newMetadata.partitioner,oldMetadata.partitioner);
    assertEquals(newMetadata.estimatedTombstoneDropTime,oldMetadata.estimatedTombstoneDropTime);
    assertEquals(entry.getValue().right,newMetaPair.right);
  }
}
