{
  if (user.isSuper())   return Permission.ALL;
  UntypedResultSet rows;
  try {
    rows=process(String.format("SELECT permissions FROM %s.%s WHERE username = '%s' AND resource = '%s'",Auth.AUTH_KS,PERMISSIONS_CF,escape(user.getName()),escape(resource.getName())));
  }
 catch (  RequestExecutionException e) {
    logger.warn("CassandraAuthorizer failed to authorize {} for {}",user,resource);
    return Permission.NONE;
  }
  if (rows.isEmpty() || !rows.one().has(PERMISSIONS))   return Permission.NONE;
  Set<Permission> permissions=EnumSet.noneOf(Permission.class);
  for (  String perm : rows.one().getSet(PERMISSIONS,UTF8Type.instance))   permissions.add(Permission.valueOf(perm));
  return permissions;
}
