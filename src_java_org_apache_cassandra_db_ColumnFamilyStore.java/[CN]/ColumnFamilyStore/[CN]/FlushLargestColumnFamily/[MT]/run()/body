{
  float largestRatio=0f;
  Memtable largest=null;
  for (  ColumnFamilyStore cfs : ColumnFamilyStore.all()) {
    Memtable current=cfs.getDataTracker().getView().getCurrentMemtable();
    float onHeap=0f, offHeap=0f;
    onHeap+=current.getAllocator().onHeap().ownershipRatio();
    offHeap+=current.getAllocator().offHeap().ownershipRatio();
    for (    SecondaryIndex index : cfs.indexManager.getIndexes()) {
      if (index.getAllocator() != null) {
        onHeap+=index.getAllocator().onHeap().ownershipRatio();
        offHeap+=index.getAllocator().offHeap().ownershipRatio();
      }
    }
    float ratio=Math.max(onHeap,offHeap);
    if (ratio > largestRatio) {
      largest=current;
      largestRatio=ratio;
    }
  }
  if (largest != null)   largest.cfs.switchMemtableIfCurrent(largest);
}
