{
  final DecoratedKey startWithDK=partitioner.decorateKey(startWith);
  final DecoratedKey stopAtDK=partitioner.decorateKey(stopAt);
  final Comparator<DecoratedKey> comparator=partitioner.getDecoratedKeyComparator();
  List<Iterator<DecoratedKey>> iterators=new ArrayList<Iterator<DecoratedKey>>();
  Predicate<DecoratedKey> p=new Predicate<DecoratedKey>(){
    public boolean apply(    DecoratedKey key){
      return comparator.compare(startWithDK,key) <= 0 && (stopAt.isEmpty() || comparator.compare(key,stopAtDK) <= 0);
    }
  }
;
  iterators.add(Iterators.filter(memtableKeyIterator(),p));
  for (  Memtable memtable : ColumnFamilyStore.getUnflushedMemtables(columnFamily_)) {
    iterators.add(Iterators.filter(memtable.getKeyIterator(),p));
  }
  for (  SSTableReader sstable : ssTables_) {
    final SSTableScanner scanner=sstable.getScanner();
    scanner.seekTo(startWithDK);
    Iterator<DecoratedKey> iter=new Iterator<DecoratedKey>(){
      public boolean hasNext(){
        return scanner.hasNext();
      }
      public DecoratedKey next(){
        return scanner.next().getKey();
      }
      public void remove(){
        throw new UnsupportedOperationException();
      }
    }
;
    iterators.add(iter);
  }
  Iterator<DecoratedKey> collated=IteratorUtils.collatedIterator(comparator,iterators);
  Iterable<DecoratedKey> reduced=new ReducingIterator<DecoratedKey,DecoratedKey>(collated){
    DecoratedKey current;
    public void reduce(    DecoratedKey current){
      this.current=current;
    }
    protected DecoratedKey getReduced(){
      return current;
    }
  }
;
  try {
    List<String> keys=new ArrayList<String>();
    boolean rangeCompletedLocally=false;
    for (    DecoratedKey current : reduced) {
      if (!stopAt.isEmpty() && comparator.compare(stopAtDK,current) < 0) {
        rangeCompletedLocally=true;
        break;
      }
      QueryFilter filter=new SliceQueryFilter(current.key,new QueryPath(columnFamily_),ArrayUtils.EMPTY_BYTE_ARRAY,ArrayUtils.EMPTY_BYTE_ARRAY,false,1);
      if (getColumnFamily(filter,Integer.MAX_VALUE) != null) {
        keys.add(current.key);
      }
      if (keys.size() >= maxResults) {
        rangeCompletedLocally=true;
        break;
      }
    }
    return new RangeReply(keys,rangeCompletedLocally);
  }
  finally {
    for (    Iterator iter : iterators) {
      if (iter instanceof Closeable) {
        ((Closeable)iter).close();
      }
    }
  }
}
