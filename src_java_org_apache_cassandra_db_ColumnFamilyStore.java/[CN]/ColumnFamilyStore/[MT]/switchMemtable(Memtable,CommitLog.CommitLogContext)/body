{
  memtableLock_.writeLock().lock();
  try {
    if (oldMemtable.isFrozen()) {
      return;
    }
    logger_.info(columnFamily_ + " has reached its threshold; switching in a fresh Memtable");
    oldMemtable.freeze();
    getMemtablesPendingFlushNotNull(columnFamily_).add(oldMemtable);
    submitFlush(oldMemtable,ctx);
    memtable_=new Memtable(table_,columnFamily_);
  }
  finally {
    memtableLock_.writeLock().unlock();
  }
  if (memtableSwitchCount == Integer.MAX_VALUE) {
    memtableSwitchCount=0;
  }
  memtableSwitchCount++;
}
