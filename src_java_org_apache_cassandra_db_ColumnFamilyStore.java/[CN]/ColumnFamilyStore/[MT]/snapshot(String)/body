{
  try {
    forceBlockingFlush();
  }
 catch (  ExecutionException e) {
    throw new RuntimeException(e);
  }
catch (  InterruptedException e) {
    throw new AssertionError(e);
  }
  for (  SSTableReader ssTable : ssTables) {
    try {
      File dataDirectory=ssTable.getDescriptor().directory.getParentFile();
      String snapshotDirectoryPath=Table.getSnapshotPath(dataDirectory.getAbsolutePath(),table.name,snapshotName);
      FileUtils.createDirectory(snapshotDirectoryPath);
      for (      Component component : ssTable.getComponents()) {
        File sourceFile=new File(ssTable.getDescriptor().filenameFor(component));
        File targetLink=new File(snapshotDirectoryPath,sourceFile.getName());
        FileUtils.createHardLink(sourceFile,targetLink);
      }
      if (logger.isDebugEnabled())       logger.debug("Snapshot for " + table + " keyspace data file "+ ssTable.getFilename()+ " created in "+ snapshotDirectoryPath);
    }
 catch (    IOException e) {
      throw new IOError(e);
    }
  }
}
