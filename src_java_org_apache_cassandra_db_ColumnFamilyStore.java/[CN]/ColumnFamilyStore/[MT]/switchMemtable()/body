{
synchronized (data) {
    if (previousFlushFailure != null)     throw new IllegalStateException("A flush previously failed with the error below. To prevent data loss, " + "no flushes can be carried out until the node is restarted.",previousFlushFailure);
    logFlush();
    Flush flush=new Flush(false);
    ListenableFutureTask<?> flushTask=ListenableFutureTask.create(flush,null);
    flushExecutor.submit(flushTask);
    ListenableFutureTask<?> task=ListenableFutureTask.create(flush.postFlush,null);
    postFlushExecutor.submit(task);
    @SuppressWarnings("unchecked") ListenableFuture<?> future=Futures.allAsList(flushTask,task);
    return future;
  }
}
