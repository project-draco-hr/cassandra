{
  long failingSince=-1L;
  while (true) {
    ViewFragment view=select(filter);
    Refs<SSTableReader> refs=Refs.tryRef(view.sstables);
    if (refs != null)     return new RefViewFragment(view.sstables,view.memtables,refs);
    if (failingSince <= 0) {
      failingSince=System.nanoTime();
    }
 else     if (System.nanoTime() - failingSince > TimeUnit.MILLISECONDS.toNanos(100)) {
      List<SSTableReader> released=new ArrayList<>();
      for (      SSTableReader reader : view.sstables)       if (reader.selfRef().globalCount() == 0)       released.add(reader);
      NoSpamLogger.log(logger,NoSpamLogger.Level.WARN,1,TimeUnit.SECONDS,"Spinning trying to capture readers {}, released: {}, ",view.sstables,released);
      failingSince=System.nanoTime();
    }
  }
}
