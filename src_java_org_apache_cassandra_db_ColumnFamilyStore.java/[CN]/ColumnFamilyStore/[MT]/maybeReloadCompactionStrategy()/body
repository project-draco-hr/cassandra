{
  if (metadata.compactionStrategyClass.equals(compactionStrategy.getClass()) && metadata.compactionStrategyOptions.equals(compactionStrategy.getOptions()))   return;
  CompactionManager.instance.getCompactionLock().lock();
  try {
    compactionStrategy.shutdown();
    compactionStrategy=metadata.createCompactionStrategyInstance(this);
  }
  finally {
    CompactionManager.instance.getCompactionLock().unlock();
  }
}
