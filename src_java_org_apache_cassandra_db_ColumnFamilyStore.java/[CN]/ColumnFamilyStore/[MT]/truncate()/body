{
  logger.debug("truncating {}",columnFamily);
  forceBlockingFlush();
  CommitLog.instance.forceNewSegment();
  ReplayPosition position=CommitLog.instance.getContext();
  for (  ColumnFamilyStore cfs : ColumnFamilyStore.all())   cfs.forceFlush();
  waitForActiveFlushes();
  CommitLog.instance.discardCompletedSegments(metadata.cfId,position);
  try {
    Thread.sleep(100);
  }
 catch (  InterruptedException e) {
    throw new AssertionError(e);
  }
  long truncatedAt=System.currentTimeMillis();
  if (DatabaseDescriptor.isAutoSnapshot())   snapshot(Table.getTimestampedSnapshotName(columnFamily));
  return CompactionManager.instance.submitTruncate(this,truncatedAt);
}
