{
  CommitLog.instance.forceNewSegment();
  waitForActiveFlushes();
  List<Future<?>> futures=new ArrayList<Future<?>>();
  ReplayPosition position=CommitLog.instance.getContext();
  for (  ColumnFamilyStore cfs : ColumnFamilyStore.all()) {
    Future<?> f=cfs.forceFlush();
    if (f != null)     futures.add(f);
  }
  FBUtilities.waitOnFutures(futures);
  CommitLog.instance.discardCompletedSegments(metadata.cfId,position);
  try {
    Thread.sleep(100);
  }
 catch (  InterruptedException e) {
    throw new AssertionError(e);
  }
  long truncatedAt=System.currentTimeMillis();
  snapshot(Table.getTimestampedSnapshotName("before-truncate"));
  return CompactionManager.instance.submitTruncate(this,truncatedAt);
}
