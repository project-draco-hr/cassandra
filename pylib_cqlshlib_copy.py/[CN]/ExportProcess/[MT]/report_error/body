def report_error(self, err, token_range=None):
    if isinstance(err, str):
        msg = err
    elif isinstance(err, BaseException):
        msg = ('%s - %s' % (err.__class__.__name__, err))
        if self.debug:
            traceback.print_exc(err)
    else:
        msg = str(err)
    self.printmsg(msg)
    self.outmsg.put((token_range, Exception(msg)))
