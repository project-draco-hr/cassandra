{
  Mutation result=new Mutation(getKeyspaceName(),key());
  Keyspace keyspace=Keyspace.open(getKeyspaceName());
  int count=0;
  for (  ColumnFamily cf : getColumnFamilies())   count+=cf.getColumnCount();
  List<Lock> locks=new ArrayList<>(count);
  Tracing.trace("Acquiring {} counter locks",count);
  try {
    grabCounterLocks(keyspace,locks);
    for (    ColumnFamily cf : getColumnFamilies())     result.add(processModifications(cf));
    result.apply();
    updateCounterCache(result,keyspace);
    return result;
  }
  finally {
    for (    Lock lock : locks)     lock.unlock();
  }
}
