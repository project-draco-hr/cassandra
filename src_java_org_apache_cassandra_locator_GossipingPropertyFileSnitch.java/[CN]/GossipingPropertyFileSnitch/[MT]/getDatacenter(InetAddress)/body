{
  if (endpoint.equals(FBUtilities.getBroadcastAddress()))   return myDC;
  EndpointState epState=Gossiper.instance.getEndpointStateForEndpoint(endpoint);
  if (epState == null || epState.getApplicationState(ApplicationState.DC) == null) {
    if (psnitch == null) {
      if (savedEndpoints == null)       savedEndpoints=SystemTable.loadDcRackInfo();
      if (savedEndpoints.containsKey(endpoint))       return savedEndpoints.get(endpoint).get("data_center");
      throw new RuntimeException("Could not retrieve DC for " + endpoint + " from gossip and PFS compatibility is disabled");
    }
 else     return psnitch.getDatacenter(endpoint);
  }
  return epState.getApplicationState(ApplicationState.DC).value;
}
