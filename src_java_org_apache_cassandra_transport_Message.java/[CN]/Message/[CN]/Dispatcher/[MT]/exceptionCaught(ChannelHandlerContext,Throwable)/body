{
  if (ctx.channel().isOpen()) {
    ChannelFuture future=ctx.channel().writeAndFlush(ErrorMessage.fromException(cause));
    if (cause instanceof ProtocolException) {
      future.addListener(new ChannelFutureListener(){
        public void operationComplete(        ChannelFuture future){
          ctx.channel().close();
        }
      }
);
    }
  }
}
