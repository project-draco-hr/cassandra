{
  if (logger_.isDebugEnabled())   logger_.debug("Started hinted handoff for endPoint " + endPoint);
  String targetEPBytes=endPoint.getHost();
  Table systemTable=Table.open(Table.SYSTEM_TABLE);
  for (  String tableName : DatabaseDescriptor.getTables()) {
    ColumnFamily hintedColumnFamily=systemTable.get(tableName,HINTS_CF);
    if (hintedColumnFamily == null) {
      continue;
    }
    Collection<IColumn> keys=hintedColumnFamily.getSortedColumns();
    for (    IColumn keyColumn : keys) {
      String keyStr=new String(keyColumn.name(),"UTF-8");
      Collection<IColumn> endpoints=keyColumn.getSubColumns();
      for (      IColumn hintEndPoint : endpoints) {
        if (new String(hintEndPoint.name(),"UTF-8").equals(targetEPBytes) && sendMessage(endPoint.getHost(),null,keyStr)) {
          if (endpoints.size() == 1) {
            deleteHintKey(tableName,keyColumn.name());
          }
 else {
            deleteEndPoint(hintEndPoint.name(),tableName,keyColumn.name(),System.currentTimeMillis());
          }
          break;
        }
      }
    }
  }
  if (logger_.isDebugEnabled())   logger_.debug("Finished hinted handoff for endpoint " + endPoint);
}
