{
  logger_.debug("Started hinted handoff for endPoint " + endPoint.getHost());
  for (  String tableName : DatabaseDescriptor.getTables()) {
    try {
      Table table=Table.open(tableName);
      ColumnFamily hintedColumnFamily=table.get(key_,Table.hints_);
      if (hintedColumnFamily == null) {
        return;
      }
      Collection<IColumn> keys=hintedColumnFamily.getAllColumns();
      if (keys == null) {
        return;
      }
      for (      IColumn keyColumn : keys) {
        Collection<IColumn> endpoints=keyColumn.getSubColumns();
        for (        IColumn endpoint : endpoints) {
          if (endpoint.name().equals(endPoint.getHost()) && sendMessage(endpoint.name(),null,keyColumn.name())) {
            deleteEndPoint(endpoint.name(),tableName,keyColumn.name(),keyColumn.timestamp());
            if (endpoints.size() == 1) {
              deleteHintedData(tableName,keyColumn.name());
            }
          }
        }
      }
    }
 catch (    Exception ex) {
      logger_.error("Error delivering hints",ex);
    }
 finally {
      logger_.debug("Finished hinted handoff for endpoint " + endPoint.getHost());
    }
  }
}
