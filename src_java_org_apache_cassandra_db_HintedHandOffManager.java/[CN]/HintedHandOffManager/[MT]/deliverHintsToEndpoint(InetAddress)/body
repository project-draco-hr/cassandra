{
  if (logger_.isDebugEnabled())   logger_.debug("Started hinted handoff for endpoint " + endpoint);
  byte[] targetEPBytes=endpoint.getAddress();
  ColumnFamilyStore hintStore=Table.open(Table.SYSTEM_TABLE).getColumnFamilyStore(HINTS_CF);
  for (  String tableName : DatabaseDescriptor.getTables()) {
    DecoratedKey tableNameKey=StorageService.getPartitioner().decorateKey(tableName.getBytes(UTF8));
    byte[] startColumn=ArrayUtils.EMPTY_BYTE_ARRAY;
    while (true) {
      QueryFilter filter=QueryFilter.getSliceFilter(tableNameKey,new QueryPath(HINTS_CF),startColumn,ArrayUtils.EMPTY_BYTE_ARRAY,null,false,PAGE_SIZE);
      ColumnFamily hintColumnFamily=ColumnFamilyStore.removeDeleted(hintStore.getColumnFamily(filter),Integer.MAX_VALUE);
      if (pagingFinished(hintColumnFamily,startColumn))       break;
      Collection<IColumn> keys=hintColumnFamily.getSortedColumns();
      for (      IColumn keyColumn : keys) {
        byte[] keyBytes=keyColumn.name();
        Collection<IColumn> endpoints=keyColumn.getSubColumns();
        for (        IColumn hintEndpoint : endpoints) {
          if (Arrays.equals(hintEndpoint.name(),targetEPBytes) && sendMessage(endpoint,tableName,keyBytes)) {
            if (endpoints.size() == 1)             deleteHintKey(tableName,keyColumn.name());
 else             deleteEndpoint(hintEndpoint.name(),tableName,keyColumn.name(),System.currentTimeMillis());
            break;
          }
        }
        startColumn=keyColumn.name();
      }
    }
  }
  if (logger_.isDebugEnabled())   logger_.debug("Finished hinted handoff for endpoint " + endpoint);
}
