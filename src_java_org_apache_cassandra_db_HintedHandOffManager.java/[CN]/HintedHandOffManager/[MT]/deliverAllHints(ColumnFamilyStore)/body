{
  logger_.debug("Started hinted handoff of " + columnFamilyStore.columnFamily_);
  for (  String tableName : DatabaseDescriptor.getTables()) {
    try {
      Table table=Table.open(tableName);
      ColumnFamily hintColumnFamily=ColumnFamilyStore.removeDeleted(table.get(key_,Table.hints_),Integer.MAX_VALUE);
      if (hintColumnFamily == null) {
        columnFamilyStore.forceFlush();
        return;
      }
      Collection<IColumn> keys=hintColumnFamily.getAllColumns();
      if (keys == null) {
        return;
      }
      for (      IColumn keyColumn : keys) {
        Collection<IColumn> endpoints=keyColumn.getSubColumns();
        int deleted=0;
        for (        IColumn endpoint : endpoints) {
          if (sendMessage(endpoint.name(),tableName,keyColumn.name())) {
            deleteEndPoint(endpoint.name(),tableName,keyColumn.name(),keyColumn.timestamp());
            deleted++;
          }
        }
        if (deleted == endpoints.size()) {
          deleteHintedData(tableName,keyColumn.name());
        }
      }
      columnFamilyStore.forceFlush();
      columnFamilyStore.forceCompaction(null,null,0,null);
    }
 catch (    Exception ex) {
      logger_.error("error delivering hints",ex);
    }
 finally {
      logger_.debug("Finished hinted handoff of " + columnFamilyStore.columnFamily_);
    }
  }
}
