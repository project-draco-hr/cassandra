{
  DecoratedKey oldTableKey=StorageService.getPartitioner().decorateKey(oldTable.getBytes(UTF_8));
  ColumnFamilyStore hintStore=Table.open(Table.SYSTEM_TABLE).getColumnFamilyStore(HINTS_CF);
  byte[] startCol=ArrayUtils.EMPTY_BYTE_ARRAY;
  long now=System.currentTimeMillis();
  while (true) {
    QueryFilter filter=QueryFilter.getSliceFilter(oldTableKey,new QueryPath(HINTS_CF),startCol,ArrayUtils.EMPTY_BYTE_ARRAY,false,PAGE_SIZE);
    ColumnFamily cf=ColumnFamilyStore.removeDeleted(hintStore.getColumnFamily(filter),Integer.MAX_VALUE);
    if (pagingFinished(cf,startCol))     break;
    if (newTable != null) {
      RowMutation insert=new RowMutation(Table.SYSTEM_TABLE,newTable.getBytes(UTF_8));
      insert.add(cf);
      insert.apply();
    }
    RowMutation drop=new RowMutation(Table.SYSTEM_TABLE,oldTableKey.key);
    for (    byte[] key : cf.getColumnNames()) {
      drop.delete(new QueryPath(HINTS_CF,key),now);
      startCol=key;
    }
    drop.apply();
  }
}
