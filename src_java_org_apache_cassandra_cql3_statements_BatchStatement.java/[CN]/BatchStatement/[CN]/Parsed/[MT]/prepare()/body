{
  VariableSpecifications boundNames=getBoundVariables();
  List<ModificationStatement> statements=new ArrayList<ModificationStatement>(parsedStatements.size());
  for (  ModificationStatement.Parsed parsed : parsedStatements) {
    ModificationStatement stmt=parsed.prepare(boundNames);
    if (stmt.hasConditions())     throw new InvalidRequestException("Conditional updates are not allowed in batches");
    if (stmt.isCounter() && type != Type.COUNTER)     throw new InvalidRequestException("Counter mutations are only allowed in COUNTER batches");
    if (!stmt.isCounter() && type == Type.COUNTER)     throw new InvalidRequestException("Only counter mutations are allowed in COUNTER batches");
    statements.add(stmt);
  }
  Attributes prepAttrs=attrs.prepare("[batch]","[batch]");
  prepAttrs.collectMarkerSpecification(boundNames);
  return new ParsedStatement.Prepared(new BatchStatement(boundNames.size(),type,statements,prepAttrs),boundNames);
}
