{
  RandomAccessReader compressedFile=CompressedRandomAccessReader.open(file.getFilename(),true);
  try {
    for (    Pair<Long,Long> section : file.sections) {
      long length=section.right - section.left;
      compressedFile.seek(section.left);
      while (length > 0) {
        int toRead=(length > FileStreamTask.CHUNK_SIZE) ? FileStreamTask.CHUNK_SIZE : (int)length;
        ByteBuffer buffer=compressedFile.readBytes(toRead);
        long bytesTransferred=0;
        while (bytesTransferred < toRead) {
          long lastWrite=target.write(buffer);
          bytesTransferred+=lastWrite;
          file.progress+=lastWrite;
        }
        length-=bytesTransferred;
        if (logger.isDebugEnabled())         logger.debug("Bytes transferred " + bytesTransferred + "/"+ file.size);
      }
    }
  }
  finally {
    FileUtils.closeQuietly(compressedFile);
  }
}
