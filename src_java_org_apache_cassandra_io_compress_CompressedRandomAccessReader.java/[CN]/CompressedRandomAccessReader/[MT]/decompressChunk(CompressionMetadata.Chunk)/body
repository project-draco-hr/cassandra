{
  if (channel.position() != chunk.offset)   channel.position(chunk.offset);
  if (compressed.length < chunk.length)   compressed=new byte[chunk.length];
  if (source.read(compressed,0,chunk.length) != chunk.length)   throw new IOException(String.format("(%s) failed to read %d bytes from offset %d.",getPath(),chunk.length,chunk.offset));
  validBufferBytes=metadata.compressor().uncompress(compressed,0,chunk.length,buffer,0);
  if (metadata.parameters.getCrcCheckChance() > FBUtilities.threadLocalRandom().nextDouble()) {
    checksum.update(buffer,0,validBufferBytes);
    if (checksum(chunk) != (int)checksum.getValue())     throw new CorruptedBlockException(getPath(),chunk);
    checksum.reset();
  }
  bufferOffset=current & ~(buffer.length - 1);
}
