{
  int maxBucketsPerElement=Math.max(1,BloomCalculations.maxBucketsPerElement(numElements));
  int bucketsPerElement=Math.min(targetBucketsPerElem,maxBucketsPerElement);
  if (bucketsPerElement < targetBucketsPerElem) {
    logger.warn(String.format("Cannot provide an optimal BloomFilter for %d elements (%d/%d buckets per element).",numElements,bucketsPerElement,targetBucketsPerElem));
  }
  BloomCalculations.BloomSpecification spec=BloomCalculations.computeBloomSpec(bucketsPerElement);
  if (logger.isTraceEnabled())   logger.trace("Creating bloom filter for {} elements and spec {}",numElements,spec);
  return new BloomFilter(spec.K,bucketsFor(numElements,spec.bucketsPerElement));
}
