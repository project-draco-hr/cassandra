{
  if (waitForSyncToCatchUp(Long.MAX_VALUE)) {
    long started=System.currentTimeMillis();
    pending.incrementAndGet();
    while (waitForSyncToCatchUp(started)) {
      WaitQueue.Signal signal=syncComplete.register(commitLog.metrics.waitingOnCommit.time());
      if (waitForSyncToCatchUp(started))       signal.awaitUninterruptibly();
 else       signal.cancel();
    }
    pending.decrementAndGet();
  }
}
