{
  IPartitioner partitioner=ss.getPartitioner();
  VersionedValue.VersionedValueFactory valueFactory=new VersionedValue.VersionedValueFactory(partitioner);
  NotificationSink nSink=new NotificationSink();
  ReplicationSink rSink=new ReplicationSink();
  SinkManager.addMessageSink(nSink);
  SinkManager.addMessageSink(rSink);
  assertEquals(0,tmd.getLeavingEndpoints().size());
  ss.onChange(hosts.get(1),ApplicationState.STATUS,valueFactory.removingNonlocal(endpointTokens.get(1),endpointTokens.get(5)));
  assertEquals(1,nSink.callCount);
  assertTrue(tmd.isLeaving(hosts.get(5)));
  assertEquals(1,tmd.getLeavingEndpoints().size());
}
