{
  ColumnFamilyStore store=prepareColumnFamilyStore();
  Set<SSTableReader> original=store.getUnrepairedSSTables();
  UUID prsId=UUID.randomUUID();
  ActiveRepairService.instance.registerParentRepairSession(prsId,FBUtilities.getBroadcastAddress(),Collections.singletonList(store),Collections.singleton(new Range<>(store.partitioner.getMinimumToken(),store.partitioner.getMinimumToken())),true,true);
  ActiveRepairService.instance.getParentRepairSession(prsId).maybeSnapshot(store.metadata.cfId,prsId);
  UUID prsId2=UUID.randomUUID();
  ActiveRepairService.instance.registerParentRepairSession(prsId2,FBUtilities.getBroadcastAddress(),Collections.singletonList(store),Collections.singleton(new Range<>(store.partitioner.getMinimumToken(),store.partitioner.getMinimumToken())),true,true);
  boolean exception=false;
  try {
    ActiveRepairService.instance.getParentRepairSession(prsId2).maybeSnapshot(store.metadata.cfId,prsId2);
  }
 catch (  Throwable t) {
    exception=true;
  }
  assertTrue(exception);
  try (Refs<SSTableReader> refs=ActiveRepairService.instance.getParentRepairSession(prsId).getActiveRepairedSSTableRefsForAntiCompaction(store.metadata.cfId,prsId)){
    assertEquals(original,Sets.newHashSet(refs.iterator()));
  }
 }
