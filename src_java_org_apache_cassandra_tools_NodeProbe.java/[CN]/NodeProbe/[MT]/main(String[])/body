{
  NodeProbe probe=null;
  try {
    probe=new NodeProbe(args);
  }
 catch (  ParseException pe) {
    System.err.println(pe.getMessage());
    NodeProbe.printUsage();
    System.exit(1);
  }
catch (  IOException ioe) {
    System.err.println("Error connecting to remote JMX agent!");
    ioe.printStackTrace();
    System.exit(3);
  }
  if (probe.getArgs().length < 1) {
    System.err.println("Missing argument for command.");
    NodeProbe.printUsage();
    System.exit(1);
  }
  String[] arguments=probe.getArgs();
  String cmdName=arguments[0];
  if (cmdName.equals("ring")) {
    probe.printRing(System.out);
  }
 else   if (cmdName.equals("info")) {
    probe.printInfo(System.out);
  }
 else   if (cmdName.equals("cleanup")) {
    probe.forceTableCleanup();
  }
 else   if (cmdName.equals("compact")) {
    probe.forceTableCompaction();
  }
 else   if (cmdName.equals("cfstats")) {
    probe.printColumnFamilyStats(System.out);
  }
 else   if (cmdName.equals("decommission")) {
    probe.decommission();
  }
 else   if (cmdName.equals("loadbalance")) {
    probe.loadBalance();
  }
 else   if (cmdName.equals("move")) {
    if (arguments.length <= 1) {
      System.err.println("missing token argument");
    }
    probe.move(arguments[1]);
  }
 else   if (cmdName.equals("cancelpending")) {
    probe.cancelPendingRanges();
  }
 else   if (cmdName.equals("removetoken")) {
    if (arguments.length <= 1) {
      System.err.println("missing token argument");
    }
    probe.removeToken(arguments[1]);
  }
 else   if (cmdName.equals("snapshot")) {
    String snapshotName="";
    if (arguments.length > 1) {
      snapshotName=arguments[1];
    }
    probe.takeSnapshot(snapshotName);
  }
 else   if (cmdName.equals("clearsnapshot")) {
    probe.clearSnapshot();
  }
 else   if (cmdName.equals("tpstats")) {
    probe.printThreadPoolStats(System.out);
  }
 else   if (cmdName.equals("flush") || cmdName.equals("repair")) {
    if (probe.getArgs().length < 2) {
      System.err.println("Missing keyspace argument.");
      NodeProbe.printUsage();
      System.exit(1);
    }
    String[] columnFamilies=new String[probe.getArgs().length - 2];
    for (int i=0; i < columnFamilies.length; i++) {
      columnFamilies[i]=probe.getArgs()[i + 2];
    }
    if (cmdName.equals("flush"))     probe.forceTableFlush(probe.getArgs()[1],columnFamilies);
 else     probe.forceTableRepair(probe.getArgs()[1],columnFamilies);
  }
 else   if (cmdName.equals("getcompactionthreshold")) {
    probe.getCompactionThreshold(System.out);
  }
 else   if (cmdName.equals("setcompactionthreshold")) {
    if (arguments.length < 2) {
      System.err.println("Missing threshold value(s)");
      NodeProbe.printUsage();
      System.exit(1);
    }
    int minthreshold=Integer.parseInt(arguments[1]);
    int maxthreshold=CompactionManager.instance().getMaximumCompactionThreshold();
    if (arguments.length > 2) {
      maxthreshold=Integer.parseInt(arguments[2]);
    }
    if (minthreshold > maxthreshold) {
      System.err.println("Min threshold can't be greater than Max threshold");
      NodeProbe.printUsage();
      System.exit(1);
    }
    if (minthreshold < 2 && maxthreshold != 0) {
      System.err.println("Min threshold must be at least 2");
      NodeProbe.printUsage();
      System.exit(1);
    }
    probe.setCompactionThreshold(minthreshold,maxthreshold);
  }
 else {
    System.err.println("Unrecognized command: " + cmdName + ".");
    NodeProbe.printUsage();
    System.exit(1);
  }
  System.exit(0);
}
