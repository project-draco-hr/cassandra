{
  Iterator<InetAddress> hostiter=hosts.iterator();
  while (hostiter.hasNext()) {
    try {
      InetAddress host=hostiter.next();
      Cassandra.Client client=createThriftClient(host.getHostAddress(),rpcPort,this.user,this.passwd,this.transportFactory);
      setPartitioner(client.describe_partitioner());
      Token.TokenFactory tkFactory=getPartitioner().getTokenFactory();
      for (      TokenRange tr : client.describe_ring(keyspace)) {
        Range<Token> range=new Range<>(tkFactory.fromString(tr.start_token),tkFactory.fromString(tr.end_token));
        for (        String ep : tr.endpoints) {
          addRangeForEndpoint(range,InetAddress.getByName(ep));
        }
      }
      String query=String.format("SELECT * FROM %s.%s WHERE keyspace_name = '%s'",Keyspace.SYSTEM_KS,SystemKeyspace.SCHEMA_COLUMNFAMILIES_CF,keyspace);
      CqlResult result=client.execute_cql3_query(ByteBufferUtil.bytes(query),Compression.NONE,ConsistencyLevel.ONE);
      for (      CqlRow row : result.rows) {
        CFMetaData metadata=CFMetaData.fromThriftCqlRow(row);
        knownCfs.put(metadata.cfName,metadata);
      }
      break;
    }
 catch (    Exception e) {
      if (!hostiter.hasNext())       throw new RuntimeException("Could not retrieve endpoint ranges: ",e);
    }
  }
}
