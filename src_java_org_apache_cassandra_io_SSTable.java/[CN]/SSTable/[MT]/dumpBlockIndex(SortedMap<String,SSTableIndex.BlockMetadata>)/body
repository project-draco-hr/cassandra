{
  if (blockIndex.size() == 0) {
    return;
  }
  DataOutputBuffer bufOut=new DataOutputBuffer();
  long position=dataWriter_.getCurrentPosition();
  Set<String> keys=blockIndex.keySet();
  bufOut.writeInt(keys.size());
  for (  String decoratedKey : keys) {
    bufOut.writeUTF(decoratedKey);
    SSTableIndex.BlockMetadata blockMetadata=blockIndex.get(decoratedKey);
    bufOut.writeLong(position - blockMetadata.position_);
    bufOut.writeLong(blockMetadata.size_);
  }
  dataWriter_.append(SSTable.blockIndexKey_,bufOut);
  List<KeyPositionInfo> KeyPositions=SSTable.indexMetadataMap_.get(dataFile_);
  if (KeyPositions == null) {
    KeyPositions=new ArrayList<KeyPositionInfo>();
    SSTable.indexMetadataMap_.put(dataFile_,KeyPositions);
  }
  KeyPositions.add(new KeyPositionInfo(blockIndex.firstKey(),position,partitioner_));
  blockIndex.clear();
}
