{
  for (  ColumnFamilyStore cfs : Keyspace.open(SystemKeyspace.NAME).getColumnFamilyStores())   cfs.clearUnsafe();
  Keyspace.clearSnapshot(null,SystemKeyspace.NAME);
  SystemKeyspace.snapshotOnVersionChange();
  assertTrue(getSystemSnapshotFiles().isEmpty());
  SemanticVersion next=getCurrentReleaseVersion();
  setupReleaseVersion(new SemanticVersion(String.format("%s.%s.%s",next.major - 1,next.minor,next.patch)));
  Keyspace.clearSnapshot(null,SystemKeyspace.NAME);
  assertTrue(getSystemSnapshotFiles().isEmpty());
  SystemKeyspace.snapshotOnVersionChange();
  assertEquals(SystemKeyspace.definition().cfMetaData().size(),getSystemSnapshotFiles().size());
  Keyspace.clearSnapshot(null,SystemKeyspace.NAME);
  setupReleaseVersion(getCurrentReleaseVersion());
  SystemKeyspace.snapshotOnVersionChange();
  assertTrue(getSystemSnapshotFiles().isEmpty());
}
