{
  if (logger.isDebugEnabled())   logger.debug("prepare_cql_query");
  String queryString=uncompress(query,compression);
  int itemId=makeItemId(queryString);
  try {
    CQLStatement statement=QueryProcessor.prepare(queryString,state());
    QueryProcessor.discoverBoundTerms(statement);
    if (logger.isTraceEnabled())     logger.trace("Discovered " + statement.boundTerms + " bound variables.");
    state().getPrepared().put(itemId,statement);
    if (logger.isTraceEnabled())     logger.trace("Storing prepared statement: #" + itemId + " count:"+ state().getPrepared().size());
    return new CqlPreparedResult(itemId,statement.boundTerms);
  }
 catch (  RecognitionException e) {
    InvalidRequestException ire=new InvalidRequestException("Invalid or malformed CQL query string");
    ire.initCause(e);
    throw ire;
  }
}
