{
  logger.debug("update_column_family");
  try {
    if (cf_def.keyspace == null || cf_def.name == null)     throw new InvalidRequestException("Keyspace and CF name must be set.");
    CFMetaData oldCfm=Schema.instance.getCFMetaData(cf_def.keyspace,cf_def.name);
    if (oldCfm == null)     throw new InvalidRequestException("Could not find column family definition to modify.");
    if (oldCfm.isThriftIncompatible())     throw new InvalidRequestException("Cannot modify CQL3 table " + oldCfm.cfName + " as it may break the schema. You should use cqlsh to modify CQL3 tables instead.");
    state().hasColumnFamilyAccess(cf_def.keyspace,cf_def.name,Permission.ALTER);
    CFMetaData.applyImplicitDefaults(cf_def);
    CFMetaData cfm=CFMetaData.fromThrift(cf_def);
    if (!cf_def.isSetKey_alias())     cfm.keyAliases(oldCfm.getKeyAliases());
    cfm.columnAliases(oldCfm.getColumnAliases());
    cfm.valueAlias(oldCfm.getValueAlias());
    CFMetaData.validateCompactionOptions(cfm.compactionStrategyClass,cfm.compactionStrategyOptions,false);
    cfm.addDefaultIndexNames();
    MigrationManager.announceColumnFamilyUpdate(cfm);
    return Schema.instance.getVersion().toString();
  }
 catch (  RequestValidationException e) {
    throw ThriftConversion.toThrift(e);
  }
}
