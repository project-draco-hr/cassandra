{
  if (keyspace == null || !Schema.instance.getNonSystemTables().contains(keyspace))   throw new InvalidRequestException("There is no ring for the keyspace: " + keyspace);
  List<TokenRange> ranges=new ArrayList<TokenRange>();
  Token.TokenFactory tf=StorageService.getPartitioner().getTokenFactory();
  for (  Map.Entry<Range,List<InetAddress>> entry : StorageService.instance.getRangeToAddressMap(keyspace).entrySet()) {
    Range range=entry.getKey();
    List<String> endpoints=new ArrayList<String>();
    List<EndpointDetails> epDetails=new ArrayList<EndpointDetails>();
    for (    InetAddress endpoint : entry.getValue()) {
      EndpointState eps=Gossiper.instance.getEndpointStateForEndpoint(endpoint);
      EndpointDetails details=new EndpointDetails();
      details.port=-1;
      if (endpoint.equals(FBUtilities.getBroadcastAddress())) {
        details.host=DatabaseDescriptor.getRpcAddress().getHostAddress();
        details.port=DatabaseDescriptor.getRpcPort();
      }
 else       if (eps.getApplicationState(ApplicationState.RPC_ADDRESS) == null)       details.host=endpoint.getHostAddress();
 else       details.host=eps.getApplicationState(ApplicationState.RPC_ADDRESS).value;
      VersionedValue appStateDc=eps.getApplicationState(ApplicationState.DC);
      if (appStateDc != null)       details.datacenter=appStateDc.value;
      endpoints.add(details.host);
      if (details.port != -1 || details.datacenter != null)       epDetails.add(details);
    }
    ranges.add(new TokenRange(tf.toString(range.left),tf.toString(range.right),endpoints).setEndpoint_details(epDetails));
  }
  return ranges;
}
