{
  if (keyspace == null || !Schema.instance.getNonSystemTables().contains(keyspace))   throw new InvalidRequestException("There is no ring for the keyspace: " + keyspace);
  List<TokenRange> ranges=new ArrayList<TokenRange>();
  Token.TokenFactory tf=StorageService.getPartitioner().getTokenFactory();
  for (  Map.Entry<Range,List<InetAddress>> entry : StorageService.instance.getRangeToAddressMap(keyspace).entrySet()) {
    Range range=entry.getKey();
    List<String> endpoints=new ArrayList<String>();
    List<String> rpc_endpoints=new ArrayList<String>();
    List<EndpointDetails> epDetails=new ArrayList<EndpointDetails>();
    for (    InetAddress endpoint : entry.getValue()) {
      EndpointState eps=Gossiper.instance.getEndpointStateForEndpoint(endpoint);
      EndpointDetails details=new EndpointDetails();
      if (endpoint.equals(FBUtilities.getBroadcastAddress()))       details.host=DatabaseDescriptor.getRpcAddress().getHostAddress();
 else       if (eps.getApplicationState(ApplicationState.RPC_ADDRESS) == null)       details.host=endpoint.getHostAddress();
 else       details.host=eps.getApplicationState(ApplicationState.RPC_ADDRESS).value;
      details.datacenter=DatabaseDescriptor.getEndpointSnitch().getDatacenter(endpoint);
      endpoints.add(details.host);
      rpc_endpoints.add(StorageService.instance.getRpcaddress(endpoint));
      epDetails.add(details);
    }
    TokenRange tr=new TokenRange(tf.toString(range.left),tf.toString(range.right),endpoints).setEndpoint_details(epDetails).setRpc_endpoints(rpc_endpoints);
    ranges.add(tr);
  }
  return ranges;
}
