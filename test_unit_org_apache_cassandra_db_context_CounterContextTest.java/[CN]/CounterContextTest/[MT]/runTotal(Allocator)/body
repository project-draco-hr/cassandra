{
  ContextState left=ContextState.allocate(4,1,allocator);
  left.writeElement(CounterId.fromInt(1),1L,1L);
  left.writeElement(CounterId.fromInt(2),2L,2L);
  left.writeElement(CounterId.fromInt(4),3L,3L);
  left.writeElement(CounterId.getLocalId(),3L,3L,true);
  ContextState right=ContextState.allocate(3,1,allocator);
  right.writeElement(CounterId.fromInt(4),4L,4L);
  right.writeElement(CounterId.fromInt(5),5L,5L);
  right.writeElement(CounterId.getLocalId(),9L,9L,true);
  ByteBuffer merged=cc.merge(left.context,right.context,allocator);
  assertEquals(24L,cc.total(merged));
}
