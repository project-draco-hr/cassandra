{
  String localDC=snitch.getDatacenter(DatabaseDescriptor.getListenAddress());
  if (localDC == null)   throw new ConfigurationException("Invalid datacenter configuration; couldn't find local host " + FBUtilities.getLocalAddress());
  dcTokens=new HashMap<String,List<Token>>();
  for (  Token token : metadata.sortedTokens()) {
    InetAddress endPoint=metadata.getEndpoint(token);
    String dataCenter=snitch.getDatacenter(endPoint);
    List<Token> lst=dcTokens.get(dataCenter);
    if (lst == null) {
      lst=new ArrayList<Token>();
    }
    lst.add(token);
    dcTokens.put(dataCenter,lst);
  }
  for (  Entry<String,List<Token>> entry : dcTokens.entrySet()) {
    List<Token> valueList=entry.getValue();
    Collections.sort(valueList);
    dcTokens.put(entry.getKey(),valueList);
  }
}
