{
  ArrayList<InetAddress> endpoints=new ArrayList<InetAddress>();
  if (metadata.sortedTokens().isEmpty())   return endpoints;
  for (  String dc : dcTokens.keySet()) {
    int replicas=getReplicationFactor(dc,table);
    List<Token> tokens=dcTokens.get(dc);
    boolean bOtherRack=false;
    boolean doneDataCenterItr;
    Iterator<Token> iter=TokenMetadata.ringIterator(tokens,searchToken);
    InetAddress primaryHost=metadata.getEndpoint(iter.next());
    endpoints.add(primaryHost);
    while (endpoints.size() < replicas && iter.hasNext()) {
      Token t=iter.next();
      InetAddress endPointOfInterest=metadata.getEndpoint(t);
      if (endpoints.size() < replicas - 1) {
        endpoints.add(endPointOfInterest);
        continue;
      }
 else {
        doneDataCenterItr=true;
      }
      if (!bOtherRack) {
        if (!snitch.getRack(primaryHost).equals(snitch.getRack(endPointOfInterest))) {
          endpoints.add(metadata.getEndpoint(t));
          bOtherRack=true;
        }
      }
      if (doneDataCenterItr && bOtherRack)       break;
    }
    if (endpoints.size() < replicas) {
      iter=TokenMetadata.ringIterator(tokens,searchToken);
      while (endpoints.size() < replicas && iter.hasNext()) {
        Token t=iter.next();
        if (!endpoints.contains(metadata.getEndpoint(t)))         endpoints.add(metadata.getEndpoint(t));
      }
    }
  }
  return endpoints;
}
