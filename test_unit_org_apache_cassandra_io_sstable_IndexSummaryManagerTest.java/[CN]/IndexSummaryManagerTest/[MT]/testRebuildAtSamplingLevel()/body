{
  String ksname="Keyspace1";
  String cfname="StandardLowIndexInterval";
  Keyspace keyspace=Keyspace.open(ksname);
  ColumnFamilyStore cfs=keyspace.getColumnFamilyStore(cfname);
  cfs.truncateBlocking();
  cfs.disableAutoCompaction();
  ByteBuffer value=ByteBuffer.wrap(new byte[100]);
  int numRows=256;
  for (int row=0; row < numRows; row++) {
    DecoratedKey key=Util.dk(String.valueOf(row));
    RowMutation rm=new RowMutation(ksname,key.key);
    rm.add(cfname,ByteBufferUtil.bytes("column"),value,0);
    rm.apply();
  }
  cfs.forceBlockingFlush();
  List<SSTableReader> sstables=new ArrayList<>(cfs.getSSTables());
  assertEquals(1,sstables.size());
  SSTableReader original=sstables.get(0);
  SSTableReader sstable=original;
  for (int samplingLevel=MIN_SAMPLING_LEVEL; samplingLevel < BASE_SAMPLING_LEVEL; samplingLevel++) {
    sstable=sstable.cloneWithNewSummarySamplingLevel(samplingLevel);
    assertEquals(samplingLevel,sstable.getIndexSummarySamplingLevel());
    int expectedSize=(numRows * samplingLevel) / (sstable.metadata.getIndexInterval() * BASE_SAMPLING_LEVEL);
    assertEquals(expectedSize,sstable.getIndexSummarySize(),1);
  }
  cfs.getDataTracker().replaceReaders(Collections.singleton(original),Collections.singleton(sstable));
}
