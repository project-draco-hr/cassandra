{
  if (FBUtilities.isWindows())   WindowsTimer.startTimerPeriod(1);
  try {
    final StressSettings settings;
    try {
      settings=StressSettings.parse(arguments);
    }
 catch (    IllegalArgumentException e) {
      printHelpMessage();
      e.printStackTrace();
      return;
    }
    MultiPrintStream logout=settings.log.getOutput();
    if (settings.graph.inGraphMode()) {
      logout.addStream(new PrintStream(settings.graph.temporaryLogFile));
    }
    if (settings.sendToDaemon != null) {
      Socket socket=new Socket(settings.sendToDaemon,2159);
      ObjectOutputStream out=new ObjectOutputStream(socket.getOutputStream());
      BufferedReader inp=new BufferedReader(new InputStreamReader(socket.getInputStream()));
      Runtime.getRuntime().addShutdownHook(new ShutDown(socket,out));
      out.writeObject(settings);
      String line;
      try {
        while (!socket.isClosed() && (line=inp.readLine()) != null) {
          if (line.equals("END") || line.equals("FAILURE")) {
            out.writeInt(1);
            break;
          }
          logout.println(line);
        }
      }
 catch (      SocketException e) {
        if (!stopped)         e.printStackTrace();
      }
      out.close();
      inp.close();
      socket.close();
    }
 else {
      StressAction stressAction=new StressAction(settings,logout);
      stressAction.run();
      logout.flush();
      if (settings.graph.inGraphMode())       new StressGraph(settings,arguments).generateGraph();
    }
  }
 catch (  Throwable t) {
    t.printStackTrace();
  }
 finally {
    if (FBUtilities.isWindows())     WindowsTimer.endTimerPeriod(1);
    System.exit(0);
  }
}
