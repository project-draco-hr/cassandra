{
  logger.info("Performing streaming repair of " + differences.size() + " ranges for "+ request);
  ColumnFamilyStore cfstore=Table.open(request.cf.left).getColumnFamilyStore(request.cf.right);
  try {
    final List<Range> ranges=new ArrayList<Range>(differences);
    final Collection<SSTableReader> sstables=cfstore.getSSTables();
    Future f=StageManager.getStage(Stage.STREAM).submit(new WrappedRunnable(){
      protected void runMayThrow() throws Exception {
        StreamContext context=new StreamContext(request.endpoint);
        StreamOut.transferSSTables(context,request.cf.left,sstables,ranges);
        StreamOutSession.remove(context);
      }
    }
);
    StreamIn.requestRanges(request.endpoint,request.cf.left,ranges);
    f.get();
  }
 catch (  Exception e) {
    throw new IOException("Streaming repair failed.",e);
  }
  logger.info("Finished streaming repair for " + request);
}
