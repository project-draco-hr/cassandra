{
  logger.info("Performing streaming repair of " + differences.size() + " ranges for "+ request);
  ColumnFamilyStore cfstore=Table.open(request.cf.left).getColumnFamilyStore(request.cf.right);
  try {
    List<Range> ranges=new ArrayList<Range>(differences);
    Collection<SSTableReader> sstables=cfstore.getSSTables();
    Callback callback=new Callback();
    StreamOutSession outsession=StreamOutSession.create(request.cf.left,request.endpoint,callback);
    StreamOut.transferSSTables(outsession,sstables,ranges);
    StreamIn.requestRanges(request.endpoint,request.cf.left,ranges,callback);
  }
 catch (  Exception e) {
    throw new IOException("Streaming repair failed.",e);
  }
}
