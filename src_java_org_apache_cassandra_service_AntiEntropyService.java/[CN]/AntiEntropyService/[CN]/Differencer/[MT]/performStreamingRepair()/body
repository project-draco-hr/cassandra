{
  logger.info("Performing streaming repair of " + differences.size() + " ranges for "+ request);
  ColumnFamilyStore cfstore=Table.open(request.cf.left).getColumnFamilyStore(request.cf.right);
  try {
    Collection<SSTableReader> sstables=cfstore.markCurrentSSTablesReferenced();
    Callback callback=new Callback();
    StreamOutSession outsession=StreamOutSession.create(request.cf.left,request.endpoint,callback);
    StreamOut.transferSSTables(outsession,sstables,differences,OperationType.AES);
    StreamIn.requestRanges(request.endpoint,request.cf.left,Collections.singletonList(cfstore),differences,callback,OperationType.AES);
  }
 catch (  Exception e) {
    throw new IOException("Streaming repair failed.",e);
  }
}
