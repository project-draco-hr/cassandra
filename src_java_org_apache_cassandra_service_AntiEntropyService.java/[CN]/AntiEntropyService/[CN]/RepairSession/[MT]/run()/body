{
  Set<InetAddress> endpoints=AntiEntropyService.getNeighbors(tablename);
  if (endpoints.isEmpty()) {
    logger.info("No neighbors to repair with: " + getName() + " completed.");
    return;
  }
  for (  InetAddress endpoint : endpoints) {
    if (!FailureDetector.instance.isAlive(endpoint)) {
      logger.info("Could not proceed on repair because a neighbor (" + endpoint + ") is dead: "+ getName()+ " failed.");
      return;
    }
  }
  Callback callback=new Callback();
  AntiEntropyService.this.sessions.put(getName(),callback);
  try {
    for (    String cfname : cfnames) {
      for (      InetAddress endpoint : endpoints)       requests.put(AntiEntropyService.this.request(getName(),endpoint,tablename,cfname),this);
      AntiEntropyService.this.request(getName(),FBUtilities.getLocalAddress(),tablename,cfname);
    }
    logger.info("Waiting for repair requests: " + requests.keySet());
    requestsMade.signalAll();
    callback.completed.await();
  }
 catch (  InterruptedException e) {
    throw new RuntimeException("Interrupted while waiting for repair: repair will continue in the background.");
  }
}
