{
  logger.info("Performing streaming repair of " + differences.size() + " ranges with "+ remote+ " for "+ range);
  ColumnFamilyStore cfstore=Table.open(tablename).getColumnFamilyStore(cfname);
  try {
    Collection<SSTableReader> sstables=cfstore.markCurrentSSTablesReferenced();
    Callback callback=new Callback();
    StreamOutSession outsession=StreamOutSession.create(tablename,remote,callback);
    StreamOut.transferSSTables(outsession,sstables,differences,OperationType.AES);
    StreamIn.requestRanges(remote,tablename,differences,callback,OperationType.AES);
  }
 catch (  Exception e) {
    throw new IOException("Streaming repair failed.",e);
  }
}
