{
  outputHandler.output("Upgrading " + sstable);
  int nowInSec=FBUtilities.nowInSeconds();
  try (SSTableRewriter writer=new SSTableRewriter(cfs,transaction,CompactionTask.getMaxDataAge(transaction.originals()),true).keepOriginals(keepOriginals);AbstractCompactionStrategy.ScannerList scanners=strategyManager.getScanners(transaction.originals());CompactionIterator iter=new CompactionIterator(transaction.opType(),scanners.scanners,controller,nowInSec,UUIDGen.getTimeUUID())){
    writer.switchWriter(createCompactionWriter(sstable.getSSTableMetadata().repairedAt));
    while (iter.hasNext())     writer.append(iter.next());
    writer.finish();
    outputHandler.output("Upgrade of " + sstable + " complete.");
  }
 catch (  Exception e) {
    Throwables.propagate(e);
  }
 finally {
    controller.close();
  }
}
