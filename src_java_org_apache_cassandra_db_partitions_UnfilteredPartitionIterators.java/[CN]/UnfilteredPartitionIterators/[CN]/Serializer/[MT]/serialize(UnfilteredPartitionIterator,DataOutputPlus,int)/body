{
  if (version < MessagingService.VERSION_30)   throw new UnsupportedOperationException();
  out.writeBoolean(iter.isForThrift());
  while (iter.hasNext()) {
    out.writeBoolean(true);
    try (UnfilteredRowIterator partition=iter.next()){
      UnfilteredRowIteratorSerializer.serializer.serialize(partition,out,version);
    }
   }
  out.writeBoolean(false);
}
