{
  logger.debug("Dispatching hints file {}",descriptor.fileName());
  File file=new File(hintsDirectory,descriptor.fileName());
  Long offset=store.getDispatchOffset(descriptor).orElse(null);
  try (HintsDispatcher dispatcher=HintsDispatcher.create(file,rateLimiter,hostId,isPaused)){
    if (offset != null)     dispatcher.seek(offset);
    if (dispatcher.dispatch()) {
      if (!file.delete())       logger.error("Failed to delete hints file {}",descriptor.fileName());
      store.cleanUp(descriptor);
      logger.info("Finished hinted handoff of file {} to endpoint {}",descriptor.fileName(),hostId);
    }
 else {
      store.markDispatchOffset(descriptor,dispatcher.dispatchOffset());
      store.offerFirst(descriptor);
      logger.info("Finished hinted handoff of file {} to endpoint {}, partially",descriptor.fileName(),hostId);
    }
  }
 }
