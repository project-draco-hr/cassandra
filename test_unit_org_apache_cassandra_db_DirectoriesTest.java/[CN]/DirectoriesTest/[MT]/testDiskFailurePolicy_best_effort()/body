{
  DiskFailurePolicy origPolicy=DatabaseDescriptor.getDiskFailurePolicy();
  try {
    DatabaseDescriptor.setDiskFailurePolicy(DiskFailurePolicy.best_effort);
    for (    DataDirectory dd : Directories.dataDirectories) {
      dd.location.setExecutable(false);
      dd.location.setWritable(false);
    }
    CFMetaData cfm=new CFMetaData(KS,"bad",ColumnFamilyType.Standard,null);
    Directories dir=new Directories(cfm);
    for (    File file : dir.getCFDirectories()) {
      assertTrue(BlacklistedDirectories.isUnwritable(file));
    }
  }
  finally {
    for (    DataDirectory dd : Directories.dataDirectories) {
      dd.location.setExecutable(true);
      dd.location.setWritable(true);
    }
    DatabaseDescriptor.setDiskFailurePolicy(origPolicy);
  }
}
