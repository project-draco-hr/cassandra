{
  String queryString=null;
  try {
switch (compression) {
case GZIP:
      Inflater decompressor=new Inflater();
    decompressor.setInput(query.array(),0,query.array().length);
  ByteArrayOutputStream byteArray=new ByteArrayOutputStream();
byte[] buffer=new byte[1024];
while (!decompressor.finished()) {
int size=decompressor.inflate(buffer);
byteArray.write(buffer,0,size);
}
decompressor.end();
queryString=new String(byteArray.toByteArray(),0,byteArray.size(),"UTF-8");
}
}
 catch (DataFormatException e) {
throw newInvalidRequestException("Error deflating query string.");
}
catch (UnsupportedEncodingException e) {
throw newInvalidRequestException("Unknown query string encoding.");
}
try {
return QueryProcessor.process(queryString,state());
}
 catch (RecognitionException e) {
InvalidRequestException badQuery=newInvalidRequestException("Invalid or malformed CQL query string");
badQuery.initCause(e);
throw badQuery;
}
}
