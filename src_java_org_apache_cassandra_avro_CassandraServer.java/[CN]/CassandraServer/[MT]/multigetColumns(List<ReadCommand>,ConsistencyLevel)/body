{
  Map<DecoratedKey,ColumnFamily> cfamilies=readColumnFamily(commands,level);
  Map<String,Collection<IColumn>> columnFamiliesMap=new HashMap<String,Collection<IColumn>>();
  for (  ReadCommand command : commands) {
    ColumnFamily cfamily=cfamilies.get(StorageService.getPartitioner().decorateKey(command.key));
    if (cfamily == null)     continue;
    Collection<IColumn> columns=null;
    if (command.queryPath.superColumnName != null) {
      IColumn column=cfamily.getColumn(command.queryPath.superColumnName);
      if (column != null) {
        columns=column.getSubColumns();
      }
    }
 else {
      columns=cfamily.getSortedColumns();
    }
    if (columns != null && columns.size() != 0) {
      columnFamiliesMap.put(new String(command.key,UTF8),columns);
    }
  }
  return columnFamiliesMap;
}
