{
  sessionNet(3);
  SimpleClient clientA=new SimpleClient(nativeAddr.getHostAddress(),nativePort);
  clientA.connect(false);
  try {
    SimpleClient.SimpleEventHandler eventHandlerA=new SimpleClient.SimpleEventHandler();
    clientA.setEventHandler(eventHandlerA);
    SimpleClient clientB=new SimpleClient(nativeAddr.getHostAddress(),nativePort);
    clientB.connect(false);
    try {
      SimpleClient.SimpleEventHandler eventHandlerB=new SimpleClient.SimpleEventHandler();
      clientB.setEventHandler(eventHandlerB);
      Message.Response resp=clientA.execute(new RegisterMessage(Collections.singletonList(Event.Type.TRACE_COMPLETE)));
      Assert.assertSame(Message.Type.READY,resp.type);
      createTable("CREATE TABLE %s (pk int PRIMARY KEY, v text)");
      QueryMessage query=new QueryMessage("SELECT * FROM " + KEYSPACE + '.'+ currentTable(),QueryOptions.DEFAULT);
      query.setTracingRequested();
      resp=clientA.execute(query);
      Event event=eventHandlerA.queue.poll(250,TimeUnit.MILLISECONDS);
      Assert.assertNotNull(event);
      Assert.assertNull(eventHandlerB.queue.poll(100,TimeUnit.MILLISECONDS));
      Assert.assertSame(Event.Type.TRACE_COMPLETE,event.type);
      Assert.assertEquals(resp.getTracingId(),((Event.TraceComplete)event).traceSessionId);
    }
  finally {
      clientB.close();
    }
  }
  finally {
    clientA.close();
  }
}
