{
  byte[] data=serializer_.serialize(message);
  if (data.length > 0) {
    boolean listening=(message.getFrom().equals(EndPoint.randomLocalEndPoint_)) ? false : true;
    ByteBuffer buffer=MessagingService.packIt(data,false,false,listening);
synchronized (this) {
      if (!pendingWrites_.isEmpty() || !connected_.get()) {
        pendingWrites_.add(buffer);
        return;
      }
      logger_.debug("Sending packets of size " + data.length);
      socketChannel_.write(buffer);
      if (buffer.remaining() > 0) {
        pendingWrites_.add(buffer);
        if ((key_.interestOps() & SelectionKey.OP_WRITE) == 0) {
          SelectorManager.getSelectorManager().modifyKeyForWrite(key_);
        }
      }
    }
  }
}
