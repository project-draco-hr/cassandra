{
  int startIndex=0;
  List<EndPoint> list=new ArrayList<EndPoint>();
  int foundCount=0;
  int N=DatabaseDescriptor.getReplicationFactor();
  List<BigInteger> tokens=new ArrayList<BigInteger>(tokenToEndPointMap.keySet());
  Collections.sort(tokens);
  int index=Collections.binarySearch(tokens,token);
  if (index < 0) {
    index=(index + 1) * (-1);
    if (index >= tokens.size())     index=0;
  }
  int totalNodes=tokens.size();
  list.add(tokenToEndPointMap.get(tokens.get(index)));
  foundCount++;
  startIndex=(index + 1) % totalNodes;
  for (int i=startIndex, count=1; count < totalNodes && foundCount < N; ++count, i=(i + 1) % totalNodes) {
    if (!list.contains(tokenToEndPointMap.get(tokens.get(i)))) {
      list.add(tokenToEndPointMap.get(tokens.get(i)));
      foundCount++;
      continue;
    }
  }
  retrofitPorts(list);
  return list.toArray(new EndPoint[0]);
}
