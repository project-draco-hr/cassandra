{
  Tracing.trace("Acquiring switchLock read lock");
  switchLock.readLock().lock();
  try {
    if (writeCommitLog) {
      Tracing.trace("Appending to commitlog");
      CommitLog.instance.add(mutation);
    }
    DecoratedKey key=StorageService.getPartitioner().decorateKey(mutation.key());
    for (    ColumnFamily cf : mutation.getColumnFamilies()) {
      ColumnFamilyStore cfs=columnFamilyStores.get(cf.id());
      if (cfs == null) {
        logger.error("Attempting to mutate non-existant column family {}",cf.id());
        continue;
      }
      Tracing.trace("Adding to {} memtable",cf.metadata().cfName);
      cfs.apply(key,cf,updateIndexes ? cfs.indexManager.updaterFor(key,cf) : SecondaryIndexManager.nullUpdater);
    }
  }
  finally {
    switchLock.readLock().unlock();
  }
}
