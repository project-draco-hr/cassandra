{
  DatabaseDescriptor.createAllDirectories();
  allocator=new CommitLogSegmentManager();
  executor=DatabaseDescriptor.getCommitLogSync() == Config.CommitLogSync.batch ? new BatchCommitLogService(this) : new PeriodicCommitLogService(this);
  MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
  try {
    mbs.registerMBean(this,new ObjectName("org.apache.cassandra.db:type=Commitlog"));
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  metrics=new CommitLogMetrics(executor,allocator);
}
