{
  segments.add(new CommitLogSegment());
  if (DatabaseDescriptor.getCommitLogSync() == Config.CommitLogSync.periodic) {
    executor=new PeriodicCommitLogExecutorService();
    final Callable syncer=new Callable(){
      public Object call() throws Exception {
        sync();
        return null;
      }
    }
;
    new Thread(new Runnable(){
      public void run(){
        while (true) {
          try {
            executor.submit(syncer).get();
            Thread.sleep(DatabaseDescriptor.getCommitLogSyncPeriod());
          }
 catch (          InterruptedException e) {
            throw new AssertionError(e);
          }
catch (          ExecutionException e) {
            throw new RuntimeException(e);
          }
        }
      }
    }
,"PERIODIC-COMMIT-LOG-SYNCER").start();
  }
 else {
    executor=new BatchCommitLogExecutorService();
  }
}
