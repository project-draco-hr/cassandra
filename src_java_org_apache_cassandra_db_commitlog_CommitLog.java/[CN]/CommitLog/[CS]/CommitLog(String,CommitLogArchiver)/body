{
  this.location=location;
  this.configuration=new Configuration(DatabaseDescriptor.getCommitLogCompression(),DatabaseDescriptor.getEncryptionContext());
  DatabaseDescriptor.createAllDirectories();
  this.archiver=archiver;
  metrics=new CommitLogMetrics();
  executor=DatabaseDescriptor.getCommitLogSync() == Config.CommitLogSync.batch ? new BatchCommitLogService(this) : new PeriodicCommitLogService(this);
  allocator=new CommitLogSegmentManager(this);
  metrics.attach(executor,allocator);
}
