{
  String ksname="Keyspace1";
  String cfname="StandardLeveled";
  Table table=Table.open(ksname);
  ColumnFamilyStore store=table.getColumnFamilyStore(cfname);
  ByteBuffer value=ByteBuffer.wrap(new byte[100 * 1024]);
  int rows=20;
  int columns=10;
  for (int r=0; r < rows; r++) {
    DecoratedKey key=Util.dk(String.valueOf(r));
    RowMutation rm=new RowMutation(ksname,key.key);
    for (int c=0; c < columns; c++) {
      rm.add(cfname,ByteBufferUtil.bytes("column" + c),value,0);
    }
    rm.apply();
    store.forceBlockingFlush();
  }
  LeveledCompactionStrategy strat=(LeveledCompactionStrategy)store.getCompactionStrategy();
  while (strat.getLevelSize(0) > 1) {
    store.forceMajorCompaction();
    Thread.sleep(200);
  }
  for (  SSTableReader s : table.getColumnFamilyStore(cfname).getSSTables()) {
    assertTrue(s.getSSTableLevel() != 6);
    strat.manifest.remove(s);
    LeveledManifest.mutateLevel(s.getSSTableMetadata(),s.descriptor,s.descriptor.filenameFor(Component.STATS),6);
    s.reloadSSTableMetadata();
    strat.manifest.add(s);
  }
  for (  SSTableReader s : table.getColumnFamilyStore(cfname).getSSTables()) {
    assertTrue(s.getSSTableLevel() == 6);
  }
  int[] levels=strat.manifest.getAllLevelSize();
  for (int i=0; i < levels.length; i++) {
    if (i != 6)     assertTrue(levels[i] == 0);
 else     assertTrue(levels[i] == table.getColumnFamilyStore(cfname).getSSTables().size());
  }
}
