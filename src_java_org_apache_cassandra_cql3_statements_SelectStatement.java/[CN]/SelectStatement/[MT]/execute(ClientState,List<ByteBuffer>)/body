{
  List<Row> rows;
  if (isKeyRange()) {
    rows=multiRangeSlice(variables);
  }
 else {
    rows=getSlice(variables);
  }
  CqlResult result=new CqlResult();
  result.type=CqlResultType.ROWS;
  CqlMetadata schema=createSchema();
  List<CqlRow> cqlRows=process(rows,schema,variables);
  if (parameters.isCount) {
    result.schema=new CqlMetadata(Collections.<ByteBuffer,String>emptyMap(),Collections.<ByteBuffer,String>emptyMap(),"AsciiType","LongType");
    List<Column> columns=Collections.singletonList(new Column(countColumn).setValue(ByteBufferUtil.bytes((long)cqlRows.size())));
    result.rows=Collections.singletonList(new CqlRow(countColumn,columns));
    return result;
  }
 else {
    result.schema=schema;
    result.rows=cqlRows;
    return result;
  }
}
