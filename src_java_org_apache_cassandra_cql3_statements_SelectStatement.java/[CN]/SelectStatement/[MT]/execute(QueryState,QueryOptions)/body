{
  ConsistencyLevel cl=options.getConsistency();
  if (cl == null)   throw new InvalidRequestException("Invalid empty consistency level");
  cl.validateForRead(keyspace());
  int limit=getLimit(options);
  long now=System.currentTimeMillis();
  Pageable command=getPageableCommand(options,limit,now);
  int pageSize=options.getPageSize();
  if (selection.isAggregate() && pageSize <= 0)   pageSize=DEFAULT_COUNT_PAGE_SIZE;
  if (pageSize <= 0 || command == null || !QueryPagers.mayNeedPaging(command,pageSize)) {
    return execute(command,options,limit,now);
  }
  QueryPager pager=QueryPagers.pager(command,cl,options.getPagingState());
  if (selection.isAggregate())   return pageAggregateQuery(pager,options,pageSize,now);
  if (needsPostQueryOrdering())   throw new InvalidRequestException("Cannot page queries with both ORDER BY and a IN restriction on the partition key; you must either remove the " + "ORDER BY or the IN and sort client side, or disable paging for this query");
  List<Row> page=pager.fetchPage(pageSize);
  ResultMessage.Rows msg=processResults(page,options,limit,now);
  if (!pager.isExhausted())   msg.result.metadata.setHasMorePages(pager.state());
  return msg;
}
