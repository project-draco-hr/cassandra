{
  ConsistencyLevel cl=options.getConsistency();
  List<ByteBuffer> variables=options.getValues();
  if (cl == null)   throw new InvalidRequestException("Invalid empty consistency level");
  cl.validateForRead(keyspace());
  int limit=getLimit(variables);
  long now=System.currentTimeMillis();
  Pageable command;
  if (isKeyRange || usesSecondaryIndexing) {
    command=getRangeCommand(variables,limit,now);
  }
 else {
    List<ReadCommand> commands=getSliceCommands(variables,limit,now);
    command=commands == null ? null : new Pageable.ReadCommands(commands);
  }
  int pageSize=options.getPageSize();
  if (parameters.isCount && pageSize <= 0)   pageSize=DEFAULT_COUNT_PAGE_SIZE;
  if (pageSize <= 0 || command == null || !QueryPagers.mayNeedPaging(command,pageSize)) {
    return execute(command,cl,variables,limit,now);
  }
 else {
    QueryPager pager=QueryPagers.pager(command,cl,options.getPagingState());
    if (parameters.isCount)     return pageCountQuery(pager,variables,pageSize,now);
    List<Row> page=pager.fetchPage(pageSize);
    ResultMessage.Rows msg=processResults(page,variables,limit,now);
    if (!pager.isExhausted())     msg.result.metadata.setHasMorePages(pager.state());
    return msg;
  }
}
