{
  assert onToken;
  Restriction keyRestriction=keyRestrictions[0];
  ByteBuffer value;
  if (keyRestriction.isEQ()) {
    value=keyRestriction.values(variables).get(0);
  }
 else {
    Restriction.Slice slice=(Restriction.Slice)keyRestriction;
    if (!slice.hasBound(b))     return p.getMinimumToken();
    value=slice.bound(b,variables);
  }
  if (value == null)   throw new InvalidRequestException("Invalid null token value");
  return p.getTokenFactory().fromByteArray(value);
}
