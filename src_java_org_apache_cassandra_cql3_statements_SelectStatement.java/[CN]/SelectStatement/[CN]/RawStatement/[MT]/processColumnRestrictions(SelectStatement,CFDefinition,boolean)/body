{
  boolean canRestrictFurtherComponents=true;
  CFDefinition.Name previous=null;
  Restriction previousRestriction=null;
  Iterator<CFDefinition.Name> iter=cfDef.clusteringColumns().iterator();
  for (int i=0; i < stmt.columnRestrictions.length; i++) {
    CFDefinition.Name cname=iter.next();
    Restriction restriction=stmt.columnRestrictions[i];
    if (restriction == null) {
      canRestrictFurtherComponents=false;
    }
 else     if (!canRestrictFurtherComponents) {
      if (restriction != previousRestriction) {
        if (hasQueriableIndex) {
          stmt.usesSecondaryIndexing=true;
          break;
        }
        if (previousRestriction == null)         throw new InvalidRequestException(String.format("PRIMARY KEY column \"%s\" cannot be restricted (preceding column \"%s\" is not restricted)",cname,previous));
        if (previousRestriction.isMultiColumn() && previousRestriction.isIN())         throw new InvalidRequestException(String.format("PRIMARY KEY column \"%s\" cannot be restricted (preceding column \"%s\" is restricted by an IN tuple notation)",cname,previous));
        throw new InvalidRequestException(String.format("PRIMARY KEY column \"%s\" cannot be restricted (preceding column \"%s\" is restricted by a non-EQ relation)",cname,previous));
      }
    }
 else     if (restriction.isSlice()) {
      canRestrictFurtherComponents=false;
      Restriction.Slice slice=(Restriction.Slice)restriction;
      if (!cfDef.isComposite && (!slice.isInclusive(Bound.START) || !slice.isInclusive(Bound.END)))       stmt.sliceRestriction=slice;
    }
 else     if (restriction.isIN()) {
      if (!restriction.isMultiColumn() && i != stmt.columnRestrictions.length - 1)       throw new InvalidRequestException(String.format("Clustering column \"%s\" cannot be restricted by an IN relation",cname));
      if (stmt.selectACollection())       throw new InvalidRequestException(String.format("Cannot restrict column \"%s\" by IN relation as a collection is selected by the query",cname));
      if (restriction.isMultiColumn())       canRestrictFurtherComponents=false;
    }
    previous=cname;
    previousRestriction=restriction;
  }
}
