{
  CompactionManager.instance.disableAutoCompaction();
  Table table=Table.open("Keyspace1");
  ColumnFamilyStore store=table.getColumnFamilyStore(columnFamilyName);
  Set<String> inserted=new HashSet<String>();
  for (int j=0; j < insertsPerTable; j++) {
    String key=String.valueOf(j);
    RowMutation rm=new RowMutation("Keyspace1",key);
    rm.add(new QueryPath(columnFamilyName,null,"0".getBytes()),new byte[0],j);
    rm.apply();
    inserted.add(key);
    store.forceBlockingFlush();
    assertEquals(inserted.size(),table.getColumnFamilyStore(columnFamilyName).getKeyRange("","",10000).keys.size());
  }
  CompactionManager.instance.submitMajor(store).get();
  assertEquals(1,store.getSSTables().size());
  assertEquals(table.getColumnFamilyStore(columnFamilyName).getKeyRange("","",10000).keys.size(),inserted.size());
}
