{
  logger.info("Writing " + this);
  SSTableWriter writer=new SSTableWriter(cfs.getFlushPath(),columnFamilies.size(),StorageService.getPartitioner());
  DataOutputBuffer buffer=new DataOutputBuffer();
  for (  Map.Entry<DecoratedKey,ColumnFamily> entry : columnFamilies.entrySet()) {
    buffer.reset();
    ColumnFamily.serializer().serializeWithIndexes(entry.getValue(),buffer);
    writer.append(entry.getKey(),buffer);
  }
  SSTableReader ssTable=writer.closeAndOpenReader();
  logger.info("Completed flushing " + ssTable.getFilename());
  return ssTable;
}
