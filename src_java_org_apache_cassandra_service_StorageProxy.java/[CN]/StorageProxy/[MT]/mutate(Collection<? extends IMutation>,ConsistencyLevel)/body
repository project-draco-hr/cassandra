{
  Tracing.trace("Determining replicas for mutation");
  final String localDataCenter=DatabaseDescriptor.getEndpointSnitch().getDatacenter(FBUtilities.getBroadcastAddress());
  long startTime=System.nanoTime();
  List<AbstractWriteResponseHandler> responseHandlers=new ArrayList<AbstractWriteResponseHandler>(mutations.size());
  try {
    for (    IMutation mutation : mutations) {
      if (mutation instanceof CounterMutation) {
        responseHandlers.add(mutateCounter((CounterMutation)mutation,localDataCenter));
      }
 else {
        WriteType wt=mutations.size() <= 1 ? WriteType.SIMPLE : WriteType.UNLOGGED_BATCH;
        responseHandlers.add(performWrite(mutation,consistency_level,localDataCenter,standardWritePerformer,null,wt));
      }
    }
    for (    AbstractWriteResponseHandler responseHandler : responseHandlers) {
      responseHandler.get();
    }
  }
 catch (  WriteTimeoutException ex) {
    writeMetrics.timeouts.mark();
    ClientRequestMetrics.writeTimeouts.inc();
    Tracing.trace("Write timeout; received {} of {} required replies",ex.received,ex.blockFor);
    throw ex;
  }
catch (  UnavailableException e) {
    writeMetrics.unavailables.mark();
    ClientRequestMetrics.writeUnavailables.inc();
    Tracing.trace("Unavailable");
    throw e;
  }
catch (  OverloadedException e) {
    ClientRequestMetrics.writeUnavailables.inc();
    Tracing.trace("Overloaded");
    throw e;
  }
 finally {
    writeMetrics.addNano(System.nanoTime() - startTime);
  }
}
