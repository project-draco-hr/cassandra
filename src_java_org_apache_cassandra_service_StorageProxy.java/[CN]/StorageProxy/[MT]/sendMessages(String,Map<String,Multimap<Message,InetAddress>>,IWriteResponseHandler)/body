{
  for (  Map.Entry<String,Multimap<Message,InetAddress>> entry : dcMessages.entrySet()) {
    String dataCenter=entry.getKey();
    for (    Map.Entry<Message,Collection<InetAddress>> messages : entry.getValue().asMap().entrySet()) {
      Message message=messages.getKey();
      if (dataCenter.equals(localDataCenter)) {
        for (        InetAddress destination : messages.getValue())         MessagingService.instance().sendRR(message,destination,handler);
      }
 else {
        Iterator<InetAddress> iter=messages.getValue().iterator();
        InetAddress target=iter.next();
        while (iter.hasNext()) {
          InetAddress destination=iter.next();
          ByteArrayOutputStream bos=new ByteArrayOutputStream();
          DataOutputStream dos=new DataOutputStream(bos);
          byte[] previousHints=message.getHeader(RowMutation.FORWARD_HEADER);
          if (previousHints != null)           dos.write(previousHints);
          dos.write(destination.getAddress());
          message.setHeader(RowMutation.FORWARD_HEADER,bos.toByteArray());
        }
        MessagingService.instance().sendRR(message,target,handler);
      }
    }
  }
}
