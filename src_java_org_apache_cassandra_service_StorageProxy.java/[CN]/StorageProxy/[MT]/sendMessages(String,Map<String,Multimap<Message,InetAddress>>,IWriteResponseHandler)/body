{
  for (  Map.Entry<String,Multimap<Message,InetAddress>> entry : dcMessages.entrySet()) {
    String dataCenter=entry.getKey();
    for (    Map.Entry<Message,Collection<InetAddress>> messages : entry.getValue().asMap().entrySet()) {
      Message message=messages.getKey();
      message=message.withHeaderRemoved(RowMutation.FORWARD_HEADER);
      if (dataCenter.equals(localDataCenter)) {
        for (        InetAddress destination : messages.getValue())         MessagingService.instance().sendRR(message,destination,handler);
      }
 else {
        Iterator<InetAddress> iter=messages.getValue().iterator();
        InetAddress target=iter.next();
        FastByteArrayOutputStream bos=new FastByteArrayOutputStream();
        DataOutputStream dos=new DataOutputStream(bos);
        while (iter.hasNext()) {
          InetAddress destination=iter.next();
          dos.write(destination.getAddress());
        }
        message=message.withHeaderAdded(RowMutation.FORWARD_HEADER,bos.toByteArray());
        MessagingService.instance().sendRR(message,target,handler);
      }
    }
  }
}
