{
  logger.debug("Starting a blocking truncate operation on keyspace {}, CF ",keyspace,cfname);
  if (isAnyHostDown()) {
    logger.info("Cannot perform truncate, some hosts are down");
    int liveMembers=Gossiper.instance.getLiveMembers().size();
    throw new UnavailableException(ConsistencyLevel.ALL,liveMembers + Gossiper.instance.getUnreachableMembers().size(),liveMembers);
  }
  Set<InetAddress> allEndpoints=Gossiper.instance.getLiveMembers();
  int blockFor=allEndpoints.size();
  final TruncateResponseHandler responseHandler=new TruncateResponseHandler(blockFor);
  logger.debug("Starting to send truncate messages to hosts {}",allEndpoints);
  final Truncation truncation=new Truncation(keyspace,cfname);
  MessageOut<Truncation> message=truncation.createMessage();
  for (  InetAddress endpoint : allEndpoints)   MessagingService.instance().sendRR(message,endpoint,responseHandler);
  logger.debug("Sent all truncate messages, now waiting for {} responses",blockFor);
  responseHandler.get();
  logger.debug("truncate done");
}
