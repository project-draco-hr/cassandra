{
  TokenMetadata.Topology topology=StorageService.instance.getTokenMetadata().cachedOnlyTokenMap().getTopology();
  Multimap<String,InetAddress> localEndpoints=HashMultimap.create(topology.getDatacenterRacks().get(localDataCenter));
  if (localEndpoints.size() == 1)   return localEndpoints.values();
  String localRack=DatabaseDescriptor.getEndpointSnitch().getRack(FBUtilities.getBroadcastAddress());
  Collection<InetAddress> chosenEndpoints=new BatchlogEndpointSelector(localRack).chooseEndpoints(localEndpoints);
  if (chosenEndpoints.isEmpty()) {
    if (consistencyLevel == ConsistencyLevel.ANY)     return Collections.singleton(FBUtilities.getBroadcastAddress());
    throw new UnavailableException(ConsistencyLevel.ONE,1,0);
  }
  return chosenEndpoints;
}
