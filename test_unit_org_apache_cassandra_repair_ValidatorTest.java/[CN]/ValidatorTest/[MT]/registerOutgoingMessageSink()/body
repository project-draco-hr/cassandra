{
  final SettableFuture<MessageOut> future=SettableFuture.create();
  MessagingService.instance().addMessageSink(new IMessageSink(){
    public boolean allowOutgoingMessage(    MessageOut message,    int id,    InetAddress to){
      future.set(message);
      return false;
    }
    public boolean allowIncomingMessage(    MessageIn message,    int id){
      return false;
    }
  }
);
  return future;
}
