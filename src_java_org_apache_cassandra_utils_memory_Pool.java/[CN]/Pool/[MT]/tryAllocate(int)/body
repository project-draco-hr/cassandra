{
  while (true) {
    long cur;
    if ((cur=allocated.get()) + size > limit)     return false;
    if (allocated.compareAndSet(cur,cur + size)) {
      maybeClean();
      return true;
    }
  }
}
