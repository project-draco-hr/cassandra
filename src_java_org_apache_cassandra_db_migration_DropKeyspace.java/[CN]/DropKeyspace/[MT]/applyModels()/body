{
  String snapshotName=Table.getTimestampedSnapshotName(name);
  KSMetaData ksm=schema.getTableDefinition(name);
  for (  CFMetaData cfm : ksm.cfMetaData().values()) {
    ColumnFamilyStore cfs=Table.open(ksm.name,schema).getColumnFamilyStore(cfm.cfName);
    schema.purge(cfm);
    if (!StorageService.instance.isClientMode()) {
      cfs.snapshot(snapshotName);
      Table.open(ksm.name,schema).dropCf(cfm.cfId);
    }
  }
  Table.clear(ksm.name,schema);
  schema.clearTableDefinition(ksm,newVersion);
}
