{
  ThreadGroup threadGroup=Thread.currentThread().getThreadGroup();
  if (threadGroup instanceof SecurityThreadGroup) {
    Set<String> allowedPackages=((SecurityThreadGroup)threadGroup).getAllowedPackages();
    if (allowedPackages != null && !allowedPackages.contains(pkg))     throw new AccessControlException("access denied: " + new RuntimePermission("accessClassInPackage." + pkg),new RuntimePermission("accessClassInPackage." + pkg));
    super.checkPackageAccess(pkg);
  }
}
