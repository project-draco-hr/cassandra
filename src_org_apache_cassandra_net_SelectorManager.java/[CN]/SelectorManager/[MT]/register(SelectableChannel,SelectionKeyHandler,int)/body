{
  if ((channel == null) || (handler == null)) {
    throw new NullPointerException();
  }
  selector_.wakeup();
  SelectionKey key=channel.register(selector_,ops,handler);
synchronized (cancelledKeys_) {
    cancelledKeys_.remove(key);
  }
  selector_.wakeup();
  return key;
}
