{
  ColumnDefinition cfDef=indexDef.indexedColumn(baseMetadata);
  if (cfDef.type.isCollection() && cfDef.type.isMultiCell()) {
switch (((CollectionType)cfDef.type).kind) {
case LIST:
      return new CompositesIndexOnCollectionValue();
case SET:
    return new CompositesIndexOnCollectionKey();
case MAP:
  if (indexDef.options.containsKey(SecondaryIndex.INDEX_KEYS_OPTION_NAME))   return new CompositesIndexOnCollectionKey();
 else   if (indexDef.options.containsKey(SecondaryIndex.INDEX_ENTRIES_OPTION_NAME))   return new CompositesIndexOnCollectionKeyAndValue();
 else   return new CompositesIndexOnCollectionValue();
}
}
switch (cfDef.kind) {
case CLUSTERING:
return new CompositesIndexOnClusteringKey();
case REGULAR:
return new CompositesIndexOnRegular();
case PARTITION_KEY:
return new CompositesIndexOnPartitionKey();
}
throw new AssertionError();
}
