{
  if (last == null && !source.hasNext())   return endOfData();
  onKeyChange();
  boolean keyChanged=false;
  while (!keyChanged) {
    if (last != null)     reduce(last);
    if (!source.hasNext()) {
      last=null;
      break;
    }
    T1 current=source.next();
    if (last != null && !isEqual(current,last))     keyChanged=true;
    last=current;
  }
  return getReduced();
}
