{
  Multimap<InetAddress,Range<Token>> rangeFetchMapMap=HashMultimap.create();
  for (  Range<Token> range : rangesWithSources.keySet()) {
    boolean foundSource=false;
    outer:     for (    InetAddress address : rangesWithSources.get(range)) {
      if (address.equals(FBUtilities.getBroadcastAddress()))       continue;
      for (      ISourceFilter filter : sourceFilters) {
        if (!filter.shouldInclude(address))         continue outer;
      }
      rangeFetchMapMap.put(address,range);
      foundSource=true;
      break;
    }
    if (!foundSource)     throw new IllegalStateException("unable to find sufficient sources for streaming range " + range);
  }
  return rangeFetchMapMap;
}
