{
  HashMap<ColumnFamilyStore,Memtable> memtablesToFlush=new HashMap<ColumnFamilyStore,Memtable>();
  flusherLock_.readLock().lock();
  try {
    CommitLog.open().add(row);
    for (    ColumnFamily columnFamily : row.getColumnFamilies()) {
      Memtable memtableToFlush;
      ColumnFamilyStore cfStore=columnFamilyStores_.get(columnFamily.name());
      if ((memtableToFlush=cfStore.apply(row.key(),columnFamily)) != null)       memtablesToFlush.put(cfStore,memtableToFlush);
    }
  }
  finally {
    flusherLock_.readLock().unlock();
  }
  if (memtablesToFlush.size() > 0) {
    for (    Map.Entry<ColumnFamilyStore,Memtable> entry : memtablesToFlush.entrySet())     entry.getKey().switchMemtable(entry.getValue());
  }
}
