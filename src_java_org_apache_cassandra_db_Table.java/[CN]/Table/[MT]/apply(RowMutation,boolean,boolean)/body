{
  if (!mutation.getTable().equals(Tracing.TRACE_KS))   logger.debug("Acquiring switchLock");
  switchLock.readLock().lock();
  try {
    if (writeCommitLog) {
      logger.debug("Appending to commitlog");
      CommitLog.instance.add(mutation);
    }
    DecoratedKey key=StorageService.getPartitioner().decorateKey(mutation.key());
    for (    ColumnFamily cf : mutation.getColumnFamilies()) {
      ColumnFamilyStore cfs=columnFamilyStores.get(cf.id());
      if (cfs == null) {
        logger.error("Attempting to mutate non-existant column family " + cf.id());
        continue;
      }
      logger.debug("Adding to memtable");
      cfs.apply(key,cf,updateIndexes ? cfs.indexManager.updaterFor(key,true) : SecondaryIndexManager.nullUpdater);
    }
  }
  finally {
    switchLock.readLock().unlock();
  }
}
