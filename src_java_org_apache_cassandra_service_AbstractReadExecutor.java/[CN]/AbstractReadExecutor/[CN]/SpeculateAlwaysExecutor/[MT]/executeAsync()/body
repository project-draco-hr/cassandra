{
  int limit=unfiltered.size() >= 2 ? 2 : 1;
  for (int i=0; i < limit; i++) {
    InetAddress endpoint=unfiltered.get(i);
    if (endpoint.equals(FBUtilities.getBroadcastAddress())) {
      logger.trace("reading full data locally");
      StageManager.getStage(Stage.READ).execute(new LocalReadRunnable(command,handler));
    }
 else {
      logger.trace("reading full data from {}",endpoint);
      MessagingService.instance().sendRR(command.createMessage(),endpoint,handler);
    }
  }
  if (handler.endpoints.size() <= limit)   return;
  ReadCommand digestCommand=command.copy();
  digestCommand.setDigestQuery(true);
  MessageOut<?> message=digestCommand.createMessage();
  for (int i=limit; i < handler.endpoints.size(); i++) {
    InetAddress endpoint=handler.endpoints.get(i);
    if (endpoint.equals(FBUtilities.getBroadcastAddress())) {
      logger.trace("reading data locally, isDigest: {}",command.isDigestQuery());
      StageManager.getStage(Stage.READ).execute(new LocalReadRunnable(digestCommand,handler));
    }
 else {
      logger.trace("reading full data from {}, isDigest: {}",endpoint,command.isDigestQuery());
      MessagingService.instance().sendRR(message,endpoint,handler);
    }
  }
}
