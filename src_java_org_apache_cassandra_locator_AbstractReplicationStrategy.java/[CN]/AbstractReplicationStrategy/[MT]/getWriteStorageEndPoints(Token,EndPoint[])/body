{
  Map<Token,EndPoint> tokenToEndPointMap=tokenMetadata_.cloneTokenEndPointMap();
  Map<Token,EndPoint> bootstrapTokensToEndpointMap=tokenMetadata_.cloneBootstrapNodes();
  ArrayList<EndPoint> list=new ArrayList<EndPoint>(Arrays.asList(naturalEndpoints));
  for (  Token t : bootstrapTokensToEndpointMap.keySet()) {
    EndPoint ep=bootstrapTokensToEndpointMap.get(t);
    tokenToEndPointMap.put(t,ep);
    try {
      for (      Range r : getRangeMap(tokenToEndPointMap).get(ep)) {
        if (r.contains(token)) {
          list.add(ep);
          break;
        }
      }
    }
  finally {
      tokenToEndPointMap.remove(t);
    }
  }
  retrofitPorts(list);
  return list.toArray(new EndPoint[list.size()]);
}
