{
  long lastVersion=tokenMetadata.getRingVersion();
  if (lastVersion > clonedTokenMetadataVersion) {
synchronized (this) {
      if (lastVersion > clonedTokenMetadataVersion) {
        logger.debug("clearing cached endpoints");
        tokenMetadataClone=null;
        cachedEndpoints.clear();
        clonedTokenMetadataVersion=lastVersion;
      }
    }
  }
  return cachedEndpoints.get(t);
}
