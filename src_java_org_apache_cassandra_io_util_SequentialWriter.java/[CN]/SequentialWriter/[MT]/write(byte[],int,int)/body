{
  if (buffer == null)   throw new ClosedChannelException();
  int position=offset;
  int remaining=length;
  while (remaining > 0) {
    if (!buffer.hasRemaining())     reBuffer();
    int toCopy=Math.min(remaining,buffer.remaining());
    buffer.put(data,position,toCopy);
    remaining-=toCopy;
    position+=toCopy;
    isDirty=true;
    syncNeeded=true;
  }
}
