{
  if (buffer == null)   throw new ClosedChannelException();
  int length=src.remaining();
  int finalLimit=src.limit();
  while (src.hasRemaining()) {
    if (!buffer.hasRemaining())     reBuffer();
    if (buffer.remaining() < src.remaining())     src.limit(src.position() + buffer.remaining());
    buffer.put(src);
    src.limit(finalLimit);
    isDirty=true;
    syncNeeded=true;
  }
  return length;
}
