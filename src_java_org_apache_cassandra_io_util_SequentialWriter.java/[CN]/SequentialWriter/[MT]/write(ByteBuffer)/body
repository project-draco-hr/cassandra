{
  if (buffer == null)   throw new ClosedChannelException();
  int length=src.remaining();
  int offset=src.position();
  while (length > 0) {
    int n=writeAtMost(src,offset,length);
    offset+=n;
    length-=n;
    isDirty=true;
    syncNeeded=true;
  }
  src.position(offset);
  return length;
}
