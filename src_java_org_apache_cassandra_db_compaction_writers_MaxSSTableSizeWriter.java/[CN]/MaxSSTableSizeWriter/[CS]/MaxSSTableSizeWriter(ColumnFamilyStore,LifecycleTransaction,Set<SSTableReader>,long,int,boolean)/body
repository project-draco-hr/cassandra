{
  super(cfs,txn,nonExpiredSSTables,offline);
  this.allSSTables=txn.originals();
  this.level=level;
  this.maxSSTableSize=maxSSTableSize;
  long totalSize=cfs.getExpectedCompactedFileSize(nonExpiredSSTables,txn.opType());
  expectedWriteSize=Math.min(maxSSTableSize,totalSize);
  estimatedTotalKeys=SSTableReader.getApproximateKeyCount(nonExpiredSSTables);
  estimatedSSTables=Math.max(1,estimatedTotalKeys / maxSSTableSize);
  File sstableDirectory=cfs.directories.getLocationForDisk(getWriteDirectory(expectedWriteSize));
  @SuppressWarnings("resource") SSTableWriter writer=SSTableWriter.create(Descriptor.fromFilename(cfs.getSSTablePath(sstableDirectory)),estimatedTotalKeys / estimatedSSTables,minRepairedAt,cfs.metadata,cfs.partitioner,new MetadataCollector(allSSTables,cfs.metadata.comparator,level),SerializationHeader.make(cfs.metadata,nonExpiredSSTables),txn);
  sstableWriter.switchWriter(writer);
}
