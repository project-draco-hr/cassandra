{
  try {
    request.attach(connection);
    lastWriteFuture=channel.write(request);
    Message.Response msg=responseHandler.responses.take();
    if (msg instanceof ErrorMessage)     throw new RuntimeException(((ErrorMessage)msg).errorMsg);
    return msg;
  }
 catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
}
