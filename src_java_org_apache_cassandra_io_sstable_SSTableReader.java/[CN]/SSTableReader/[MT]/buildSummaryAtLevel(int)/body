{
  RandomAccessReader primaryIndex=RandomAccessReader.open(new File(descriptor.filenameFor(Component.PRIMARY_INDEX)));
  try {
    long indexSize=primaryIndex.length();
    IndexSummaryBuilder summaryBuilder=new IndexSummaryBuilder(estimatedKeys(),metadata.getMinIndexInterval(),newSamplingLevel);
    long indexPosition;
    while ((indexPosition=primaryIndex.getFilePointer()) != indexSize) {
      summaryBuilder.maybeAddEntry(partitioner.decorateKey(ByteBufferUtil.readWithShortLength(primaryIndex)),indexPosition);
      RowIndexEntry.Serializer.skip(primaryIndex);
    }
    return summaryBuilder.build(partitioner);
  }
  finally {
    FileUtils.closeQuietly(primaryIndex);
  }
}
