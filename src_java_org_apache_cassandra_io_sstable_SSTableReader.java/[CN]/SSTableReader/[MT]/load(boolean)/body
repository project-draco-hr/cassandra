{
  SegmentedFile.Builder ibuilder=SegmentedFile.getBuilder(DatabaseDescriptor.getIndexAccessMode());
  SegmentedFile.Builder dbuilder=SegmentedFile.getBuilder(DatabaseDescriptor.getDiskAccessMode());
  indexSummary=new IndexSummary();
  BufferedRandomAccessFile input=new BufferedRandomAccessFile(desc.filenameFor(Component.PRIMARY_INDEX),"r");
  try {
    long indexSize=input.length();
    if (recreatebloom)     bf=BloomFilter.getFilter((int)(input.length() / 32),15);
    while (true) {
      long indexPosition=input.getFilePointer();
      if (indexPosition == indexSize)       break;
      DecoratedKey decoratedKey=decodeKey(partitioner,desc,FBUtilities.readShortByteArray(input));
      if (recreatebloom)       bf.add(decoratedKey.key);
      long dataPosition=input.readLong();
      indexSummary.maybeAddEntry(decoratedKey,indexPosition);
      ibuilder.addPotentialBoundary(indexPosition);
      dbuilder.addPotentialBoundary(dataPosition);
    }
    indexSummary.complete();
  }
  finally {
    input.close();
  }
  indexSummary.complete();
  ifile=ibuilder.complete(desc.filenameFor(Component.PRIMARY_INDEX));
  dfile=dbuilder.complete(desc.filenameFor(Component.DATA));
}
