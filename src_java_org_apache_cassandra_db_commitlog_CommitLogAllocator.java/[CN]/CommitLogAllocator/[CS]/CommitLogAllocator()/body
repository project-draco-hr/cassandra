{
  Runnable runnable=new WrappedRunnable(){
    public void runMayThrow() throws Exception {
      while (run) {
        try {
          Runnable r=queue.poll(TICK_CYCLE_TIME,TimeUnit.MILLISECONDS);
          if (r != null) {
            r.run();
          }
 else {
            if (availableSegments.isEmpty() && (activeSegments.isEmpty() || createReserveSegments)) {
              logger.debug("No segments in reserve; creating a fresh one");
              createFreshSegment();
            }
          }
        }
 catch (        Throwable t) {
          if (!CommitLog.handleCommitError("Failed to allocate new commit log segments",t))           return;
        }
      }
    }
  }
;
  allocationThread=new Thread(runnable,"COMMIT-LOG-ALLOCATOR");
  allocationThread.start();
}
