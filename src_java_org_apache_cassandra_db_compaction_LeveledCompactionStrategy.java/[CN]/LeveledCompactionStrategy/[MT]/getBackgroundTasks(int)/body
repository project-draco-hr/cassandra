{
  LeveledCompactionTask currentTask=task.get();
  if (currentTask != null && !currentTask.isDone()) {
    logger.debug("Compaction still in progress for {}",this);
    return Collections.emptyList();
  }
  Collection<SSTableReader> sstables=manifest.getCompactionCandidates();
  if (sstables.isEmpty()) {
    logger.debug("No compaction necessary for {}",this);
    return Collections.emptyList();
  }
  LeveledCompactionTask newTask=new LeveledCompactionTask(cfs,sstables,gcBefore,this.maxSSTableSize);
  return task.compareAndSet(currentTask,newTask) ? Collections.<AbstractCompactionTask>singletonList(newTask) : Collections.<AbstractCompactionTask>emptyList();
}
