{
  if (name.hasKeyspace()) {
    if (keyspace != null && !keyspace.equals(name.getKeyspace()))     throw new InvalidRequestException(String.format("Statement on keyspace %s cannot refer to a user type in keyspace %s; " + "user types can only be used in the keyspace they are defined in",keyspace,name.getKeyspace()));
  }
 else {
    name.setKeyspace(keyspace);
  }
  KSMetaData ksm=Schema.instance.getKSMetaData(name.getKeyspace());
  if (ksm == null)   throw new InvalidRequestException("Unknown keyspace " + name.getKeyspace());
  UserType type=ksm.userTypes.getType(name.getUserTypeName());
  if (type == null)   throw new InvalidRequestException("Unknown type " + name);
  if (!frozen)   throw new InvalidRequestException("Non-frozen User-Defined types are not supported, please use frozen<>");
  return new UserDefined(name.toString(),type);
}
