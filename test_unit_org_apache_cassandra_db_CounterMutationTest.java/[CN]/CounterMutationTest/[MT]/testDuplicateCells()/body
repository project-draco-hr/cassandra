{
  ColumnFamilyStore cfs=Keyspace.open(KS).getColumnFamilyStore(CF1);
  cfs.truncateBlocking();
  ColumnFamily cells=ArrayBackedSortedColumns.factory.create(cfs.metadata);
  cells.addCounter(cellname(1),1L);
  cells.addCounter(cellname(1),2L);
  cells.addCounter(cellname(1),3L);
  cells.addCounter(cellname(1),4L);
  new CounterMutation(new Mutation(KS,bytes(1),cells),ConsistencyLevel.ONE).apply();
  ColumnFamily current=cfs.getColumnFamily(QueryFilter.getIdentityFilter(dk(bytes(1)),CF1,System.currentTimeMillis()));
  ByteBuffer context=current.getColumn(cellname(1)).value();
  assertEquals(10L,CounterContext.instance().total(context));
  assertEquals(ClockAndCount.create(1L,10L),CounterContext.instance().getLocalClockAndCount(context));
  assertEquals(ClockAndCount.create(1L,10L),cfs.getCachedCounter(bytes(1),cellname(1)));
}
