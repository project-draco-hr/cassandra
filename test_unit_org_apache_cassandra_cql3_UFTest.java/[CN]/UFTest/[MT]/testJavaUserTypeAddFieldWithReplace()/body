{
  String type=KEYSPACE + "." + createType("CREATE TYPE %s (txt text, i int)");
  createTable("CREATE TABLE %s (key int primary key, udt frozen<" + type + ">)");
  String fName1replace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS text LANGUAGE java\n"+ "AS $$return udt.getString(\"txt\");$$;");
  String fName2replace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS int LANGUAGE java\n"+ "AS $$return Integer.valueOf(udt.getInt(\"i\"));$$;");
  String fName3replace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS double LANGUAGE java\n"+ "AS $$return Double.valueOf(udt.getDouble(\"added\"));$$;");
  String fName4replace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS frozen<"+ type+ "> LANGUAGE java\n"+ "AS $$return udt;$$;");
  String fName1noReplace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS text LANGUAGE java\n"+ "AS $$return udt.getString(\"txt\");$$;");
  String fName2noReplace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS int LANGUAGE java\n"+ "AS $$return Integer.valueOf(udt.getInt(\"i\"));$$;");
  String fName3noReplace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS double LANGUAGE java\n"+ "AS $$return Double.valueOf(udt.getDouble(\"added\"));$$;");
  String fName4noReplace=createFunction(KEYSPACE,"frozen<" + type + ">","CREATE FUNCTION %s( udt frozen<" + type + "> ) "+ "RETURNS frozen<"+ type+ "> LANGUAGE java\n"+ "AS $$return udt;$$;");
  execute("INSERT INTO %s (key, udt) VALUES (1, {txt: 'one', i:1})");
  assertRows(execute("SELECT " + fName1replace + "(udt) FROM %s WHERE key = 1"),row("one"));
  assertRows(execute("SELECT " + fName2replace + "(udt) FROM %s WHERE key = 1"),row(1));
  execute("ALTER TYPE " + type + " ADD added double");
  execute("INSERT INTO %s (key, udt) VALUES (2, {txt: 'two', i:2, added: 2})");
  execute(String.format("CREATE OR REPLACE FUNCTION %s( udt frozen<%s> ) " + "RETURNS text LANGUAGE java\n" + "AS $$return "+ "     udt.getString(\"txt\");$$;",fName1replace,type));
  Assert.assertEquals(1,Functions.find(parseFunctionName(fName1replace)).size());
  execute(String.format("CREATE OR REPLACE FUNCTION %s( udt frozen<%s> ) " + "RETURNS int LANGUAGE java\n" + "AS $$return "+ "     Integer.valueOf(udt.getInt(\"i\"));$$;",fName2replace,type));
  Assert.assertEquals(1,Functions.find(parseFunctionName(fName2replace)).size());
  execute(String.format("CREATE OR REPLACE FUNCTION %s( udt frozen<%s> ) " + "RETURNS double LANGUAGE java\n" + "AS $$return "+ "     Double.valueOf(udt.getDouble(\"added\"));$$;",fName3replace,type));
  Assert.assertEquals(1,Functions.find(parseFunctionName(fName3replace)).size());
  execute(String.format("CREATE OR REPLACE FUNCTION %s( udt frozen<%s> ) " + "RETURNS frozen<%s> LANGUAGE java\n" + "AS $$return "+ "     udt;$$;",fName4replace,type,type));
  Assert.assertEquals(1,Functions.find(parseFunctionName(fName4replace)).size());
  assertRows(execute("SELECT " + fName1replace + "(udt) FROM %s WHERE key = 2"),row("two"));
  assertRows(execute("SELECT " + fName2replace + "(udt) FROM %s WHERE key = 2"),row(2));
  assertRows(execute("SELECT " + fName3replace + "(udt) FROM %s WHERE key = 2"),row(2d));
  assertRows(execute("SELECT " + fName3replace + "(udt) FROM %s WHERE key = 1"),row(0d));
  assertRows(execute("SELECT " + fName1noReplace + "(udt) FROM %s WHERE key = 2"),row("two"));
  assertRows(execute("SELECT " + fName2noReplace + "(udt) FROM %s WHERE key = 2"),row(2));
  assertRows(execute("SELECT " + fName3noReplace + "(udt) FROM %s WHERE key = 2"),row(2d));
  assertRows(execute("SELECT " + fName3noReplace + "(udt) FROM %s WHERE key = 1"),row(0d));
  execute("DROP FUNCTION " + fName1replace);
  execute("DROP FUNCTION " + fName2replace);
  execute("DROP FUNCTION " + fName3replace);
  execute("DROP FUNCTION " + fName4replace);
  execute("DROP FUNCTION " + fName1noReplace);
  execute("DROP FUNCTION " + fName2noReplace);
  execute("DROP FUNCTION " + fName3noReplace);
  execute("DROP FUNCTION " + fName4noReplace);
}
