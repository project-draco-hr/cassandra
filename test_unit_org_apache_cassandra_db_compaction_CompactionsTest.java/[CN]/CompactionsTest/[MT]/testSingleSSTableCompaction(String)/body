{
  Keyspace keyspace=Keyspace.open(KEYSPACE1);
  ColumnFamilyStore store=keyspace.getColumnFamilyStore(CF_DENSE1);
  store.clearUnsafe();
  store.metadata.gcGraceSeconds(1);
  store.setCompactionStrategyClass(strategyClassName);
  store.disableAutoCompaction();
  long timestamp=populate(KEYSPACE1,CF_DENSE1,0,9,3);
  store.forceBlockingFlush();
  assertEquals(1,store.getSSTables().size());
  long originalSize=store.getSSTables().iterator().next().uncompressedLength();
  TimeUnit.SECONDS.sleep(5);
  store.enableAutoCompaction();
  FBUtilities.waitOnFutures(CompactionManager.instance.submitBackground(store));
  while (CompactionManager.instance.getPendingTasks() > 0 || CompactionManager.instance.getActiveCompactions() > 0)   TimeUnit.SECONDS.sleep(1);
  assertEquals(1,store.getSSTables().size());
  long size=store.getSSTables().iterator().next().uncompressedLength();
  assertTrue("should be less than " + originalSize + ", but was "+ size,size < originalSize);
  assertMaxTimestamp(store,timestamp);
  return store;
}
