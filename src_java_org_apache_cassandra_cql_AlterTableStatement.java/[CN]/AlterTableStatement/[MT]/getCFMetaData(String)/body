{
  CFMetaData meta=Schema.instance.getCFMetaData(keyspace,columnFamily);
  CFMetaData cfm=meta.clone();
  ByteBuffer columnName=this.oType == OperationType.OPTS ? null : meta.comparator.fromString(this.columnName);
switch (oType) {
case ADD:
    if (!cfm.getKeyAliases().isEmpty() && cfm.getKeyAliases().contains(columnName))     throw new InvalidRequestException("Invalid column name: " + this.columnName + ", because it equals to a key alias.");
  cfm.addColumnDefinition(new ColumnDefinition(columnName,TypeParser.parse(validator),null,null,null,null));
break;
case ALTER:
if (!cfm.getKeyAliases().isEmpty() && cfm.getKeyAliases().get(0).equals(columnName)) {
cfm.keyValidator(TypeParser.parse(validator));
}
 else {
ColumnDefinition toUpdate=null;
for (ColumnDefinition columnDef : cfm.getColumn_metadata().values()) {
  if (columnDef.name.equals(columnName)) {
    toUpdate=columnDef;
    break;
  }
}
if (toUpdate == null) throw new InvalidRequestException(String.format("Column '%s' was not found in CF '%s'",this.columnName,columnFamily));
toUpdate.setValidator(TypeParser.parse(validator));
}
break;
case DROP:
ColumnDefinition toDelete=null;
for (ColumnDefinition columnDef : cfm.getColumn_metadata().values()) {
if (columnDef.name.equals(columnName)) {
toDelete=columnDef;
}
}
if (toDelete == null) throw new InvalidRequestException(String.format("Column '%s' was not found in CF '%s'",this.columnName,columnFamily));
cfm.removeColumnDefinition(toDelete);
break;
case OPTS:
if (cfProps == null) throw new InvalidRequestException(String.format("ALTER COLUMNFAMILY WITH invoked, but no parameters found"));
cfProps.validate();
applyPropertiesToCFMetadata(cfm,cfProps);
break;
}
return cfm;
}
