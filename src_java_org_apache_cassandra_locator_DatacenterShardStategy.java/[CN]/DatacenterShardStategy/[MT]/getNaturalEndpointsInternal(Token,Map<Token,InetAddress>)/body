{
  ArrayList<InetAddress> endpoints=new ArrayList<InetAddress>();
  if (null == tokens || this.tokens.size() != tokenToEndPointMap.keySet().size()) {
    loadEndPoints(tokenToEndPointMap,tokenToEndPointMap.keySet());
  }
  for (  String dc : dcMap.keySet()) {
    int foundCount=0;
    ArrayList<InetAddress> forloopReturn=new ArrayList<InetAddress>();
    int replicas_=dcReplicationFactor.get(dc);
    List tokens=dcMap.get(dc);
    boolean bOtherRack=false;
    boolean doneDataCenterItr;
    int index=Collections.binarySearch(tokens,searchToken);
    if (index < 0) {
      index=(index + 1) * (-1);
      if (index >= tokens.size()) {
        index=0;
      }
    }
    int totalNodes=tokens.size();
    InetAddress primaryHost=tokenToEndPointMap.get(tokens.get(index));
    forloopReturn.add(primaryHost);
    foundCount++;
    if (replicas_ == 1) {
      continue;
    }
    int startIndex=(index + 1) % totalNodes;
    for (int i=startIndex, count=1; count < totalNodes && foundCount < replicas_; ++count, i=(i + 1) % totalNodes) {
      InetAddress endPointOfIntrest=tokenToEndPointMap.get(tokens.get(i));
      if ((replicas_ - 1) > foundCount) {
        forloopReturn.add(endPointOfIntrest);
        continue;
      }
 else {
        doneDataCenterItr=true;
      }
      if (!bOtherRack) {
        if (!endPointSnitch.isOnSameRack(primaryHost,endPointOfIntrest)) {
          forloopReturn.add(tokenToEndPointMap.get(tokens.get(i)));
          bOtherRack=true;
          foundCount++;
        }
      }
      if (doneDataCenterItr && bOtherRack) {
        break;
      }
    }
    for (int i=startIndex, count=1; count < totalNodes && foundCount < replicas_; ++count, i=(i + 1) % totalNodes) {
      if (!forloopReturn.contains(tokenToEndPointMap.get(tokens.get(i)))) {
        forloopReturn.add(tokenToEndPointMap.get(tokens.get(i)));
        foundCount++;
      }
    }
    endpoints.addAll(forloopReturn);
  }
  return endpoints;
}
