{
  indexFile=SequentialWriter.open(new File(descriptor.filenameFor(Component.PRIMARY_INDEX)));
  builder=SegmentedFile.getBuilder(DatabaseDescriptor.getIndexAccessMode());
  summary=new IndexSummaryBuilder(keyCount,metadata.getMinIndexInterval(),Downsampling.BASE_SAMPLING_LEVEL);
  bf=FilterFactory.getFilter(keyCount,metadata.getBloomFilterFpChance(),true);
  indexFile.setPostFlushListener(new Runnable(){
    public void run(){
      summary.markIndexSynced(indexFile.getLastFlushOffset());
    }
  }
);
  dataFile.setPostFlushListener(new Runnable(){
    public void run(){
      summary.markDataSynced(dataFile.getLastFlushOffset());
    }
  }
);
}
