{
  CellNameType cellType=subComparator == null ? comparator : new CompoundDenseCellNameType(Arrays.asList(comparator.asAbstractType(),subComparator));
  while (true) {
    if (columns.hasNext()) {
      ColumnOrSuperColumn cosc=columns.next();
      SortedMap<CellName,Cell> map;
      List<Cell> cells=unthriftify(cosc);
      if (cells.size() == 1) {
        map=ImmutableSortedMap.of(cells.get(0).name(),cells.get(0));
      }
 else {
        assert isSuper;
        map=new TreeMap<CellName,Cell>(cellType);
        for (        Cell cell : cells)         map.put(cell.name(),cell);
      }
      return Pair.<ByteBuffer,SortedMap<CellName,Cell>>create(currentRow.key,map);
    }
    if (!rows.hasNext())     return endOfData();
    nextRow();
  }
}
