{
  ColumnFamilyStore cfs=Table.open(tableName).getColumnFamilyStore(cfName);
  KSMetaData existing=DatabaseDescriptor.getTableDefinition(tableName);
  CFMetaData cfm=existing.cfMetaData().get(cfName);
  KSMetaData ksm=makeNewKeyspaceDefinition(existing);
  CFMetaData.purge(cfm);
  DatabaseDescriptor.setTableDefinition(ksm,newVersion);
  if (!StorageService.instance.isClientMode()) {
    cfs.snapshot(Table.getTimestampedSnapshotName(null));
    CompactionManager.instance.getCompactionLock().lock();
    cfs.flushLock.lock();
    try {
      Table.open(ksm.name).dropCf(cfm.cfId);
    }
  finally {
      cfs.flushLock.unlock();
      CompactionManager.instance.getCompactionLock().unlock();
    }
  }
}
