{
  ColumnFamilyStore cfs=Table.open(tableName,schema).getColumnFamilyStore(cfName);
  KSMetaData existing=schema.getTableDefinition(tableName);
  CFMetaData cfm=existing.cfMetaData().get(cfName);
  KSMetaData ksm=makeNewKeyspaceDefinition(existing);
  schema.purge(cfm);
  schema.setTableDefinition(ksm,newVersion);
  if (!StorageService.instance.isClientMode()) {
    if (DatabaseDescriptor.isAutoSnapshot())     cfs.snapshot(Table.getTimestampedSnapshotName(cfs.columnFamily));
    CompactionManager.instance.getCompactionLock().lock();
    cfs.flushLock.lock();
    try {
      Table.open(ksm.name,schema).dropCf(cfm.cfId);
    }
  finally {
      cfs.flushLock.unlock();
      CompactionManager.instance.getCompactionLock().unlock();
    }
  }
}
