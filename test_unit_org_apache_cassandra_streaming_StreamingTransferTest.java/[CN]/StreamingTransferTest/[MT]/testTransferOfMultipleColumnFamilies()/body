{
  String keyspace="KeyCacheSpace";
  IPartitioner p=StorageService.getPartitioner();
  String[] columnFamilies=new String[]{"Standard1","Standard2","Standard3"};
  List<SSTableReader> ssTableReaders=new ArrayList<>();
  NavigableMap<DecoratedKey,String> keys=new TreeMap<>();
  for (  String cf : columnFamilies) {
    Set<String> content=new HashSet<>();
    content.add("data-" + cf + "-1");
    content.add("data-" + cf + "-2");
    content.add("data-" + cf + "-3");
    SSTableUtils.Context context=SSTableUtils.prepare().ks(keyspace).cf(cf);
    ssTableReaders.add(context.write(content));
    for (    String str : content)     keys.put(Util.dk(str),cf);
  }
  Map.Entry<DecoratedKey,String> first=keys.firstEntry();
  Map.Entry<DecoratedKey,String> last=keys.lastEntry();
  Map.Entry<DecoratedKey,String> secondtolast=keys.lowerEntry(last.getKey());
  List<Range<Token>> ranges=new ArrayList<>();
  ranges.add(new Range<>(p.getMinimumToken(),first.getKey().token));
  ranges.add(new Range<>(secondtolast.getKey().token,p.getMinimumToken()));
  if (!SSTableReader.acquireReferences(ssTableReaders))   throw new AssertionError();
  new StreamPlan("StreamingTransferTest").transferFiles(LOCAL,makeStreamingDetails(ranges,ssTableReaders)).execute().get();
  for (  Map.Entry<DecoratedKey,String> entry : Arrays.asList(first,last)) {
    ColumnFamilyStore store=Keyspace.open(keyspace).getColumnFamilyStore(entry.getValue());
    List<Row> rows=Util.getRangeSlice(store);
    assertEquals(rows.toString(),1,rows.size());
    assertEquals(entry.getKey(),rows.get(0).key);
  }
}
