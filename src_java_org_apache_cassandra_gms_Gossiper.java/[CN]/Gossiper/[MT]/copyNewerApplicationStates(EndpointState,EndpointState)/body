{
  Map<ApplicationState,VersionedValue> merged=new HashMap<ApplicationState,VersionedValue>();
  for (  Entry<ApplicationState,VersionedValue> fromEntry : fromState.getApplicationStateMap().entrySet()) {
    ApplicationState key=fromEntry.getKey();
    VersionedValue value=fromEntry.getValue();
    if ((toState.applicationState.containsKey(key) && toState.applicationState.get(key).compareTo(value) < 0) || !toState.applicationState.containsKey(key)) {
      if (logger.isTraceEnabled())       logger.trace("merging {}:{} into ApplicationState",key,value);
      toState.addApplicationState(key,value);
      merged.put(key,value);
    }
  }
  return merged;
}
