{
  for (  Entry<InetAddress,EndpointState> entry : epStateMap.entrySet()) {
    InetAddress ep=entry.getKey();
    if (ep.equals(FBUtilities.getLocalAddress()))     continue;
    if (justRemovedEndpoints.containsKey(ep)) {
      if (logger.isTraceEnabled())       logger.trace("Ignoring gossip for " + ep + " because it is quarantined");
      continue;
    }
    EndpointState localEpStatePtr=endpointStateMap.get(ep);
    EndpointState remoteState=entry.getValue();
    if (localEpStatePtr != null) {
      int localGeneration=localEpStatePtr.getHeartBeatState().getGeneration();
      int remoteGeneration=remoteState.getHeartBeatState().getGeneration();
      if (logger.isTraceEnabled())       logger.trace(ep + "local generation " + localGeneration+ ", remote generation "+ remoteGeneration);
      if (remoteGeneration > localGeneration) {
        if (logger.isTraceEnabled())         logger.trace("Updating heartbeat state generation to " + remoteGeneration + " from "+ localGeneration+ " for "+ ep);
        handleMajorStateChange(ep,remoteState);
      }
 else       if (remoteGeneration == localGeneration) {
        int localMaxVersion=getMaxEndpointStateVersion(localEpStatePtr);
        int remoteMaxVersion=getMaxEndpointStateVersion(remoteState);
        if (remoteMaxVersion > localMaxVersion) {
          applyNewStates(ep,localEpStatePtr,remoteState);
        }
 else         if (logger.isTraceEnabled())         logger.trace("Ignoring remote version " + remoteMaxVersion + " <= "+ localMaxVersion+ " for "+ ep);
      }
 else {
        if (logger.isTraceEnabled())         logger.trace("Ignoring remote generation " + remoteGeneration + " < "+ localGeneration);
      }
    }
 else {
      handleMajorStateChange(ep,remoteState);
    }
  }
}
