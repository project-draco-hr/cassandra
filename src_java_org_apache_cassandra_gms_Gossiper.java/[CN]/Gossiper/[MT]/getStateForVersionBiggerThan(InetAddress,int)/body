{
  if (logger_.isTraceEnabled())   logger_.trace("Scanning for state greater than " + version + " for "+ forEndpoint);
  EndpointState epState=endpointStateMap_.get(forEndpoint);
  EndpointState reqdEndpointState=null;
  if (epState != null) {
    int localHbVersion=epState.getHeartBeatState().getHeartBeatVersion();
    if (localHbVersion > version) {
      reqdEndpointState=new EndpointState(epState.getHeartBeatState());
    }
    Map<String,ApplicationState> appStateMap=epState.getApplicationStateMap();
    for (    Entry<String,ApplicationState> entry : appStateMap.entrySet()) {
      ApplicationState appState=entry.getValue();
      if (appState.getStateVersion() > version) {
        if (reqdEndpointState == null) {
          reqdEndpointState=new EndpointState(epState.getHeartBeatState());
        }
        final String key=entry.getKey();
        if (logger_.isTraceEnabled())         logger_.trace("Adding state " + key + ": "+ appState.getValue());
        reqdEndpointState.addApplicationState(key,appState);
      }
    }
  }
  return reqdEndpointState;
}
