{
  InetAddress from=message.getFrom();
  if (logger.isTraceEnabled())   logger.trace("Received a GossipDigestSynMessage from {}",from);
  if (!Gossiper.instance.isEnabled()) {
    if (logger.isTraceEnabled())     logger.trace("Ignoring GossipDigestSynMessage because gossip is disabled");
    return;
  }
  byte[] bytes=message.getMessageBody();
  DataInputStream dis=new DataInputStream(new FastByteArrayInputStream(bytes));
  try {
    GossipDigestSynMessage gDigestMessage=GossipDigestSynMessage.serializer().deserialize(dis,message.getVersion());
    if (!gDigestMessage.clusterId.equals(DatabaseDescriptor.getClusterName())) {
      logger.warn("ClusterName mismatch from " + from + " "+ gDigestMessage.clusterId+ "!="+ DatabaseDescriptor.getClusterName());
      return;
    }
    List<GossipDigest> gDigestList=gDigestMessage.getGossipDigests();
    if (logger.isTraceEnabled()) {
      StringBuilder sb=new StringBuilder();
      for (      GossipDigest gDigest : gDigestList) {
        sb.append(gDigest);
        sb.append(" ");
      }
      logger.trace("Gossip syn digests are : " + sb.toString());
    }
    Gossiper.instance.notifyFailureDetector(gDigestList);
    doSort(gDigestList);
    List<GossipDigest> deltaGossipDigestList=new ArrayList<GossipDigest>();
    Map<InetAddress,EndpointState> deltaEpStateMap=new HashMap<InetAddress,EndpointState>();
    Gossiper.instance.examineGossiper(gDigestList,deltaGossipDigestList,deltaEpStateMap);
    MessageOut<GossipDigestAckMessage> gDigestAckMessage=new MessageOut<GossipDigestAckMessage>(StorageService.Verb.GOSSIP_DIGEST_ACK,new GossipDigestAckMessage(deltaGossipDigestList,deltaEpStateMap),GossipDigestAckMessage.serializer());
    if (logger.isTraceEnabled())     logger.trace("Sending a GossipDigestAckMessage to {}",from);
    MessagingService.instance().sendOneWay(gDigestAckMessage,from);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
