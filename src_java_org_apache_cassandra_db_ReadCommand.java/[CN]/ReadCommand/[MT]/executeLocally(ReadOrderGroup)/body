{
  long startTimeNanos=System.nanoTime();
  ColumnFamilyStore cfs=Keyspace.openAndGetStore(metadata());
  SecondaryIndexSearcher searcher=getIndexSearcher(cfs);
  UnfilteredPartitionIterator resultIterator=searcher == null ? queryStorage(cfs,orderGroup) : searcher.search(this,orderGroup);
  try {
    resultIterator=withMetricsRecording(withoutPurgeableTombstones(resultIterator,cfs),cfs.metric,startTimeNanos);
    RowFilter updatedFilter=searcher == null ? rowFilter() : rowFilter().without(searcher.primaryClause(this));
    return limits().filter(rowFilter().filter(resultIterator,nowInSec()),nowInSec());
  }
 catch (  RuntimeException|Error e) {
    resultIterator.close();
    throw e;
  }
}
