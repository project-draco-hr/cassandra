{
  long rows=0;
  DecoratedKey key;
  long rowPosition=0;
  ColumnFamily cf=ColumnFamily.create(cfs.metadata);
  while (rowPosition < dfile.length()) {
    key=SSTableReader.decodeKey(StorageService.getPartitioner(),desc,ByteBufferUtil.readWithShortLength(dfile));
    iwriter.afterAppend(key,rowPosition);
    long dataSize=SSTableReader.readRowSize(dfile,desc);
    rowPosition=dfile.getFilePointer() + dataSize;
    IndexHelper.skipBloomFilter(dfile);
    IndexHelper.skipIndex(dfile);
    ColumnFamily.serializer().deserializeFromSSTableNoColumns(cf,dfile);
    ColumnFamily.serializer().observeColumnsInSSTable(cfs.metadata,dfile,sstableMetadataCollector);
    updateCache(key,dataSize,null);
    sstableMetadataCollector.addRowSize(dataSize);
    dfile.seek(rowPosition);
    rows++;
  }
  writeMetadata(desc,sstableMetadataCollector.finalizeMetadata());
  return rows;
}
