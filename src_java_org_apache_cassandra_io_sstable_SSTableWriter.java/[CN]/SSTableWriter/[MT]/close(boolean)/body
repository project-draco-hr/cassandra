{
  iwriter.close();
  if (closeBf)   iwriter.bf.close();
  dataFile.close();
  SSTableMetadata sstableMetadata=sstableMetadataCollector.finalizeMetadata(partitioner.getClass().getCanonicalName(),metadata.getBloomFilterFpChance());
  writeMetadata(descriptor,sstableMetadata,sstableMetadataCollector.ancestors);
  SSTable.appendTOC(descriptor,components);
  return Pair.create(rename(descriptor,components),sstableMetadata);
}
