{
  iwriter.close();
  dataFile.close();
  dataFile.writeFullChecksum(descriptor);
  Map<MetadataType,MetadataComponent> metadataComponents=sstableMetadataCollector.finalizeMetadata(partitioner.getClass().getCanonicalName(),metadata.getBloomFilterFpChance(),repairedAt);
  writeMetadata(descriptor,metadataComponents);
  SSTable.appendTOC(descriptor,components);
  return Pair.create(rename(descriptor,components),(StatsMetadata)metadataComponents.get(MetadataType.STATS));
}
