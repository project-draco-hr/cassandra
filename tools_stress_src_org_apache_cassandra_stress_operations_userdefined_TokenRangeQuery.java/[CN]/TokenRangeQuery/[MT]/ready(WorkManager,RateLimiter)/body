{
  tokenRangeIterator.update();
  if (tokenRangeIterator.exhausted() && currentState.get() == null)   return false;
  int numLeft=workManager.takePermits(1);
  if (rateLimiter != null && numLeft > 0)   rateLimiter.acquire(numLeft);
  return numLeft > 0;
}
