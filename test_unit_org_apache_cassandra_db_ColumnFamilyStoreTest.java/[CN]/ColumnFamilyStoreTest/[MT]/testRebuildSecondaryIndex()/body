{
  Mutation rm;
  rm=new Mutation("PerRowSecondaryIndex",ByteBufferUtil.bytes("k1"));
  rm.add("Indexed1",cellname("indexed"),ByteBufferUtil.bytes("foo"),1);
  rm.apply();
  assertTrue(Arrays.equals("k1".getBytes(),PerRowSecondaryIndexTest.TestIndex.LAST_INDEXED_KEY.array()));
  Keyspace.open("PerRowSecondaryIndex").getColumnFamilyStore("Indexed1").forceBlockingFlush();
  PerRowSecondaryIndexTest.TestIndex.reset();
  ColumnFamilyStore.rebuildSecondaryIndex("PerRowSecondaryIndex","Indexed1",PerRowSecondaryIndexTest.TestIndex.class.getSimpleName());
  assertTrue(Arrays.equals("k1".getBytes(),PerRowSecondaryIndexTest.TestIndex.LAST_INDEXED_KEY.array()));
  PerRowSecondaryIndexTest.TestIndex.reset();
  PerRowSecondaryIndexTest.TestIndex.ACTIVE=false;
  ColumnFamilyStore.rebuildSecondaryIndex("PerRowSecondaryIndex","Indexed1",PerRowSecondaryIndexTest.TestIndex.class.getSimpleName());
  assertNull(PerRowSecondaryIndexTest.TestIndex.LAST_INDEXED_KEY);
  PerRowSecondaryIndexTest.TestIndex.reset();
}
