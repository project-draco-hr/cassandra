{
  String keySpace="Keyspace2";
  String cfName="Indexed1";
  Table table=Table.open(keySpace);
  ColumnFamilyStore cfs=table.getColumnFamilyStore(cfName);
  cfs.truncate().get();
  ByteBuffer rowKey=ByteBufferUtil.bytes("k1");
  ByteBuffer colName=ByteBufferUtil.bytes("birthdate");
  ByteBuffer val1=ByteBufferUtil.bytes(1L);
  ByteBuffer val2=ByteBufferUtil.bytes(2L);
  RowMutation rm;
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,val1,0);
  rm.apply();
  IndexExpression expr=new IndexExpression(colName,IndexOperator.EQ,val1);
  List<IndexExpression> clause=Arrays.asList(expr);
  IDiskAtomFilter filter=new IdentityQueryFilter();
  Range<RowPosition> range=Util.range("","");
  List<Row> rows=table.getColumnFamilyStore(cfName).search(clause,range,100,filter);
  assertEquals(1,rows.size());
  table.getColumnFamilyStore(cfName).forceBlockingFlush();
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,val2,1);
  table.apply(rm,true,false);
  rows=table.getColumnFamilyStore(cfName).search(clause,range,100,filter);
  assertEquals(0,rows.size());
  expr=new IndexExpression(colName,IndexOperator.EQ,val2);
  clause=Arrays.asList(expr);
  filter=new IdentityQueryFilter();
  range=Util.range("","");
  rows=table.getColumnFamilyStore(cfName).search(clause,range,100,filter);
  assertEquals(0,rows.size());
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,ByteBufferUtil.bytes(1L),3);
  table.apply(rm,true,false);
  expr=new IndexExpression(colName,IndexOperator.EQ,ByteBufferUtil.bytes(1L));
  clause=Arrays.asList(expr);
  filter=new IdentityQueryFilter();
  range=Util.range("","");
  rows=table.getColumnFamilyStore(cfName).search(clause,range,100,filter);
  assertEquals(0,rows.size());
}
