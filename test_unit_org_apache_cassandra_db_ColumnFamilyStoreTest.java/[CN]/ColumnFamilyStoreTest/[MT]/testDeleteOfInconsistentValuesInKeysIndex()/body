{
  String keySpace="Keyspace2";
  String cfName="Indexed1";
  Keyspace keyspace=Keyspace.open(keySpace);
  ColumnFamilyStore cfs=keyspace.getColumnFamilyStore(cfName);
  cfs.truncateBlocking();
  ByteBuffer rowKey=ByteBufferUtil.bytes("k1");
  ByteBuffer colName=ByteBufferUtil.bytes("birthdate");
  ByteBuffer val1=ByteBufferUtil.bytes(1L);
  ByteBuffer val2=ByteBufferUtil.bytes(2L);
  RowMutation rm;
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,val1,0);
  rm.apply();
  IndexExpression expr=new IndexExpression(colName,IndexExpression.Operator.EQ,val1);
  List<IndexExpression> clause=Arrays.asList(expr);
  IDiskAtomFilter filter=new IdentityQueryFilter();
  Range<RowPosition> range=Util.range("","");
  List<Row> rows=keyspace.getColumnFamilyStore(cfName).search(range,clause,filter,100);
  assertEquals(1,rows.size());
  keyspace.getColumnFamilyStore(cfName).forceBlockingFlush();
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,val2,1);
  keyspace.apply(rm,true,false);
  rows=keyspace.getColumnFamilyStore(cfName).search(range,clause,filter,100);
  assertEquals(0,rows.size());
  expr=new IndexExpression(colName,IndexExpression.Operator.EQ,val2);
  clause=Arrays.asList(expr);
  filter=new IdentityQueryFilter();
  range=Util.range("","");
  rows=keyspace.getColumnFamilyStore(cfName).search(range,clause,filter,100);
  assertEquals(0,rows.size());
  rm=new RowMutation(keySpace,rowKey);
  rm.add(cfName,colName,ByteBufferUtil.bytes(1L),3);
  keyspace.apply(rm,true,false);
  expr=new IndexExpression(colName,IndexExpression.Operator.EQ,ByteBufferUtil.bytes(1L));
  clause=Arrays.asList(expr);
  filter=new IdentityQueryFilter();
  range=Util.range("","");
  rows=keyspace.getColumnFamilyStore(cfName).search(range,clause,filter,100);
  assertEquals(0,rows.size());
}
