{
  if (cmp != null && !isNodeWellFormed(cmp,node,min,max))   return false;
  if (isLeaf(node)) {
    if (isRoot)     return node.length <= FAN_FACTOR + 1;
    return node.length >= FAN_FACTOR / 2 && node.length <= FAN_FACTOR + 1;
  }
  int type=0;
  for (int i=getChildStart(node); i < getChildEnd(node); i++) {
    Object[] child=(Object[])node[i];
    Object localmax=i < node.length - 2 ? node[i - getChildStart(node)] : max;
    if (!isWellFormed(cmp,child,false,min,localmax))     return false;
    type|=isLeaf(child) ? 1 : 2;
    min=localmax;
  }
  return type < 3;
}
