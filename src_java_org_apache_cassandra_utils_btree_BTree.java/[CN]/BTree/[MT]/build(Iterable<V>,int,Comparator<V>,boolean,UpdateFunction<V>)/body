{
  if (size < FAN_FACTOR) {
    V[] values=(V[])new Object[size + (size & 1)];
{
      int i=0;
      for (      V v : source)       values[i++]=v;
    }
    if (!sorted)     Arrays.sort(values,0,size,comparator);
    if (updateF != null) {
      for (int i=0; i < size; i++)       values[i]=updateF.apply(values[i]);
      updateF.allocated(ObjectSizes.sizeOfArray(values));
    }
    return values;
  }
  if (!sorted)   source=sorted(source,comparator,size);
  Queue<Builder> queue=modifier.get();
  Builder builder=queue.poll();
  if (builder == null)   builder=new Builder();
  Object[] btree=builder.build(source,updateF,size);
  queue.add(builder);
  return btree;
}
