{
  Set<SSTableReader> notCompacting;
  View currentView, newView;
  do {
    currentView=view.get();
    if (!currentView.compacting.isEmpty())     logger.error("Set of compacting sstables is non-empty when invalidating sstables {}",currentView.compacting);
    notCompacting=currentView.nonCompactingSStables();
    newView=currentView.replace(notCompacting,Collections.<SSTableReader>emptySet());
  }
 while (!view.compareAndSet(currentView,newView));
  if (notCompacting.isEmpty()) {
    return;
  }
  notifySSTablesChanged(notCompacting,Collections.<SSTableReader>emptySet(),OperationType.UNKNOWN);
  removeOldSSTablesSize(notCompacting);
  releaseReferences(notCompacting,true);
}
