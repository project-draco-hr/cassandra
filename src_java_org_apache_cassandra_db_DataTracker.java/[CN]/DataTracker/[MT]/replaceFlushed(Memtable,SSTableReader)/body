{
  if (!cfstore.isValid()) {
    View currentView, newView;
    do {
      currentView=view.get();
      newView=currentView.replaceFlushed(memtable,sstable);
      if (sstable != null)       newView=newView.replace(Arrays.asList(sstable),Collections.<SSTableReader>emptyList());
    }
 while (!view.compareAndSet(currentView,newView));
    return;
  }
  View currentView, newView;
  do {
    currentView=view.get();
    newView=currentView.replaceFlushed(memtable,sstable);
  }
 while (!view.compareAndSet(currentView,newView));
  if (sstable != null) {
    addNewSSTablesSize(Arrays.asList(sstable));
    notifyAdded(sstable);
    incrementallyBackup(sstable);
  }
}
