{
  KSMetaData ksm=Schema.instance.getTableDefinition(ksName);
  ColumnFamilyStore cfs=Table.open(ksName).getColumnFamilyStore(cfName);
  CFMetaData cfm=ksm.cfMetaData().get(cfName);
  Schema.instance.purge(cfm);
  Schema.instance.setTableDefinition(makeNewKeyspaceDefinition(ksm,cfm));
  RowMutation mutation=null;
  if (withSchemaRecord) {
    mutation=cfm.dropFromSchema(timestamp);
    mutation.apply();
  }
  if (!StorageService.instance.isClientMode()) {
    cfs.snapshot(Table.getTimestampedSnapshotName(cfs.columnFamily));
    Table.open(ksm.name).dropCf(cfm.cfId);
  }
  return toCollection(mutation);
}
