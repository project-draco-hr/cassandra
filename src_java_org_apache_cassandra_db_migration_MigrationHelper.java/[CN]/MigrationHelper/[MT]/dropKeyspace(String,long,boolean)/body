{
  KSMetaData ksm=Schema.instance.getTableDefinition(ksName);
  String snapshotName=Table.getTimestampedSnapshotName(ksName);
  for (  CFMetaData cfm : ksm.cfMetaData().values()) {
    ColumnFamilyStore cfs=Table.open(ksm.name).getColumnFamilyStore(cfm.cfName);
    Schema.instance.purge(cfm);
    if (!StorageService.instance.isClientMode()) {
      cfs.snapshot(snapshotName);
      Table.open(ksm.name).dropCf(cfm.cfId);
    }
  }
  Collection<RowMutation> mutations=Collections.emptyList();
  if (withSchemaRecord) {
    mutations=ksm.dropFromSchema(timestamp);
    for (    RowMutation m : mutations)     m.apply();
  }
  Table.clear(ksm.name);
  Schema.instance.clearTableDefinition(ksm);
  return mutations;
}
