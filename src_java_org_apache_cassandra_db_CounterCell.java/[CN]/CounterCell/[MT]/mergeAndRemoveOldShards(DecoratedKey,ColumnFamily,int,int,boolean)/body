{
  ColumnFamily remoteMerger=null;
  for (  Cell c : cf) {
    if (!(c instanceof CounterCell))     continue;
    CounterCell cc=(CounterCell)c;
    CounterCell shardMerger=cc.computeOldShardMerger(mergeBefore);
    CounterCell merged=cc;
    if (shardMerger != null) {
      merged=(CounterCell)cc.reconcile(shardMerger);
      if (remoteMerger == null)       remoteMerger=cf.cloneMeShallow();
      remoteMerger.addColumn(merged);
    }
    CounterCell cleaned=merged.removeOldShards(gcBefore);
    if (cleaned != cc) {
      cf.replace(cc,cleaned);
    }
  }
  if (remoteMerger != null && sendToOtherReplica) {
    try {
      sendToOtherReplica(key,remoteMerger);
    }
 catch (    Exception e) {
      logger.error("Error while sending shard merger mutation to remote endpoints",e);
    }
  }
}
