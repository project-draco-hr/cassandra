{
  Collections.sort(files,new FileNameComparator(FileNameComparator.Ascending));
  Map<Integer,List<String>> buckets=new HashMap<Integer,List<String>>();
  int maxBuckets=1000;
  long averages[]=new long[maxBuckets];
  long min=50L * 1024L * 1024L;
  Integer i=0;
  for (  String file : files) {
    File f=new File(file);
    long size=f.length();
    if ((size > averages[i] / 2 && size < 3 * averages[i] / 2) || (size < min && averages[i] < min)) {
      averages[i]=(averages[i] + size) / 2;
      List<String> fileList=buckets.get(i);
      if (fileList == null) {
        fileList=new ArrayList<String>();
        buckets.put(i,fileList);
      }
      fileList.add(file);
    }
 else {
      if (i >= maxBuckets)       break;
      i++;
      List<String> fileList=new ArrayList<String>();
      buckets.put(i,fileList);
      fileList.add(file);
      averages[i]=size;
    }
  }
  return buckets;
}
