{
  Allocator allocator=HeapAllocator.instance;
  ContextState left;
  ContextState right;
  CounterColumn leftCol;
  CounterColumn rightCol;
  leftCol=new CounterColumn(ByteBufferUtil.bytes("x"),0,1L);
  rightCol=new CounterColumn(ByteBufferUtil.bytes("x"),0,2L);
  Assert.assertEquals(rightCol,leftCol.diff(rightCol));
  Assert.assertNull(rightCol.diff(leftCol));
  leftCol=new CounterColumn(ByteBufferUtil.bytes("x"),0,1L,1L);
  rightCol=new CounterColumn(ByteBufferUtil.bytes("x"),0,1L,2L);
  Assert.assertEquals(rightCol,leftCol.diff(rightCol));
  Assert.assertNull(rightCol.diff(leftCol));
  left=ContextState.allocate(3,0,allocator);
  left.writeElement(CounterId.fromInt(3),3L,0L);
  left.writeElement(CounterId.fromInt(6),2L,0L);
  left.writeElement(CounterId.fromInt(9),1L,0L);
  right=new ContextState(ByteBufferUtil.clone(left.context),2);
  leftCol=new CounterColumn(ByteBufferUtil.bytes("x"),left.context,1L);
  rightCol=new CounterColumn(ByteBufferUtil.bytes("x"),right.context,1L);
  Assert.assertNull(leftCol.diff(rightCol));
  left=ContextState.allocate(4,0,allocator);
  left.writeElement(CounterId.fromInt(3),3L,0L);
  left.writeElement(CounterId.fromInt(6),2L,0L);
  left.writeElement(CounterId.fromInt(9),1L,0L);
  left.writeElement(CounterId.fromInt(12),0L,0L);
  right=ContextState.allocate(3,0,allocator);
  right.writeElement(CounterId.fromInt(3),3L,0L);
  right.writeElement(CounterId.fromInt(6),2L,0L);
  right.writeElement(CounterId.fromInt(9),1L,0L);
  leftCol=new CounterColumn(ByteBufferUtil.bytes("x"),left.context,1L);
  rightCol=new CounterColumn(ByteBufferUtil.bytes("x"),right.context,1L);
  Assert.assertNull(leftCol.diff(rightCol));
  Assert.assertEquals(leftCol,rightCol.diff(leftCol));
  left=ContextState.allocate(3,0,allocator);
  left.writeElement(CounterId.fromInt(3),1L,0L);
  left.writeElement(CounterId.fromInt(4),1L,0L);
  left.writeElement(CounterId.fromInt(9),1L,0L);
  right=ContextState.allocate(3,0,allocator);
  right.writeElement(CounterId.fromInt(3),1L,0L);
  right.writeElement(CounterId.fromInt(6),1L,0L);
  right.writeElement(CounterId.fromInt(9),1L,0L);
  leftCol=new CounterColumn(ByteBufferUtil.bytes("x"),left.context,1L);
  rightCol=new CounterColumn(ByteBufferUtil.bytes("x"),right.context,1L);
  Assert.assertEquals(rightCol,leftCol.diff(rightCol));
  Assert.assertEquals(leftCol,rightCol.diff(leftCol));
}
