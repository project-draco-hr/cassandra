{
  if (StorageService.instance().isBootstrapMode())   throw new UnsupportedOperationException("Cannot set token during bootstrap");
  byte[] body=message.getMessageBody();
  DataInputBuffer bufIn=new DataInputBuffer();
  bufIn.reset(body,body.length);
  try {
    Token token=Token.serializer().deserialize(bufIn);
    StorageService.instance().setToken(token);
    Gossiper.instance().addApplicationState(StorageService.STATE_NORMAL,new ApplicationState(StorageService.getPartitioner().getTokenFactory().toString(token)));
  }
 catch (  IOException ex) {
    throw new RuntimeException(ex);
  }
}
