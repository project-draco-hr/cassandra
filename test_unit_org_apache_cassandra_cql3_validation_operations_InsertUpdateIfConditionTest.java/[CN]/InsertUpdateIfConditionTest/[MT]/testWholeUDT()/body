{
  String typename=createType("CREATE TYPE %s (a int, b text)");
  String myType=KEYSPACE + '.' + typename;
  for (  boolean frozen : new boolean[]{false,true}) {
    createTable(String.format("CREATE TABLE %%s (k int PRIMARY KEY, v %s)",frozen ? "frozen<" + myType + ">" : myType));
    Object v=userType("a",0,"b","abc");
    execute("INSERT INTO %s (k, v) VALUES (0, ?)",v);
    checkAppliesUDT("v = {a: 0, b: 'abc'}",v);
    checkAppliesUDT("v != null",v);
    checkAppliesUDT("v != {a: 1, b: 'abc'}",v);
    checkAppliesUDT("v != {a: 0, b: 'def'}",v);
    checkAppliesUDT("v > {a: -1, b: 'abc'}",v);
    checkAppliesUDT("v > {a: 0, b: 'aaa'}",v);
    checkAppliesUDT("v > {a: 0}",v);
    checkAppliesUDT("v >= {a: 0, b: 'aaa'}",v);
    checkAppliesUDT("v >= {a: 0, b: 'abc'}",v);
    checkAppliesUDT("v < {a: 0, b: 'zzz'}",v);
    checkAppliesUDT("v < {a: 1, b: 'abc'}",v);
    checkAppliesUDT("v < {a: 1}",v);
    checkAppliesUDT("v <= {a: 0, b: 'zzz'}",v);
    checkAppliesUDT("v <= {a: 0, b: 'abc'}",v);
    checkAppliesUDT("v IN (null, {a: 0, b: 'abc'}, {a: 1})",v);
    checkAppliesUDT("v > {a: -1, b: 'abc'} AND v > {a: 0}",v);
    checkAppliesUDT("v != null AND v IN ({a: 0, b: 'abc'})",v);
    checkDoesNotApplyUDT("v = {a: 0, b: 'def'}",v);
    checkDoesNotApplyUDT("v = {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v = null",v);
    checkDoesNotApplyUDT("v != {a: 0, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: 0, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v >= {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v >= {a: 0, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v < {a: -1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v < {a: 0, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v <= {a: -1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v <= {a: 0, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v IN ({a: 0}, {b: 'abc'}, {a: 0, b: 'def'}, null)",v);
    checkDoesNotApplyUDT("v IN ()",v);
    checkDoesNotApplyUDT("v IN () AND v IN ({a: 0, b: 'abc'})",v);
    checkDoesNotApplyUDT("v > {a: 0, b: 'aaa'} AND v < {a: 0, b: 'aaa'}",v);
    checkInvalidUDT("v = {a: 1, b: 'abc', c: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v = {foo: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v < {a: 1, b: 'abc', c: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v < null",v,InvalidRequestException.class);
    checkInvalidUDT("v <= {a: 1, b: 'abc', c: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v <= null",v,InvalidRequestException.class);
    checkInvalidUDT("v > {a: 1, b: 'abc', c: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v > null",v,InvalidRequestException.class);
    checkInvalidUDT("v >= {a: 1, b: 'abc', c: 'foo'}",v,InvalidRequestException.class);
    checkInvalidUDT("v >= null",v,InvalidRequestException.class);
    checkInvalidUDT("v IN null",v,SyntaxException.class);
    checkInvalidUDT("v IN 367",v,SyntaxException.class);
    checkInvalidUDT("v CONTAINS KEY 123",v,SyntaxException.class);
    checkInvalidUDT("v CONTAINS 'bar'",v,SyntaxException.class);
    v=userType("a",0,"b",null);
    execute("INSERT INTO %s (k, v) VALUES (0, ?)",v);
    checkAppliesUDT("v = {a: 0}",v);
    checkAppliesUDT("v = {a: 0, b: null}",v);
    checkAppliesUDT("v != null",v);
    checkAppliesUDT("v != {a: 1, b: null}",v);
    checkAppliesUDT("v != {a: 1}",v);
    checkAppliesUDT("v != {a: 0, b: 'def'}",v);
    checkAppliesUDT("v > {a: -1, b: 'abc'}",v);
    checkAppliesUDT("v > {a: -1}",v);
    checkAppliesUDT("v >= {a: 0}",v);
    checkAppliesUDT("v >= {a: -1, b: 'abc'}",v);
    checkAppliesUDT("v < {a: 0, b: 'zzz'}",v);
    checkAppliesUDT("v < {a: 1, b: 'abc'}",v);
    checkAppliesUDT("v < {a: 1}",v);
    checkAppliesUDT("v <= {a: 0, b: 'zzz'}",v);
    checkAppliesUDT("v <= {a: 0}",v);
    checkAppliesUDT("v IN (null, {a: 0, b: 'abc'}, {a: 0})",v);
    checkAppliesUDT("v > {a: -1, b: 'abc'} AND v >= {a: 0}",v);
    checkAppliesUDT("v != null AND v IN ({a: 0}, {a: 0, b: null})",v);
    checkDoesNotApplyUDT("v = {a: 0, b: 'def'}",v);
    checkDoesNotApplyUDT("v = {a: 1}",v);
    checkDoesNotApplyUDT("v = {b: 'abc'}",v);
    checkDoesNotApplyUDT("v = null",v);
    checkDoesNotApplyUDT("v != {a: 0}",v);
    checkDoesNotApplyUDT("v != {a: 0, b: null}",v);
    checkDoesNotApplyUDT("v > {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: 0}",v);
    checkDoesNotApplyUDT("v >= {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v >= {a: 1}",v);
    checkDoesNotApplyUDT("v < {a: -1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v < {a: -1}",v);
    checkDoesNotApplyUDT("v < {a: 0}",v);
    checkDoesNotApplyUDT("v <= {a: -1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v <= {a: -1}",v);
    checkDoesNotApplyUDT("v IN ({a: 1}, {b: 'abc'}, {a: 0, b: 'def'}, null)",v);
    checkDoesNotApplyUDT("v IN ()",v);
    checkDoesNotApplyUDT("v IN () AND v IN ({a: 0})",v);
    checkDoesNotApplyUDT("v > {a: -1} AND v < {a: 0}",v);
    v=userType("a",null,"b","abc");
    execute("INSERT INTO %s (k, v) VALUES (0, ?)",v);
    checkAppliesUDT("v = {a: null, b: 'abc'}",v);
    checkAppliesUDT("v = {b: 'abc'}",v);
    checkAppliesUDT("v != null",v);
    checkAppliesUDT("v != {a: 0, b: 'abc'}",v);
    checkAppliesUDT("v != {a: 0}",v);
    checkAppliesUDT("v != {b: 'def'}",v);
    checkAppliesUDT("v > {a: null, b: 'aaa'}",v);
    checkAppliesUDT("v > {b: 'aaa'}",v);
    checkAppliesUDT("v >= {a: null, b: 'aaa'}",v);
    checkAppliesUDT("v >= {b: 'abc'}",v);
    checkAppliesUDT("v < {a: null, b: 'zzz'}",v);
    checkAppliesUDT("v < {a: 0, b: 'abc'}",v);
    checkAppliesUDT("v < {a: 0}",v);
    checkAppliesUDT("v < {b: 'zzz'}",v);
    checkAppliesUDT("v <= {a: null, b: 'zzz'}",v);
    checkAppliesUDT("v <= {a: 0}",v);
    checkAppliesUDT("v <= {b: 'abc'}",v);
    checkAppliesUDT("v IN (null, {a: null, b: 'abc'}, {a: 0})",v);
    checkAppliesUDT("v IN (null, {a: 0, b: 'abc'}, {b: 'abc'})",v);
    checkAppliesUDT("v > {b: 'aaa'} AND v >= {b: 'abc'}",v);
    checkAppliesUDT("v != null AND v IN ({a: 0}, {a: null, b: 'abc'})",v);
    checkDoesNotApplyUDT("v = {a: 0, b: 'def'}",v);
    checkDoesNotApplyUDT("v = {a: 1}",v);
    checkDoesNotApplyUDT("v = {b: 'def'}",v);
    checkDoesNotApplyUDT("v = null",v);
    checkDoesNotApplyUDT("v != {b: 'abc'}",v);
    checkDoesNotApplyUDT("v != {a: null, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: null, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v > {b: 'zzz'}",v);
    checkDoesNotApplyUDT("v >= {a: null, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v >= {a: 1}",v);
    checkDoesNotApplyUDT("v >= {b: 'zzz'}",v);
    checkDoesNotApplyUDT("v < {a: null, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v < {b: 'aaa'}",v);
    checkDoesNotApplyUDT("v <= {a: null, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v <= {b: 'aaa'}",v);
    checkDoesNotApplyUDT("v IN ({a: 1}, {a: 1, b: 'abc'}, {a: null, b: 'def'}, null)",v);
    checkDoesNotApplyUDT("v IN ()",v);
    checkDoesNotApplyUDT("v IN () AND v IN ({b: 'abc'})",v);
    checkDoesNotApplyUDT("v IN () AND v IN ({a: null, b: 'abc'})",v);
    checkDoesNotApplyUDT("v > {a: -1} AND v < {a: 0}",v);
    v=null;
    execute("INSERT INTO %s (k, v) VALUES (0, ?)",v);
    checkAppliesUDT("v = null",v);
    checkAppliesUDT("v IN (null, {a: null, b: 'abc'}, {a: 0})",v);
    checkAppliesUDT("v IN (null, {a: 0, b: 'abc'}, {b: 'abc'})",v);
    checkAppliesUDT("v = null AND v IN (null, {a: 0}, {a: null, b: 'abc'})",v);
    checkDoesNotApplyUDT("v = {a: 0, b: 'def'}",v);
    checkDoesNotApplyUDT("v = {a: 1}",v);
    checkDoesNotApplyUDT("v = {b: 'def'}",v);
    checkDoesNotApplyUDT("v != null",v);
    checkDoesNotApplyUDT("v > {a: 1, b: 'abc'}",v);
    checkDoesNotApplyUDT("v > {a: null, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v > {b: 'zzz'}",v);
    checkDoesNotApplyUDT("v >= {a: null, b: 'zzz'}",v);
    checkDoesNotApplyUDT("v >= {a: 1}",v);
    checkDoesNotApplyUDT("v >= {b: 'zzz'}",v);
    checkDoesNotApplyUDT("v < {a: null, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v < {b: 'aaa'}",v);
    checkDoesNotApplyUDT("v <= {a: null, b: 'aaa'}",v);
    checkDoesNotApplyUDT("v <= {b: 'aaa'}",v);
    checkDoesNotApplyUDT("v IN ({a: 1}, {a: 1, b: 'abc'}, {a: null, b: 'def'})",v);
    checkDoesNotApplyUDT("v IN ()",v);
    checkDoesNotApplyUDT("v IN () AND v IN ({b: 'abc'})",v);
    checkDoesNotApplyUDT("v > {a: -1} AND v < {a: 0}",v);
  }
}
