def run_test(self, filename, threads):
    start_t = time.time()
    if filename:
        outf = open(filename, 'w')
    else:
        outf = sys.stdout
    outf.write('total,interval_op_rate,elapsed_time\n')
    total = old_total = 0
    while True:
        interval = 10
        time.sleep(interval)
        old_total = total
        total = sum((self.counts[th.idx] for th in threads))
        delta = (total - old_total)
        elapsed_t = int((time.time() - start_t))
        outf.write(('%d,%d,%d\n' % (total, (delta / interval), elapsed_t)))
        if (not [th for th in threads if th.isAlive()]):
            break
