{
  FileUtils.closeQuietly(writer);
  byte[] bytes=digest.digest();
  if (bytes == null)   return;
  SequentialWriter out=SequentialWriter.open(new File(descriptor.filenameFor(Component.DIGEST)),true);
  Descriptor newdesc=descriptor.asTemporary(false);
  String[] tmp=newdesc.filenameFor(Component.DATA).split(Pattern.quote(File.separator));
  String dataFileName=tmp[tmp.length - 1];
  try {
    out.write(String.format("%s  %s",Hex.bytesToHex(bytes),dataFileName).getBytes());
  }
 catch (  ClosedChannelException e) {
    throw new AssertionError();
  }
 finally {
    FileUtils.closeQuietly(out);
  }
}
