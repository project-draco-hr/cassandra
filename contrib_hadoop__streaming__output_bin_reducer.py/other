from avro.io import BinaryEncoder, DatumWriter
import avro.protocol
import sys, time
word2count = {}
for line in sys.stdin:
    line = line.strip()
    (word, count) = line.split('\t', 1)
    try:
        count = int(count)
        word2count[word] = (word2count.get(word, 0) + count)
    except ValueError:
        pass
proto = avro.protocol.parse(open('cassandra.avpr').read())
schema = proto.types_dict['StreamingMutation']
enc = BinaryEncoder(sys.stdout)
writer = DatumWriter(schema)
smutation = dict()
try:
    for (word, count) in word2count.iteritems():
        smutation['key'] = word
        smutation['mutation'] = {'column_or_supercolumn': {'column': new_column('count', count), }, }
        writer.write(smutation, enc)
finally:
    sys.stdout.flush()
