{
  TransactionLog.waitForDeletions();
  File dir=new File(dirPath);
  for (  File file : dir.listFiles()) {
    if (file.isDirectory())     continue;
    String filePath=file.getPath();
    assertTrue(filePath,expectedFiles.contains(filePath));
    expectedFiles.remove(filePath);
  }
  if (excludeNonExistingFiles) {
    for (    String filePath : expectedFiles) {
      File file=new File(filePath);
      if (!file.exists())       expectedFiles.remove(filePath);
    }
  }
  assertTrue(expectedFiles.toString(),expectedFiles.isEmpty());
}
