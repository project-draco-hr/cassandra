{
  ColumnFamilyStore cfs=MockSchema.newCFS(KEYSPACE);
  SSTableReader sstableOld=sstable(cfs,0,128);
  SSTableReader sstableNew=sstable(cfs,1,128);
  TransactionLog transactionLog=new TransactionLog(OperationType.COMPACTION,cfs.metadata);
  assertNotNull(transactionLog);
  transactionLog.trackNew(sstableNew);
  transactionLog.obsoleted(sstableOld);
  modifier.accept(sstableOld);
  transactionLog.getData().getLogFile().commit();
  TransactionLog.removeUnfinishedLeftovers(cfs.metadata);
  assertFiles(transactionLog.getDataFolder(),Sets.newHashSet(Iterables.concat(sstableNew.getAllFilePaths(),sstableOld.getAllFilePaths(),Collections.singleton(transactionLog.getData().getLogFile().file.getPath()))));
  sstableOld.selfRef().release();
  sstableNew.selfRef().release();
  assertNull(transactionLog.complete(null));
  assertFiles(transactionLog.getDataFolder(),Sets.newHashSet(Iterables.concat(sstableNew.getAllFilePaths(),sstableOld.getAllFilePaths(),Collections.singleton(transactionLog.getData().getLogFile().file.getPath()))));
}
