{
  SSTableWriter writer=null;
  while (true) {
    try {
      Buffer b=writeQueue.take();
      if (b == SENTINEL)       return;
      writer=getWriter();
      boolean first=true;
      for (      Map.Entry<DecoratedKey,ColumnFamily> entry : b.entrySet()) {
        if (entry.getValue().getColumnCount() > 0)         writer.append(entry.getKey(),entry.getValue());
 else         if (!first)         throw new AssertionError("Empty partition");
        first=false;
      }
      writer.close(true);
    }
 catch (    Throwable e) {
      JVMStabilityInspector.inspectThrowable(e);
      if (writer != null)       writer.abort();
      if (exception == null)       exception=e;
    }
  }
}
