{
  try {
    long timeout=DatabaseDescriptor.getRpcTimeout() - (System.currentTimeMillis() - startTime);
    boolean success;
    try {
      success=condition.await(timeout,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException ex) {
      throw new AssertionError(ex);
    }
    if (!success) {
      StringBuilder sb=new StringBuilder("");
      for (      Message message : resolver.getMessages()) {
        sb.append(message.getFrom());
      }
      throw new TimeoutException("Operation timed out - received only " + resolver.getMessageCount() + " responses from "+ sb.toString()+ " .");
    }
  }
  finally {
    for (    Message response : resolver.getMessages()) {
      MessagingService.removeRegisteredCallback(response.getMessageId());
    }
  }
  return resolver.resolve();
}
