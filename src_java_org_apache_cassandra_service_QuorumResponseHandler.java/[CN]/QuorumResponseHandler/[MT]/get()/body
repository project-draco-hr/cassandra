{
  lock_.lock();
  try {
    boolean bVal=true;
    try {
      if (!done_.get()) {
        long timeout=System.currentTimeMillis() - startTime_ + DatabaseDescriptor.getRpcTimeout();
        if (timeout > 0) {
          bVal=condition_.await(timeout,TimeUnit.MILLISECONDS);
        }
 else {
          bVal=false;
        }
      }
    }
 catch (    InterruptedException ex) {
      throw new AssertionError(ex);
    }
    if (!bVal && !done_.get()) {
      StringBuilder sb=new StringBuilder("");
      for (      Message message : responses_) {
        sb.append(message.getFrom());
      }
      throw new TimeoutException("Operation timed out - received only " + responses_.size() + " responses from "+ sb.toString()+ " .");
    }
  }
  finally {
    lock_.unlock();
    for (    Message response : responses_) {
      MessagingService.removeRegisteredCallback(response.getMessageId());
    }
  }
  return responseResolver_.resolve(responses_);
}
