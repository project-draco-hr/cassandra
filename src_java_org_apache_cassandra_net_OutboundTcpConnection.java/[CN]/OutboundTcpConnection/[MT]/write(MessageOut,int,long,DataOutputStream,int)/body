{
  out.writeInt(MessagingService.PROTOCOL_MAGIC);
  if (version < MessagingService.VERSION_12) {
    writeHeader(out,version,false);
    out.writeInt(-1);
  }
  if (version < MessagingService.VERSION_20)   out.writeUTF(String.valueOf(id));
 else   out.writeInt(id);
  if (version >= MessagingService.VERSION_12) {
    out.writeInt((int)timestamp);
  }
  message.serialize(out,version);
}
