{
  while (true) {
    Entry entry=active.poll();
    if (entry == null) {
      try {
        entry=backlog.take();
      }
 catch (      InterruptedException e) {
        throw new AssertionError(e);
      }
      BlockingQueue<Entry> tmp=backlog;
      backlog=active;
      active=tmp;
    }
    Message m=entry.message;
    String id=entry.id;
    if (m == CLOSE_SENTINEL) {
      disconnect();
      if (isStopped)       break;
      continue;
    }
    if (entry.timestamp < System.currentTimeMillis() - DatabaseDescriptor.getRpcTimeout())     dropped.incrementAndGet();
 else     if (socket != null || connect())     writeConnected(entry,id);
 else     active.clear();
  }
}
