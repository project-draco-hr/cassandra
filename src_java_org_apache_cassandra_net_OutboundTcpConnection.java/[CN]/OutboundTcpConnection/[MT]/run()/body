{
  while (true) {
    Pair<Message,String> pair=take();
    Message m=pair.left;
    String id=pair.right;
    if (m == CLOSE_SENTINEL) {
      disconnect();
      continue;
    }
    if (socket != null || connect())     writeConnected(m,id);
 else     queue.clear();
  }
}
