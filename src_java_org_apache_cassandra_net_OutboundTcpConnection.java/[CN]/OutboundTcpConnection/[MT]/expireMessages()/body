{
  while (true) {
    QueuedMessage message=backlog.peek();
    if (message == null || message.timestamp >= System.currentTimeMillis() - message.message.getTimeout())     break;
    QueuedMessage message2=backlog.poll();
    if (message2 != message) {
      if (message2 != null)       active.add(message2);
      break;
    }
    dropped.incrementAndGet();
  }
}
