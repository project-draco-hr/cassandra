{
  try {
    ByteBufferUtil.write(bb,output);
    if (queue.peek() == null) {
      output.flush();
    }
  }
 catch (  IOException e) {
    logger.info("error writing to " + endpoint);
    logger.debug("error was ",e);
    disconnect();
  }
}
