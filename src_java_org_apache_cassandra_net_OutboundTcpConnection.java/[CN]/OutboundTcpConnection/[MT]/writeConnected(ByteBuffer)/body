{
  try {
    output.write(bb.array(),0,bb.limit());
    if (queue.peek() == null) {
      output.flush();
    }
  }
 catch (  IOException e) {
    logger.info("error writing to " + endpoint);
    disconnect();
  }
}
