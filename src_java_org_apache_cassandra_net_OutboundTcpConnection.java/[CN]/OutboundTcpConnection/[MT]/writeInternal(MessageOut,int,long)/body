{
  out.writeInt(MessagingService.PROTOCOL_MAGIC);
  if (targetVersion < MessagingService.VERSION_12) {
    writeHeader(out,targetVersion,false);
    out.writeInt(-1);
  }
  if (targetVersion < MessagingService.VERSION_20)   out.writeUTF(String.valueOf(id));
 else   out.writeInt(id);
  if (targetVersion >= MessagingService.VERSION_12) {
    out.writeInt((int)timestamp);
  }
  message.serialize(out,targetVersion);
}
