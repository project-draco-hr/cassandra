{
  byte[] bytes=message.getMessageBody();
  ByteArrayInputStream buffer=new ByteArrayInputStream(bytes);
  try {
    RowMutation rm=RowMutation.serializer().deserialize(new DataInputStream(buffer));
    if (logger_.isDebugEnabled())     logger_.debug("Applying " + rm);
    byte[] hintedBytes=message.getHeader(RowMutation.HINT);
    if (hintedBytes != null && hintedBytes.length > 0) {
      InetAddress hint=InetAddress.getByAddress(hintedBytes);
      if (logger_.isDebugEnabled())       logger_.debug("Adding hint for " + hint);
      RowMutation hintedMutation=new RowMutation(Table.SYSTEM_TABLE,rm.getTable());
      hintedMutation.addHints(rm.key(),hintedBytes);
      hintedMutation.apply();
    }
    Table.open(rm.getTable()).apply(rm,bytes,true);
    WriteResponse response=new WriteResponse(rm.getTable(),rm.key(),true);
    Message responseMessage=WriteResponse.makeWriteResponseMessage(message,response);
    if (logger_.isDebugEnabled())     logger_.debug(rm + " applied.  Sending response to " + message.getMessageId()+ "@"+ message.getFrom());
    MessagingService.instance().sendOneWay(responseMessage,message.getFrom());
  }
 catch (  IOException e) {
    logger_.error("Error in row mutation",e);
  }
}
