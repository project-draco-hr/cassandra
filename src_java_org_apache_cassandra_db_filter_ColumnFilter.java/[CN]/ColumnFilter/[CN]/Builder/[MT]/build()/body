{
  boolean isFetchAll=metadata != null;
  PartitionColumns selectedColumns=selection == null ? null : selection.build();
  if (!isFetchAll && selectedColumns == null)   selectedColumns=PartitionColumns.NONE;
  SortedSetMultimap<ColumnIdentifier,ColumnSubselection> s=null;
  if (subSelections != null) {
    s=TreeMultimap.create(Comparator.<ColumnIdentifier>naturalOrder(),Comparator.<ColumnSubselection>naturalOrder());
    for (    ColumnSubselection subSelection : subSelections)     s.put(subSelection.column().name,subSelection);
  }
  return new ColumnFilter(isFetchAll,metadata,selectedColumns,s);
}
