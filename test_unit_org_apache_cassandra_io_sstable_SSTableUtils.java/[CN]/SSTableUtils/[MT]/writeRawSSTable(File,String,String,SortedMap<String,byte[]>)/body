{
  boolean temporary=false;
  if (datafile == null) {
    datafile=tempSSTableFile(tablename,cfname);
    temporary=true;
  }
  SSTableWriter writer=new SSTableWriter(datafile.getAbsolutePath(),entries.size(),StorageService.getPartitioner());
  for (  Map.Entry<String,byte[]> entry : entries.entrySet())   writer.append(writer.partitioner.decorateKey(entry.getKey()),entry.getValue());
  if (temporary) {
    new File(writer.indexFilename()).deleteOnExit();
    new File(writer.filterFilename()).deleteOnExit();
  }
  return writer.closeAndOpenReader();
}
