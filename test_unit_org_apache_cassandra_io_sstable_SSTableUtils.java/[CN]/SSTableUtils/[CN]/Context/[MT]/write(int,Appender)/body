{
  File datafile=(dest == null) ? tempSSTableFile(ksname,cfname,generation) : new File(dest.filenameFor(Component.DATA));
  SerializationHeader header=SerializationHeader.make(Schema.instance.getCFMetaData(ksname,cfname),Collections.EMPTY_LIST);
  SSTableTxnWriter writer=SSTableTxnWriter.create(datafile.getAbsolutePath(),expectedSize,ActiveRepairService.UNREPAIRED_SSTABLE,0,header);
  while (appender.append(writer)) {
  }
  SSTableReader reader=writer.finish(true);
  if (cleanup)   for (  Component component : reader.components)   new File(reader.descriptor.filenameFor(component)).deleteOnExit();
  return reader;
}
