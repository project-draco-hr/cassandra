{
  if (getIdxOfField(toUpdate,fieldName) >= 0)   throw new InvalidRequestException(String.format("Cannot add new field %s to type %s: a field of the same name already exists",fieldName,name));
  List<ByteBuffer> newNames=new ArrayList<>(toUpdate.size() + 1);
  newNames.addAll(toUpdate.fieldNames());
  newNames.add(fieldName.bytes);
  List<AbstractType<?>> newTypes=new ArrayList<>(toUpdate.size() + 1);
  newTypes.addAll(toUpdate.fieldTypes());
  newTypes.add(type.prepare(keyspace()).getType());
  return new UserType(toUpdate.keyspace,toUpdate.name,newNames,newTypes);
}
