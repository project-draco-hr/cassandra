{
  KSMetaData ksm=Schema.instance.getKSMetaData(name.getKeyspace());
  if (ksm == null)   throw new InvalidRequestException(String.format("Cannot alter type in unknown keyspace %s",name.getKeyspace()));
  UserType toUpdate=ksm.userTypes.getType(name.getUserTypeName());
  if (toUpdate == null)   throw new InvalidRequestException(String.format("No user type named %s exists.",name));
  UserType updated=makeUpdatedType(toUpdate);
  MigrationManager.announceTypeUpdate(updated,isLocalOnly);
  for (  KSMetaData ksm2 : Schema.instance.getKeyspaceDefinitions()) {
    for (    CFMetaData cfm : ksm2.cfMetaData().values()) {
      CFMetaData copy=cfm.copy();
      boolean modified=false;
      for (      ColumnDefinition def : copy.allColumns())       modified|=updateDefinition(copy,def,toUpdate.keyspace,toUpdate.name,updated);
      if (modified)       MigrationManager.announceColumnFamilyUpdate(copy,false,isLocalOnly);
    }
    for (    UserType ut : ksm2.userTypes.getAllTypes().values()) {
      if (ut.keyspace.equals(toUpdate.keyspace) && ut.name.equals(toUpdate.name)) {
        if (!ut.keyspace.equals(updated.keyspace) || !ut.name.equals(updated.name))         MigrationManager.announceTypeDrop(ut);
        continue;
      }
      AbstractType<?> upd=updateWith(ut,toUpdate.keyspace,toUpdate.name,updated);
      if (upd != null)       MigrationManager.announceTypeUpdate((UserType)upd,isLocalOnly);
    }
  }
}
