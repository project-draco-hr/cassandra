{
  Holder current, modified;
  long sizeDelta;
  main_loop:   do {
    sizeDelta=0;
    current=ref.get();
    DeletionInfo newDelInfo=current.deletionInfo;
    if (cm.deletionInfo().mayModify(newDelInfo)) {
      newDelInfo=current.deletionInfo.copy().add(cm.deletionInfo());
      sizeDelta+=newDelInfo.dataSize() - current.deletionInfo.dataSize();
    }
    modified=new Holder(current.map.clone(),newDelInfo);
    for (    Column column : cm) {
      sizeDelta+=modified.addColumn(transformation.apply(column),allocator,indexer);
      if (ref.get() != current)       continue main_loop;
    }
  }
 while (!ref.compareAndSet(current,modified));
  indexer.updateRowLevelIndexes();
  return sizeDelta;
}
