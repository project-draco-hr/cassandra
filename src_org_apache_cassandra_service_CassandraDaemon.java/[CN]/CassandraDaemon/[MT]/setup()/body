{
  int listenPort=DatabaseDescriptor.getThriftPort();
  Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler(){
    public void uncaughtException(    Thread t,    Throwable e){
      logger.error("Fatal exception in thread " + t,e);
    }
  }
);
  CassandraServer peerStorageServer=new CassandraServer();
  peerStorageServer.start();
  Cassandra.Processor processor=new Cassandra.Processor(peerStorageServer);
  TServerSocket tServerSocket=new TServerSocket(new InetSocketAddress(FBUtilities.getHostName(),listenPort));
  TProtocolFactory tProtocolFactory=new TBinaryProtocol.Factory();
  TThreadPoolServer.Options options=new TThreadPoolServer.Options();
  options.minWorkerThreads=64;
  serverEngine=new TThreadPoolServer(new TProcessorFactory(processor),tServerSocket,new TTransportFactory(),new TTransportFactory(),tProtocolFactory,tProtocolFactory,options);
}
