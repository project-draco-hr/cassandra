{
  Directories.DataDirectory localDir=cfs.getDirectories().getWriteableLocation(totalSize);
  if (localDir == null)   throw new IOException("Insufficient disk space to store " + totalSize + " bytes");
  RangeAwareSSTableWriter writer=new RangeAwareSSTableWriter(cfs,estimatedKeys,repairedAt,format,sstableLevel,totalSize,session.getTransaction(cfId),getHeader(cfs.metadata));
  StreamHook.instance.reportIncomingFile(cfs,writer,session,fileSeqNum);
  return writer;
}
