{
  try {
    logger.info("Hostname: {}",InetAddress.getLocalHost().getHostName());
  }
 catch (  UnknownHostException e1) {
    logger.info("Could not resolve local host");
  }
  long now=System.currentTimeMillis();
  if (now < EARLIEST_LAUNCH_DATE) {
    String msg=String.format("current machine time is %s, but that is seemingly incorrect. exiting now.",new Date(now).toString());
    logger.error(msg);
    throw new IllegalStateException(msg);
  }
  if (!DatabaseDescriptor.hasLargeAddressSpace())   logger.info("32bit JVM detected.  It is recommended to run Cassandra on a 64bit JVM for better performance.");
  String javaVersion=System.getProperty("java.version");
  String javaVmName=System.getProperty("java.vm.name");
  logger.info("JVM vendor/version: {}/{}",javaVmName,javaVersion);
  if (javaVmName.contains("OpenJDK")) {
    logger.warn("OpenJDK is not recommended. Please upgrade to the newest Oracle Java release");
  }
 else   if (!javaVmName.contains("HotSpot")) {
    logger.warn("Non-Oracle JVM detected.  Some features, such as immediate unmap of compacted SSTables, may not work as intended");
  }
  logger.info("Heap size: {}/{}",Runtime.getRuntime().totalMemory(),Runtime.getRuntime().maxMemory());
  for (  MemoryPoolMXBean pool : ManagementFactory.getMemoryPoolMXBeans())   logger.info("{} {}: {}",pool.getName(),pool.getType(),pool.getPeakUsage());
  logger.info("Classpath: {}",System.getProperty("java.class.path"));
  if (!CLibrary.jnaAvailable()) {
    boolean jnaRequired=!Boolean.getBoolean("cassandra.boot_without_jna");
    if (jnaRequired) {
      exitOrFail(3,"JNA failing to initialize properly. Use -Dcassandra.boot_without_jna=true to bootstrap even so.");
    }
  }
  CLibrary.tryMlockall();
  Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler(){
    public void uncaughtException(    Thread t,    Throwable e){
      StorageMetrics.exceptions.inc();
      logger.error("Exception in thread {}",t,e);
      Tracing.trace("Exception in thread {}",t,e);
      for (Throwable e2=e; e2 != null; e2=e2.getCause()) {
        JVMStabilityInspector.inspectThrowable(e2);
        if (e2 instanceof FSError) {
          if (e2 != e)           logger.error("Exception in thread {}",t,e2);
          FileUtils.handleFSError((FSError)e2);
        }
        if (e2 instanceof CorruptSSTableException) {
          if (e2 != e)           logger.error("Exception in thread " + t,e2);
          FileUtils.handleCorruptSSTable((CorruptSSTableException)e2);
        }
      }
    }
  }
);
  Iterable<String> dirs=Iterables.concat(Arrays.asList(DatabaseDescriptor.getAllDataFileLocations()),Arrays.asList(DatabaseDescriptor.getCommitLogLocation(),DatabaseDescriptor.getSavedCachesLocation()));
  SigarLibrary sigarLibrary=new SigarLibrary();
  if (sigarLibrary.initialized())   sigarLibrary.warnIfRunningInDegradedMode();
 else   logger.info("Sigar could not be initialized");
  for (  String dataDir : dirs) {
    logger.debug("Checking directory {}",dataDir);
    File dir=new File(dataDir);
    if (!dir.exists()) {
      logger.error("Directory {} doesn't exist",dataDir);
      if (!dir.mkdirs()) {
        exitOrFail(3,"Has no permission to create directory " + dataDir);
      }
    }
    if (!Directories.verifyFullPermissions(dir,dataDir)) {
      exitOrFail(3,"Insufficient permissions on directory " + dataDir);
    }
  }
  if (CacheService.instance == null)   throw new RuntimeException("Failed to initialize Cache Service.");
  for (  CFMetaData cfm : Schema.instance.getKeyspaceMetaData(SystemKeyspace.NAME).values())   ColumnFamilyStore.scrubDataDirectories(cfm);
  try {
    SystemKeyspace.checkHealth();
  }
 catch (  ConfigurationException e) {
    exitOrFail(100,"Fatal exception during initialization",e);
  }
  DatabaseDescriptor.loadSchemas();
  Functions.loadUDFFromSchema();
  Map<Pair<String,String>,Map<Integer,UUID>> unfinishedCompactions=SystemKeyspace.getUnfinishedCompactions();
  for (  Pair<String,String> kscf : unfinishedCompactions.keySet()) {
    CFMetaData cfm=Schema.instance.getCFMetaData(kscf.left,kscf.right);
    if (cfm != null)     ColumnFamilyStore.removeUnfinishedCompactionLeftovers(cfm,unfinishedCompactions.get(kscf));
  }
  SystemKeyspace.discardCompactionsInProgress();
  for (  String keyspaceName : Schema.instance.getKeyspaces()) {
    if (keyspaceName.equals(SystemKeyspace.NAME))     continue;
    for (    CFMetaData cfm : Schema.instance.getKeyspaceMetaData(keyspaceName).values())     ColumnFamilyStore.scrubDataDirectories(cfm);
  }
  Keyspace.setInitialized();
  for (  String keyspaceName : Schema.instance.getKeyspaces()) {
    if (logger.isDebugEnabled())     logger.debug("opening keyspace {}",keyspaceName);
    for (    ColumnFamilyStore cfs : Keyspace.open(keyspaceName).getColumnFamilyStores()) {
      for (      ColumnFamilyStore store : cfs.concatWithIndexes()) {
        store.disableAutoCompaction();
      }
    }
  }
  if (CacheService.instance.keyCache.size() > 0)   logger.info("completed pre-loading ({} keys) key cache.",CacheService.instance.keyCache.size());
  if (CacheService.instance.rowCache.size() > 0)   logger.info("completed pre-loading ({} keys) row cache.",CacheService.instance.rowCache.size());
  try {
    GCInspector.register();
  }
 catch (  Throwable t) {
    JVMStabilityInspector.inspectThrowable(t);
    logger.warn("Unable to start GCInspector (currently only supported on the Sun JVM)");
  }
  try {
    CommitLog.instance.recover();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  for (  Keyspace keyspace : Keyspace.all()) {
    for (    ColumnFamilyStore cfs : keyspace.getColumnFamilyStores()) {
      for (      final ColumnFamilyStore store : cfs.concatWithIndexes()) {
        if (store.getCompactionStrategy().shouldBeEnabled())         store.enableAutoCompaction();
      }
    }
  }
  Runnable runnable=new Runnable(){
    public void run(){
      for (      Keyspace keyspaceName : Keyspace.all()) {
        for (        ColumnFamilyStore cf : keyspaceName.getColumnFamilyStores()) {
          for (          ColumnFamilyStore store : cf.concatWithIndexes())           CompactionManager.instance.submitBackground(store);
        }
      }
    }
  }
;
  ScheduledExecutors.optionalTasks.schedule(runnable,5 * 60,TimeUnit.SECONDS);
  SystemKeyspace.finishStartup();
  StorageService.instance.registerDaemon(this);
  try {
    StorageService.instance.initServer();
  }
 catch (  ConfigurationException e) {
    System.err.println(e.getMessage() + "\nFatal configuration error; unable to start server.  See log for stacktrace.");
    exitOrFail(1,"Fatal configuration error",e);
  }
  Mx4jTool.maybeLoad();
  String metricsReporterConfigFile=System.getProperty("cassandra.metricsReporterConfigFile");
  if (metricsReporterConfigFile != null) {
    logger.info("Trying to load metrics-reporter-config from file: {}",metricsReporterConfigFile);
    try {
      String reportFileLocation=CassandraDaemon.class.getClassLoader().getResource(metricsReporterConfigFile).getFile();
      ReporterConfig.loadFromFile(reportFileLocation).enableAll();
    }
 catch (    Exception e) {
      logger.warn("Failed to load metrics-reporter-config, metric sinks will not be activated",e);
    }
  }
  if (!FBUtilities.getBroadcastAddress().equals(InetAddress.getLoopbackAddress()))   waitForGossipToSettle();
  InetAddress rpcAddr=DatabaseDescriptor.getRpcAddress();
  int rpcPort=DatabaseDescriptor.getRpcPort();
  int listenBacklog=DatabaseDescriptor.getRpcListenBacklog();
  thriftServer=new ThriftServer(rpcAddr,rpcPort,listenBacklog);
  InetAddress nativeAddr=DatabaseDescriptor.getRpcAddress();
  int nativePort=DatabaseDescriptor.getNativeTransportPort();
  nativeServer=new org.apache.cassandra.transport.Server(nativeAddr,nativePort);
}
