{
  long deadline=System.currentTimeMillis() + timeout;
  int attempts=0;
  String template="%s for " + this + " after %d attempt(s) with %d ms to spare.";
  Exception e=null;
  while (deadline > System.currentTimeMillis()) {
    try {
      attempts++;
      tryPerformAction(cl);
      logger.info(String.format(template,"Succeeded",attempts,deadline - System.currentTimeMillis()));
      return;
    }
 catch (    Exception ex) {
      e=ex;
      if (!expected.contains(ex.getClass()))       continue;
      logger.info(String.format(template,"Caught expected exception: " + e,attempts,deadline - System.currentTimeMillis()));
      return;
    }
  }
  String err=String.format(template,"Caught unexpected: " + e,attempts,deadline - System.currentTimeMillis());
  logger.error(err);
  throw new AssertionError(err);
}
