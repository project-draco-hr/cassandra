{
  List<InetAddress> hosts=controller.getHosts();
  Cassandra.Client client=controller.createClient(hosts.get(0));
  final String keyspace="TestWriteOneReadAll";
  addKeyspace(keyspace,3);
  client.set_keyspace(keyspace);
  ByteBuffer key=newKey();
  List<InetAddress> endpoints=endpointsForKey(hosts.get(0),key,keyspace);
  InetAddress coordinator=nonEndpointForKey(hosts.get(0),key,keyspace);
  client=controller.createClient(coordinator);
  client.set_keyspace(keyspace);
  insert(client,key,"Standard1","c1","v1",0,ConsistencyLevel.ONE);
  assertColumnEqual("c1","v1",0,getColumn(client,key,"Standard1","c1",ConsistencyLevel.ALL));
  Failure failure=controller.failHosts(endpoints);
  try {
    new Insert(client,"Standard1",key).name("c2").value("v2").expecting(UnavailableException.class).perform(ConsistencyLevel.ONE);
  }
  finally {
    failure.resolve();
  }
}
