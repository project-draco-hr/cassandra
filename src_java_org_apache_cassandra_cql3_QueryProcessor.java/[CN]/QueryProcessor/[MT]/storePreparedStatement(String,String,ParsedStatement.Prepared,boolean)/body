{
  String toHash=keyspace == null ? queryString : keyspace + queryString;
  if (forThrift) {
    int statementId=toHash.hashCode();
    thriftPreparedStatements.put(statementId,prepared.statement);
    logger.trace(String.format("Stored prepared statement #%d with %d bind markers",statementId,prepared.statement.getBoundsTerms()));
    return ResultMessage.Prepared.forThrift(statementId,prepared.boundNames);
  }
 else {
    MD5Digest statementId=MD5Digest.compute(toHash);
    logger.trace(String.format("Stored prepared statement %s with %d bind markers",statementId,prepared.statement.getBoundsTerms()));
    preparedStatements.put(statementId,prepared.statement);
    return new ResultMessage.Prepared(statementId,prepared);
  }
}
