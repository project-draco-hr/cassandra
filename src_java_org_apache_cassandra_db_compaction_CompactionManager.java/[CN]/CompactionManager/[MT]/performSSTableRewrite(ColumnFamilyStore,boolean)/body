{
  return parallelAllSSTableOperation(cfs,new OneSSTableOperation(){
    @Override public Iterable<SSTableReader> filterSSTables(    Iterable<SSTableReader> input){
      return Iterables.filter(input,new Predicate<SSTableReader>(){
        @Override public boolean apply(        SSTableReader sstable){
          return !(excludeCurrentVersion && sstable.descriptor.version.equals(Descriptor.Version.CURRENT));
        }
      }
);
    }
    @Override public void execute(    SSTableReader input) throws IOException {
      AbstractCompactionTask task=cfs.getCompactionStrategy().getCompactionTask(Collections.singleton(input),NO_GC,Long.MAX_VALUE);
      task.setUserDefined(true);
      task.setCompactionType(OperationType.UPGRADE_SSTABLES);
      task.execute(metrics);
    }
  }
);
}
