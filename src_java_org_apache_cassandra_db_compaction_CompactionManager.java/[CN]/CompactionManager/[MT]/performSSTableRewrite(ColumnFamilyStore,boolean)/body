{
  return parallelAllSSTableOperation(cfs,new OneSSTableOperation(){
    @Override public Iterable<SSTableReader> filterSSTables(    Iterable<SSTableReader> input){
      return Iterables.filter(input,new Predicate<SSTableReader>(){
        @Override public boolean apply(        SSTableReader sstable){
          return !(excludeCurrentVersion && sstable.descriptor.version.equals(sstable.descriptor.getFormat().getLatestVersion()));
        }
      }
);
    }
    @Override public void execute(    LifecycleTransaction txn) throws IOException {
      AbstractCompactionTask task=cfs.getCompactionStrategyManager().getCompactionTask(txn,NO_GC,Long.MAX_VALUE);
      task.setUserDefined(true);
      task.setCompactionType(OperationType.UPGRADE_SSTABLES);
      task.execute(metrics);
    }
  }
,OperationType.UPGRADE_SSTABLES);
}
