{
  Callable<Integer> callable=new Callable<Integer>(){
    public Integer call() throws IOException {
      compactionLock.readLock().lock();
      try {
        if (!cfs.isValid())         return 0;
        boolean taskExecuted=false;
        AbstractCompactionStrategy strategy=cfs.getCompactionStrategy();
        List<AbstractCompactionTask> tasks=strategy.getBackgroundTasks(getDefaultGcBefore(cfs));
        for (        AbstractCompactionTask task : tasks) {
          if (!task.markSSTablesForCompaction())           continue;
          taskExecuted=true;
          try {
            task.execute(executor);
          }
  finally {
            task.unmarkSSTables();
          }
        }
        if (taskExecuted)         submitBackground(cfs);
      }
  finally {
        compactionLock.readLock().unlock();
      }
      return 0;
    }
  }
;
  return executor.submit(callable);
}
