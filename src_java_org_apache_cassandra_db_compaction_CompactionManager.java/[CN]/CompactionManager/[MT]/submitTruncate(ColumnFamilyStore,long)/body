{
  Runnable runnable=new WrappedRunnable(){
    public void runMayThrow() throws InterruptedException, IOException {
      compactionLock.writeLock().lock();
      try {
        for (        ColumnFamilyStore cfs : main.concatWithIndexes()) {
          List<SSTableReader> truncatedSSTables=new ArrayList<SSTableReader>();
          for (          SSTableReader sstable : cfs.getSSTables()) {
            if (!sstable.newSince(truncatedAt))             truncatedSSTables.add(sstable);
          }
          cfs.markCompacted(truncatedSSTables);
        }
      }
  finally {
        compactionLock.writeLock().unlock();
      }
      main.invalidateRowCache();
    }
  }
;
  return executor.submit(runnable);
}
