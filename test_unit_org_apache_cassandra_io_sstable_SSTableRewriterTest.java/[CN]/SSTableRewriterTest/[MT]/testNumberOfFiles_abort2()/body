{
  testNumberOfFiles_abort(new RewriterTest(){
    public void run(    ISSTableScanner scanner,    CompactionController controller,    SSTableReader sstable,    ColumnFamilyStore cfs,    SSTableRewriter rewriter){
      try (CompactionIterator ci=new CompactionIterator(OperationType.COMPACTION,Collections.singletonList(scanner),controller,FBUtilities.nowInSeconds(),UUIDGen.getTimeUUID())){
        int files=1;
        while (ci.hasNext()) {
          rewriter.append(ci.next());
          if (rewriter.currentWriter().getFilePointer() > 25000000) {
            rewriter.switchWriter(getWriter(cfs,sstable.descriptor.directory));
            files++;
            assertEquals(cfs.getSSTables().size(),files);
          }
          if (files == 3) {
            rewriter.abort();
            break;
          }
        }
      }
     }
  }
);
}
