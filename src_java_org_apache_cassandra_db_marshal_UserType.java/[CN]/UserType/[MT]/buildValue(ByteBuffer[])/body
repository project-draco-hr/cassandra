{
  int totalLength=0;
  for (  ByteBuffer field : fields)   totalLength+=4 + (field == null ? 0 : field.remaining());
  ByteBuffer result=ByteBuffer.allocate(totalLength);
  for (  ByteBuffer field : fields) {
    if (field == null) {
      result.putInt(-1);
    }
 else {
      result.putInt(field.remaining());
      result.put(field.duplicate());
    }
  }
  result.rewind();
  return result;
}
