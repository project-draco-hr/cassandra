{
  Comparator<Composite> comparator=cf.getComparator();
  DeletionInfo.InOrderTester tester=cf.deletionInfo().inOrderTester();
  Iterator<RangeTombstone> rangeIter=cf.deletionInfo().rangeIterator();
  RangeTombstone tombstone=rangeIter.hasNext() ? rangeIter.next() : null;
  for (  Column c : cf) {
    while (tombstone != null && comparator.compare(c.name(),tombstone.min) >= 0) {
      if (!cf.deletionInfo().getTopLevelDeletion().isDeleted(tombstone))       add(tombstone);
      tombstone=rangeIter.hasNext() ? rangeIter.next() : null;
    }
    if (!tester.isDeleted(c))     add(c);
  }
  while (tombstone != null) {
    add(tombstone);
    tombstone=rangeIter.hasNext() ? rangeIter.next() : null;
  }
  ColumnIndex index=build();
  maybeWriteEmptyRowHeader();
  return index;
}
