{
  super(rows.get(0).getKey());
  Set<SSTable> sstables=new HashSet<SSTable>();
  for (  SSTableIdentityIterator row : rows) {
    sstables.add(row.sstable);
  }
  boolean shouldPurge=major || !cfStore.isKeyInRemainingSSTables(key,sstables);
  ColumnFamily cf=null;
  for (  SSTableIdentityIterator row : rows) {
    ColumnFamily thisCF;
    try {
      thisCF=row.getColumnFamilyWithColumns();
    }
 catch (    IOException e) {
      logger.error("Skipping row " + key + " in "+ row.getPath(),e);
      continue;
    }
    if (cf == null) {
      cf=thisCF;
    }
 else {
      cf.addAll(thisCF);
    }
  }
  compactedCf=shouldPurge ? ColumnFamilyStore.removeDeleted(cf,gcBefore) : cf;
  if (compactedCf != null && compactedCf.metadata().getDefaultValidator().isCommutative()) {
    CounterColumn.removeOldShards(compactedCf,gcBefore);
  }
}
