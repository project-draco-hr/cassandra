{
  lock.readLock().lock();
  try {
    ArrayList<Token> tokens=new ArrayList<Token>(tokenToEndPointMap.keySet());
    if (tokens.isEmpty())     return null;
    Collections.sort(tokens);
    int i=tokens.indexOf(endPointToTokenMap.get(endPoint));
    int j=1;
    InetAddress ep;
    while (!FailureDetector.instance().isAlive((ep=tokenToEndPointMap.get(tokens.get((i + j) % tokens.size()))))) {
      if (++j > DatabaseDescriptor.getReplicationFactor()) {
        throw new UnavailableException();
      }
    }
    return ep;
  }
  finally {
    lock.readLock().unlock();
  }
}
