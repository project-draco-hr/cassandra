{
  TokenMetadata tm=cachedTokenMap.get();
  if (tm != null)   return tm;
synchronized (this) {
    lock.readLock().lock();
    try {
      tm=new TokenMetadata(SortedBiMultiValMap.<Token,InetAddress>create(tokenToEndpointMap,null,inetaddressCmp),HashBiMap.create(endpointToHostIdMap),new Topology(topology));
      cachedTokenMap.set(tm);
      return tm;
    }
  finally {
      lock.readLock().unlock();
    }
  }
}
