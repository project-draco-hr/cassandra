{
  existing=existing == null || deletion.deletes(existing.livenessInfo()) ? null : existing;
  update=update == null || deletion.deletes(update.livenessInfo()) ? null : update;
  if (existing == null || update == null) {
    if (update != null) {
      updatePKIndexes(clustering,update,nowInSec,indexUpdater);
      indexUpdater.insert(clustering,update);
      update.writeTo(writer);
    }
 else     if (existing != null) {
      existing.writeTo(writer);
    }
    return Long.MAX_VALUE;
  }
  Cell reconciled=reconcile(existing,update,nowInSec);
  reconciled.writeTo(writer);
  if (reconciled == update) {
    updatePKIndexes(clustering,update,nowInSec,indexUpdater);
    indexUpdater.update(clustering,existing,reconciled);
  }
  return Math.abs(existing.livenessInfo().timestamp() - update.livenessInfo().timestamp());
}
