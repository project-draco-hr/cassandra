{
  DecoratedKey vkey=StorageService.getPartitioner().decorateKey(Migration.toUTF8Bytes(version));
  Table defs=Table.open(Table.SYSTEM_TABLE);
  ColumnFamilyStore cfStore=defs.getColumnFamilyStore(Migration.SCHEMA_CF);
  QueryFilter filter=QueryFilter.getIdentityFilter(vkey,new QueryPath(Migration.SCHEMA_CF));
  ColumnFamily cf=cfStore.getColumnFamily(filter);
  IColumn avroschema=cf.getColumn(DEFINITION_SCHEMA_COLUMN_NAME);
  if (avroschema == null)   throw new RuntimeException("Cannot read system table! Are you upgrading a pre-release version?");
  Schema schema=Schema.parse(new String(avroschema.value()));
  Collection<KSMetaData> keyspaces=new ArrayList<KSMetaData>();
  try {
    for (    IColumn column : cf.getSortedColumns()) {
      if (Arrays.equals(column.name(),DEFINITION_SCHEMA_COLUMN_NAME))       continue;
      org.apache.cassandra.avro.KsDef ks=SerDeUtils.<org.apache.cassandra.avro.KsDef>deserialize(schema,column.value());
      keyspaces.add(KSMetaData.inflate(ks));
    }
  }
 catch (  ConfigurationException e) {
    throw new IOException(e);
  }
  return keyspaces;
}
