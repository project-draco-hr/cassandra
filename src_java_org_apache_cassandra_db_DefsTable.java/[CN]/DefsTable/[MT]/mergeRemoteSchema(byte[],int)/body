{
  if (version < MessagingService.VERSION_11) {
    logger.error("Can't accept schema migrations from Cassandra versions previous to 1.1, please update first.");
    return;
  }
  Map<DecoratedKey,ColumnFamily> oldKeyspaces=SystemTable.getSchema(SystemTable.SCHEMA_KEYSPACES_CF);
  Map<DecoratedKey,ColumnFamily> oldColumnFamilies=SystemTable.getSchema(SystemTable.SCHEMA_COLUMNFAMILIES_CF);
  for (  RowMutation mutation : MigrationManager.deserializeMigrationMessage(data,version))   mutation.apply();
  if (!StorageService.instance.isClientMode())   MigrationHelper.flushSchemaCFs();
  Schema.instance.updateVersionAndAnnounce();
  Set<String> keyspacesToDrop=mergeKeyspaces(oldKeyspaces,SystemTable.getSchema(SystemTable.SCHEMA_KEYSPACES_CF));
  mergeColumnFamilies(oldColumnFamilies,SystemTable.getSchema(SystemTable.SCHEMA_COLUMNFAMILIES_CF));
  for (  String keyspaceToDrop : keyspacesToDrop)   MigrationHelper.dropKeyspace(keyspaceToDrop,-1,false);
}
