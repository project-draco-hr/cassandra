{
  byte[] versionKey=Migration.toBytes(version);
  long now=System.currentTimeMillis();
  RowMutation rm=new RowMutation(Table.SYSTEM_TABLE,versionKey);
  for (  String tableName : DatabaseDescriptor.getNonSystemTables()) {
    KSMetaData ks=DatabaseDescriptor.getTableDefinition(tableName);
    rm.add(new QueryPath(Migration.SCHEMA_CF,null,ks.name.getBytes()),KSMetaData.serialize(ks),now);
  }
  rm.apply();
  rm=new RowMutation(Table.SYSTEM_TABLE,Migration.LAST_MIGRATION_KEY);
  rm.add(new QueryPath(Migration.SCHEMA_CF,null,Migration.LAST_MIGRATION_KEY),UUIDGen.decompose(version),now);
  rm.apply();
}
