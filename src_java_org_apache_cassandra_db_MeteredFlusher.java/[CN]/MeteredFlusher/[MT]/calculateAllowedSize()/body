{
  long allowed=DatabaseDescriptor.getTotalMemtableSpaceInMB() * 1048576L;
  for (  ColumnFamilyStore cfs : ColumnFamilyStore.all())   if (!cfs.getCompactionStrategy().isAffectedByMeteredFlusher())   allowed-=cfs.getCompactionStrategy().getMemtableReservedSize();
  return allowed;
}
