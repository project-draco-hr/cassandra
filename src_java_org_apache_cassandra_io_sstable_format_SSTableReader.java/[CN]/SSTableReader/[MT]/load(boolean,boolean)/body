{
  try (SegmentedFile.Builder ibuilder=SegmentedFile.getBuilder(DatabaseDescriptor.getIndexAccessMode(),false);SegmentedFile.Builder dbuilder=SegmentedFile.getBuilder(DatabaseDescriptor.getDiskAccessMode(),compression)){
    boolean summaryLoaded=loadSummary(ibuilder,dbuilder);
    boolean builtSummary=false;
    if (recreateBloomFilter || !summaryLoaded) {
      buildSummary(recreateBloomFilter,summaryLoaded,Downsampling.BASE_SAMPLING_LEVEL);
      builtSummary=true;
    }
    if (components.contains(Component.PRIMARY_INDEX))     ifile=ibuilder.buildIndex(descriptor,indexSummary);
    dfile=dbuilder.buildData(descriptor,sstableMetadata);
    if (saveSummaryIfCreated && builtSummary)     saveSummary(ibuilder,dbuilder);
  }
 catch (  Throwable t) {
    if (ifile != null) {
      ifile.close();
      ifile=null;
    }
    if (dfile != null) {
      dfile.close();
      dfile=null;
    }
    if (indexSummary != null) {
      indexSummary.close();
      indexSummary=null;
    }
    throw t;
  }
}
