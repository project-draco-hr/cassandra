{
  RandomAccessReader primaryIndex=RandomAccessReader.open(new File(descriptor.filenameFor(Component.PRIMARY_INDEX)));
  try {
    long indexSize=primaryIndex.length();
    try (IndexSummaryBuilder summaryBuilder=new IndexSummaryBuilder(estimatedKeys(),metadata.params.minIndexInterval,newSamplingLevel)){
      long indexPosition;
      while ((indexPosition=primaryIndex.getFilePointer()) != indexSize) {
        summaryBuilder.maybeAddEntry(decorateKey(ByteBufferUtil.readWithShortLength(primaryIndex)),indexPosition);
        RowIndexEntry.Serializer.skip(primaryIndex,descriptor.version);
      }
      return summaryBuilder.build(getPartitioner());
    }
   }
  finally {
    FileUtils.closeQuietly(primaryIndex);
  }
}
