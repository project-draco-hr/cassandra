{
  RowIndexEntry rie=sstableWriter.append(partition);
  if (sstableWriter.currentWriter().getOnDiskFilePointer() > currentBytesToWrite && currentRatioIndex < ratios.length - 1) {
    currentRatioIndex++;
    currentBytesToWrite=Math.round(totalSize * ratios[currentRatioIndex]);
    long currentPartitionsToWrite=Math.round(ratios[currentRatioIndex] * estimatedTotalKeys);
    File sstableDirectory=cfs.directories.getLocationForDisk(getWriteDirectory(Math.round(totalSize * ratios[currentRatioIndex])));
    @SuppressWarnings("resource") SSTableWriter writer=SSTableWriter.create(Descriptor.fromFilename(cfs.getSSTablePath(sstableDirectory)),currentPartitionsToWrite,minRepairedAt,cfs.metadata,new MetadataCollector(allSSTables,cfs.metadata.comparator,0),SerializationHeader.make(cfs.metadata,nonExpiredSSTables),txn);
    sstableWriter.switchWriter(writer);
    logger.debug("Switching writer, currentPartitionsToWrite = {}",currentPartitionsToWrite);
  }
  return rie != null;
}
