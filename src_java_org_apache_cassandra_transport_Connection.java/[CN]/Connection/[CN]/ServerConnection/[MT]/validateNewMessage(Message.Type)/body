{
switch (state) {
case UNINITIALIZED:
    if (type != Message.Type.STARTUP && type != Message.Type.OPTIONS)     throw new ProtocolException(String.format("Unexpected message %s, expecting STARTUP or OPTIONS",type));
  break;
case AUTHENTICATION:
if (type != Message.Type.CREDENTIALS) throw new ProtocolException(String.format("Unexpected message %s, needs authentication through CREDENTIALS message",type));
break;
case READY:
if (type == Message.Type.STARTUP) throw new ProtocolException("Unexpected message STARTUP, the connection is already initialized");
break;
default :
throw new AssertionError();
}
}
