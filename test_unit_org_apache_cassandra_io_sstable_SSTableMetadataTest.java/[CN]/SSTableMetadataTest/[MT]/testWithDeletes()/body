{
  Table table=Table.open("Keyspace1");
  ColumnFamilyStore store=table.getColumnFamilyStore("Standard2");
  long timestamp=System.currentTimeMillis();
  DecoratedKey key=Util.dk("deletetest");
  RowMutation rm=new RowMutation("Keyspace1",key.key);
  for (int i=0; i < 5; i++)   rm.add("Standard2",ByteBufferUtil.bytes("deletecolumn" + i),ByteBufferUtil.EMPTY_BYTE_BUFFER,timestamp,100);
  rm.add("Standard2",ByteBufferUtil.bytes("todelete"),ByteBufferUtil.EMPTY_BYTE_BUFFER,timestamp,1000);
  rm.apply();
  store.forceBlockingFlush();
  assertEquals(1,store.getSSTables().size());
  int ttltimestamp=(int)(System.currentTimeMillis() / 1000);
  int firstMaxDelTime=0;
  for (  SSTableReader sstable : store.getSSTables()) {
    firstMaxDelTime=sstable.getSSTableMetadata().maxLocalDeletionTime;
    assertEquals(ttltimestamp + 1000,firstMaxDelTime,10);
  }
  rm=new RowMutation("Keyspace1",key.key);
  rm.delete("Standard2",ByteBufferUtil.bytes("todelete"),timestamp + 1);
  rm.apply();
  store.forceBlockingFlush();
  assertEquals(2,store.getSSTables().size());
  boolean foundDelete=false;
  for (  SSTableReader sstable : store.getSSTables()) {
    if (sstable.getSSTableMetadata().maxLocalDeletionTime != firstMaxDelTime) {
      assertEquals(sstable.getSSTableMetadata().maxLocalDeletionTime,ttltimestamp,10);
      foundDelete=true;
    }
  }
  assertTrue(foundDelete);
  Util.compact(store,store.getSSTables());
  assertEquals(1,store.getSSTables().size());
  for (  SSTableReader sstable : store.getSSTables()) {
    assertEquals(ttltimestamp + 100,sstable.getSSTableMetadata().maxLocalDeletionTime,10);
  }
}
