{
  Keyspace keyspace=Keyspace.open(KEYSPACE1);
  ColumnFamilyStore store=keyspace.getColumnFamilyStore("Standard1");
  long timestamp=System.currentTimeMillis();
  for (int i=0; i < 10; i++) {
    DecoratedKey key=Util.dk(Integer.toString(i));
    Mutation rm=new Mutation(KEYSPACE1,key.getKey());
    for (int j=0; j < 10; j++)     rm.add("Standard1",cellname(Integer.toString(j)),ByteBufferUtil.EMPTY_BYTE_BUFFER,timestamp,10 + j);
    rm.apply();
  }
  Mutation rm=new Mutation(KEYSPACE1,Util.dk("longttl").getKey());
  rm.add("Standard1",cellname("col"),ByteBufferUtil.EMPTY_BYTE_BUFFER,timestamp,10000);
  rm.apply();
  store.forceBlockingFlush();
  assertEquals(1,store.getSSTables().size());
  int ttltimestamp=(int)(System.currentTimeMillis() / 1000);
  int firstDelTime=0;
  for (  SSTableReader sstable : store.getSSTables()) {
    firstDelTime=sstable.getSSTableMetadata().maxLocalDeletionTime;
    assertEquals(ttltimestamp + 10000,firstDelTime,10);
  }
  rm=new Mutation(KEYSPACE1,Util.dk("longttl2").getKey());
  rm.add("Standard1",cellname("col"),ByteBufferUtil.EMPTY_BYTE_BUFFER,timestamp,20000);
  rm.apply();
  ttltimestamp=(int)(System.currentTimeMillis() / 1000);
  store.forceBlockingFlush();
  assertEquals(2,store.getSSTables().size());
  List<SSTableReader> sstables=new ArrayList<>(store.getSSTables());
  if (sstables.get(0).getSSTableMetadata().maxLocalDeletionTime < sstables.get(1).getSSTableMetadata().maxLocalDeletionTime) {
    assertEquals(sstables.get(0).getSSTableMetadata().maxLocalDeletionTime,firstDelTime);
    assertEquals(sstables.get(1).getSSTableMetadata().maxLocalDeletionTime,ttltimestamp + 20000,10);
  }
 else {
    assertEquals(sstables.get(1).getSSTableMetadata().maxLocalDeletionTime,firstDelTime);
    assertEquals(sstables.get(0).getSSTableMetadata().maxLocalDeletionTime,ttltimestamp + 20000,10);
  }
  Util.compact(store,store.getSSTables());
  assertEquals(1,store.getSSTables().size());
  for (  SSTableReader sstable : store.getSSTables()) {
    assertEquals(sstable.getSSTableMetadata().maxLocalDeletionTime,ttltimestamp + 20000,10);
  }
}
