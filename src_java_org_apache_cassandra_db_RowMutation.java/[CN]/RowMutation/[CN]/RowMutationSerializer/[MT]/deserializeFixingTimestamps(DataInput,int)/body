{
  RowMutation mutation=deserialize(dis,version);
  long now=FBUtilities.timestampMicros();
  Map<Integer,ColumnFamily> fixedModifications=new HashMap<Integer,ColumnFamily>();
  for (  Map.Entry<Integer,ColumnFamily> modification : mutation.modifications_.entrySet()) {
    ColumnFamily cf=ColumnFamily.create(modification.getValue().metadata());
    if (cf.isMarkedForDelete())     cf.delete(cf.getLocalDeletionTime(),cf.getMarkedForDeleteAt() > now ? now : cf.getMarkedForDeleteAt());
    for (    IColumn column : modification.getValue().columns) {
      if (column.timestamp() <= now) {
        cf.addColumn(column);
        continue;
      }
      if (column.isMarkedForDelete())       cf.addColumn(new DeletedColumn(column.name(),column.value(),now));
 else       cf.addColumn(new Column(column.name(),column.value(),now));
    }
    fixedModifications.put(modification.getKey(),cf);
  }
  return new RowMutation(mutation.getTable(),mutation.key(),fixedModifications);
}
