{
  RowMutation mutation=deserialize(dis,version);
  long now=FBUtilities.timestampMicros();
  Map<Integer,ColumnFamily> fixedModifications=new HashMap<Integer,ColumnFamily>();
  for (  Map.Entry<Integer,ColumnFamily> modification : mutation.modifications_.entrySet()) {
    ColumnFamily cfOld=modification.getValue();
    ColumnFamily cf=ColumnFamily.create(cfOld.metadata());
    if (cfOld.isMarkedForDelete())     cf.delete(cfOld.getLocalDeletionTime(),cfOld.getMarkedForDeleteAt() > now ? now : cfOld.getMarkedForDeleteAt());
    for (    IColumn column : cfOld.columns) {
      if (column.timestamp() <= now) {
        cf.addColumn(column);
        continue;
      }
      if (column.isMarkedForDelete())       cf.addColumn(new DeletedColumn(column.name(),column.value(),now));
 else       cf.addColumn(new Column(column.name(),column.value(),now));
    }
    fixedModifications.put(modification.getKey(),cf);
  }
  return new RowMutation(mutation.getTable(),mutation.key(),fixedModifications);
}
