{
  RowMutation mutation=deserialize(dis,version);
  long now=FBUtilities.timestampMicros();
  Map<UUID,ColumnFamily> fixedModifications=new HashMap<UUID,ColumnFamily>();
  for (  Map.Entry<UUID,ColumnFamily> modification : mutation.modifications.entrySet()) {
    ColumnFamily cfOld=modification.getValue();
    ColumnFamily cf=ColumnFamily.create(cfOld.metadata());
    if (cfOld.isMarkedForDelete()) {
      DeletionTime dt=cfOld.deletionInfo().getTopLevelDeletion();
      cf.delete(new DeletionInfo(dt.markedForDeleteAt > now ? now : dt.markedForDeleteAt,dt.localDeletionTime));
    }
    for (    IColumn column : cfOld.columns) {
      if (column.timestamp() <= now) {
        cf.addColumn(column);
        continue;
      }
      if (column.isMarkedForDelete())       cf.addColumn(new DeletedColumn(column.name(),column.value(),now));
 else       cf.addColumn(new Column(column.name(),column.value(),now));
    }
    fixedModifications.put(modification.getKey(),cf);
  }
  return new RowMutation(mutation.getTable(),mutation.key(),fixedModifications);
}
