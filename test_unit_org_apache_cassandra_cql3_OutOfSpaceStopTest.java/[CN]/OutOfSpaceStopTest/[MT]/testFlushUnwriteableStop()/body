{
  makeTable();
  markDirectoriesUnwriteable();
  DiskFailurePolicy oldPolicy=DatabaseDescriptor.getDiskFailurePolicy();
  try {
    DatabaseDescriptor.setDiskFailurePolicy(DiskFailurePolicy.stop);
    flushAndExpectError();
    Assert.assertFalse(Gossiper.instance.isEnabled());
  }
  finally {
    DatabaseDescriptor.setDiskFailurePolicy(oldPolicy);
  }
  makeTable();
  try {
    flush();
    fail("Subsequent flushes expected to fail.");
  }
 catch (  RuntimeException e) {
  }
}
