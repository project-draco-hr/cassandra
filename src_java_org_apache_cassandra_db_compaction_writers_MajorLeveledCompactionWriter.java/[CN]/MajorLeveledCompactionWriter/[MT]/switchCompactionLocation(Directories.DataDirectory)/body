{
  File sstableDirectory=getDirectories().getLocationForDisk(directory);
  @SuppressWarnings("resource") SSTableWriter writer=SSTableWriter.create(Descriptor.fromFilename(cfs.getSSTablePath(sstableDirectory)),averageEstimatedKeysPerSSTable,minRepairedAt,cfs.metadata,new MetadataCollector(allSSTables,cfs.metadata.comparator,currentLevel),SerializationHeader.make(cfs.metadata,nonExpiredSSTables),cfs.indexManager.listIndexes(),txn);
  sstableWriter.switchWriter(writer);
}
