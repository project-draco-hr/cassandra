def setUp(self):
    if self.runserver:
        if os.path.exists(pid_fname):
            pid_path = os.path.join(root, pid_fname)
            print ('Unclean shutdown detected, (%s found)' % pid_path)
            sys.exit()
        import shutil
        for dirname in ['system', 'data', 'commitlog']:
            try:
                shutil.rmtree(('build/test/cassandra/' + dirname))
            except OSError:
                pass
        import subprocess as sp
        os.chdir(root)
        os.environ['CASSANDRA_INCLUDE'] = 'test/cassandra.in.sh'
        args = (['bin/cassandra', '-p', pid_fname] + self.extra_args)
        process = sp.Popen(args, stderr=sp.PIPE, stdout=sp.PIPE)
        time.sleep(0.1)
        start = time.time()
        while (time.time() < (start + 10)):
            try:
                self.open_client()
            except:
                time.sleep(0.1)
            else:
                break
        else:
            print "Couldn't connect to server; aborting regression test"
            process.poll()
            if (process.returncode is None):
                os.kill(pid(), signal.SIGKILL)
            else:
                (stdout_value, stderr_value) = process.communicate()
                print ('Stdout: %s' % stdout_value)
                print ('Stderr: %s' % stderr_value)
            sys.exit()
    else:
        try:
            self.open_client()
        except:
            pass
    self.define_schema()
