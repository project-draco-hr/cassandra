{
  if (key.isEmpty()) {
    throw new InvalidRequestException("Key may not be empty");
  }
  int strlen=key.length();
  int utflen=0;
  for (int i=0; i < strlen; i++) {
    int c=key.charAt(i);
    if ((c >= 0x0001) && (c <= 0x007F))     utflen++;
 else     if (c > 0x07FF)     utflen+=3;
 else     utflen+=2;
  }
  if (utflen > 65535)   throw new InvalidRequestException("Encoded key length of " + utflen + " is longer than maximum of 65535");
}
